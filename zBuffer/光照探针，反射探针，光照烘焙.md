# 采样 Cube map
`unity_SpecCube0` 定义在 UnityInput. hlsl，在 shader 中只需要声明cai'yang


光照探针

```c file:光照探针
float4 frag(VertexOutput i): SV_Target 
{
    return  SampleSH(i.normalWS);
}
```

反射探针

```c file:反射探针
//表面程序片段
float4 frag(VertexOutput i): SV_Target 
{
    //贴图法线转换为世界法线
    half3 normalWS = i.normalWS;
    //摄像机方向
    float3 viewDir = normalize(GetCameraPositionWS().xyz-i.positionWS);
    //获取当前视角反射
    float3 reflectDirWS = reflect(-viewDir,normalWS);
    //读取反射探针贴图
    float4 _CubeMapColor = SAMPLE_TEXTURECUBE_LOD(unity_SpecCube0, samplerunity_SpecCube0, reflectDirWS, _ReflectBlur *8); //_ReflectBlur自定义反射模糊参数
    //输出颜色
    return  _CubeMapColor;
}
```

烘焙光照


```c
Shader "Universal Render Pipeline/CRLuo/CRLuo_URP_13_LightBaked" //URP路径名
{
     //面板属性
    Properties
    {
    }
        SubShader
        {
			//渲染类型为URP
           Tags { "RenderType" = "Opaque" "RenderPipeline" = "UniversalRenderPipeline"}
			//多距离级别
            LOD 100 

		 Pass
        {

            HLSLPROGRAM  //URP 程序块开始

			//顶点程序片段 vert
			#pragma vertex vert

			//表面程序片段 frag
            #pragma fragment frag
    		#pragma multi_compile _ LIGHTMAP_ON  关键字

			//URP函数库
            #include "Packages/com.unity.render-pipelines.universal/ShaderLibrary/Core.hlsl"
			      #include "Packages/com.unity.render-pipelines.universal/ShaderLibrary/Lighting.hlsl"

			CBUFFER_START(UnityPerMaterial) 

            CBUFFER_END 

            struct VertexInput          
            {
                float4 positionOS : POSITION; 
                float2 uv : TEXCOORD0;
				float2 uvLM : TEXCOORD1;    //光照uv
				float4 normalOS  : NORMAL;
            };

            struct VertexOutput 
            {
                float4 positionCS : SV_POSITION; 
                float2 uv : TEXCOORD0;
				float3 positionWS :  TEXCOORD1;
				float3 normalWS : TEXCOORD2;
				float2 uvLM : TEXCOORD3;  //光照uv
				float3 vertexSH   : TEXCOORD4;
            };

            VertexOutput vert(VertexInput v)
            {
                VertexOutput o;

                VertexPositionInputs positionInputs = GetVertexPositionInputs(v.positionOS.xyz);
                o.positionCS = positionInputs.positionCS;
                o.positionWS = positionInputs.positionWS;
                VertexNormalInputs normalInputs = GetVertexNormalInputs(v.normalOS.xyz);
                o.normalWS = normalInputs.normalWS;

                OUTPUT_LIGHTMAP_UV(v.uvLM, unity_LightmapST, o.uvLM); 

                return o;
            }

            //表面程序片段
            float4 frag(VertexOutput i): SV_Target 
            {
                float3 normalWS = i.normalWS;
                half3 bakedGI = SAMPLE_GI(i.uvLM, i.vertexSH, normalWS);
                return float4(bakedGI,1);
            }
            
            ENDHLSL  //URP 程序块结束
        }
    }
}
```