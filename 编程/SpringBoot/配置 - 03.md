### æ–‡ç« ç›®å½•

*   [SpringBoot - é…ç½® - 03](#SpringBoot03_1)
*   *   [1. é…ç½®æ–‡ä»¶åˆ†ç±»](#1_3)
    *   [2.yaml](#2yaml_26)
    *   *   [2.1yaml å®šä¹‰](#21yaml_28)
        *   [2.2yaml åŸºæœ¬è¯­æ³•](#22yaml_60)
        *   [2.3yaml æ•°æ®æ ¼å¼](#23yaml_69)
        *   [2.4yaml å‚æ•°å¼•ç”¨](#24yaml_101)
    *   [3. è¯»å–é…ç½®æ–‡ä»¶å†…å®¹](#3_109)
    *   *   [3.1@Value](#31Value_133)
        *   [3.2Environment](#32Environment_165)
        *   [3.3@ConfigurationProperties](#33ConfigurationProperties_187)
    *   [4.profile](#4profile_221)
    *   *   [4.1profile é…ç½®æ–¹å¼](#41profile_225)
        *   [4.2profile æ¿€æ´»æ–¹å¼](#42profile_281)
    *   [5. å†…ç½®é…ç½®åŠ è½½é¡ºåº](#5_324)
    *   [6. å¤–éƒ¨é…ç½®åŠ è½½é¡ºåº](#6_338)

# SpringBoot - é…ç½® - 03

è¯¥æ–‡ç« å‚è€ƒï¼š[é»‘é©¬ SpringBoot](https://www.bilibili.com/video/BV1Lq4y1J77x?spm_id_from=333.999.0.0)

## 1. é…ç½®æ–‡ä»¶åˆ†ç±»

SpringBoot æ˜¯åŸºäºçº¦å®šçš„ï¼Œæ‰€ä»¥å¾ˆå¤šé…ç½®éƒ½æœ‰é»˜è®¤å€¼ï¼Œä½†å¦‚æœæƒ³ä½¿ç”¨è‡ªå·±çš„é…ç½®æ›¿æ¢é»˜è®¤é…ç½®çš„è¯ï¼Œå°±å¯ä»¥ä½¿ç”¨ `application.properties`æˆ–è€…`application.yml(application.yaml)`è¿›è¡Œé…ç½®ã€‚

*   [properties](https://so.csdn.net/so/search?q=properties&spm=1001.2101.3001.7020)ï¼š
    
    ```
    server.port=8080
    ```
    
*   [yaml](https://so.csdn.net/so/search?q=yaml&spm=1001.2101.3001.7020)ï¼š
    
    ```
    server:
    port: 8080
    ```
    

æ€»ç»“ï¼š

*   SpringBoot æä¾›äº† 2 ç§é…ç½®æ–‡ä»¶ç±»å‹ï¼š`properteis`å’Œ`yml/yaml`
*   é»˜è®¤é…ç½®æ–‡ä»¶åç§°ï¼š`application`
*   åœ¨åŒä¸€çº§ç›®å½•ä¸‹ä¼˜å…ˆçº§ä¸ºï¼š`properties > yml > yaml`

## 2.yaml

### 2.1yaml å®šä¹‰

yamlï¼šYAML å…¨ç§°æ˜¯ YAML Ainâ€™t Markup Language ã€‚YAML æ˜¯ä¸€ç§ç›´è§‚çš„èƒ½å¤Ÿè¢«ç”µè„‘è¯†åˆ«çš„çš„æ•°æ®æ•°æ®åºåˆ—åŒ–æ ¼å¼ï¼Œå¹¶ä¸”å®¹æ˜“è¢«äººç±»é˜…è¯»ï¼Œå®¹æ˜“å’Œè„šæœ¬è¯­è¨€äº¤äº’çš„ï¼Œå¯ä»¥è¢«æ”¯æŒ YAML åº“çš„ä¸åŒçš„ç¼–ç¨‹è¯­è¨€ç¨‹åºå¯¼å…¥ï¼Œæ¯”å¦‚ï¼š C/C++, Ruby, Python, Java, Perl, C#, PHP ç­‰ã€‚YML æ–‡ä»¶æ˜¯ä»¥æ•°æ®ä¸ºæ ¸å¿ƒçš„ï¼Œæ¯”ä¼ ç»Ÿçš„ xml æ–¹å¼æ›´åŠ ç®€æ´ã€‚ YAML æ–‡ä»¶çš„æ‰©å±•åå¯ä»¥ä½¿ç”¨`.ym`l æˆ–è€…`.yaml`ã€‚

å¯¹æ¯”ï¼š

*   propertiesï¼š
    
    ```
    server.port=8080
    server.address=127.0.0.1
    ```
    
*   xmlï¼š
    
    ```
    <server>
        <port>8080</port>
        <address>127.0.0.1</address>
    </server>
    ```
    
*   yamlï¼š
    
    ```
    server: 
    port: 8080
    address: 127.0.0.1
    ```
    

å¯ä»¥çœ‹å‡ºï¼šå¯¹æ¯”å…¶ä»–ä¸¤ç§æ–¹å¼ï¼Œ**yaml æ›´ç®€æ´ï¼Œä»¥æ•°æ®ä¸ºæ ¸å¿ƒ**ã€‚

### 2.2yaml åŸºæœ¬è¯­æ³•

*   å¤§å°å†™æ•æ„Ÿ
*   æ•°æ®å€¼å‰è¾¹å¿…é¡»æœ‰ç©ºæ ¼ï¼Œä½œä¸ºåˆ†éš”ç¬¦
*   ä½¿ç”¨ç¼©è¿›è¡¨ç¤ºå±‚çº§å…³ç³»
*   ç¼©è¿›æ—¶ä¸å…è®¸ä½¿ç”¨ Tab é”®ï¼Œåªå…è®¸ä½¿ç”¨ç©ºæ ¼ï¼ˆå„ä¸ªç³»ç»Ÿ Tab å¯¹åº”çš„ ç©ºæ ¼æ•°ç›®å¯èƒ½ä¸åŒï¼Œå¯¼è‡´å±‚æ¬¡æ··ä¹±ï¼‰ã€‚
*   ç¼©è¿›çš„ç©ºæ ¼æ•°ç›®ä¸é‡è¦ï¼Œåªè¦ç›¸åŒå±‚çº§çš„å…ƒç´ å·¦ä¾§å¯¹é½å³å¯
*   `#`è¡¨ç¤ºæ³¨é‡Šï¼Œä»è¿™ä¸ªå­—ç¬¦ä¸€ç›´åˆ°è¡Œå°¾ï¼Œéƒ½ä¼šè¢«è§£æå™¨å¿½ç•¥ã€‚

### 2.3yaml æ•°æ®æ ¼å¼

*   å¯¹è±¡ï¼ˆmapï¼‰ï¼šé”®å€¼å¯¹çš„é›†åˆ
    
    ```
    person:
    name: zhangsan
    # è¡Œå†…å†™æ³•
    person: {name: zhangsan}
    ```
    
*   æ•°ç»„ï¼šä¸€ç»„æŒ‰æ¬¡åºæ’åˆ—çš„å€¼
    
    ```
    address:
    - beijing
    - shanghai
    # è¡Œå†…å†™æ³•
    address: [beijing,shanghai]
    ```
    
*   çº¯é‡ï¼šå•ä¸ªçš„ï¼Œä¸å¯å†åˆ†çš„å€¼
    
    ```
    msg1: 'hello \n world' # å•å¼•å¿½ç•¥è½¬ä¹‰å­—ç¬¦
    msg2: "hello \n world" # åŒå¼•è¯†åˆ«è½¬ä¹‰å­—ç¬¦
    ```
    

### 2.4yaml å‚æ•°å¼•ç”¨

```
name: lisi
person:
name: ${name} # å¼•ç”¨ä¸Šè¾¹å®šä¹‰çš„nameå€¼
```

## 3. è¯»å–é…ç½®æ–‡ä»¶å†…å®¹

å…ˆé¢„å…ˆå‡†å¤‡å¥½æµ‹è¯•çš„ ymal æ–‡ä»¶ï¼š

```
name: xpp

person:
  name: ${name}
  age: 23
  address:
    - benjing
    - shanghai

address:
  - benjing
  - shanghai

msg1: 'hello \n springboot'
msg2: "hello \n springboot"
```

### 3.1@Value

```
@Value("${name}")
private String name;
@Value("${person.name}")
private String name1;
@Value(("${address[0]}"))
private String address1;
@Value("${msg1}")
private String msg1;
@Value("${msg2}")
private String msg2;

@RequestMapping("/hello2")
public String hello2(){
    System.out.println(name);
    System.out.println(name1);
    System.out.println(address1);
    System.out.println(msg1);
    System.out.println(msg2);
    return "Hello SpringBoot !";
}
è¾“å‡ºç»“æœï¼š
xpp
xpp
benjing
hello \n springboot
hello 
springboot
```

### 3.2Environment

```
@Autowired
private Environment env;

@RequestMapping("/hello2")
public String hello2(){
    System.out.println(env.getProperty("name"));
    System.out.println(env.getProperty("person.age"));
    System.out.println(env.getProperty("address[0]"));

    return "Hello SpringBoot !";
}
è¾“å‡ºï¼š
xpp
benjing
```

### 3.3@ConfigurationProperties

å‡†å¤‡ä¸€ä¸ª Person ç±»ï¼š

```
@Component//è¡¨ç¤ºè¿™ä¸ªç±»è¢«springè¯†åˆ«äº†
@ConfigurationProperties(prefix = "person")//ç»‘å®šå‰ç¼€
//ä¸‹é¢å››ä¸ªæ³¨è§£ä¸ºLomBokæä¾›çš„ï¼Œç®€åŒ–å¼€å‘ï¼Œè‡ªåŠ¨å¸®æˆ‘ä»¬å†™å¥½getï¼Œsetï¼Œæœ‰å‚ï¼Œæ— å‚å’ŒtoStringæ–¹æ³•
@Data
@NoArgsConstructor
@AllArgsConstructor
@ToString
public class Person {
    private String name;
    private Integer age;
    private String[] address;
}
```

æµ‹è¯•ï¼š

```
@Autowired
private Person person;

@RequestMapping("/hello2")
public String hello2(){
    System.out.println(person);
    return "Hello SpringBoot !";
}
è¾“å‡ºç»“æœï¼š
Person(name=xpp, age=23, address=[benjing, shanghai])
```

## 4.profile

æˆ‘ä»¬åœ¨å¼€å‘ Spring Boot åº”ç”¨æ—¶ï¼Œé€šå¸¸åŒä¸€å¥—ç¨‹åºä¼šè¢«å®‰è£…åˆ°ä¸åŒç¯å¢ƒï¼Œæ¯”å¦‚ï¼šå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç­‰ã€‚å…¶ä¸­æ•°æ®åº“åœ°å€ã€æœåŠ¡å™¨ç«¯å£ç­‰ç­‰é…ç½®éƒ½ä¸åŒï¼Œå¦‚æœæ¯æ¬¡æ‰“åŒ…æ—¶ï¼Œéƒ½è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œé‚£ä¹ˆéå¸¸éº»çƒ¦ã€‚**profile åŠŸèƒ½å°±æ˜¯æ¥è¿›è¡ŒåŠ¨æ€é…ç½®åˆ‡æ¢çš„ã€‚**

### 4.1profile é…ç½®æ–¹å¼

**ï¼ˆ1ï¼‰å¤š profile æ–‡ä»¶æ–¹å¼**

æä¾›å¤šä¸ªé…ç½®æ–‡ä»¶ï¼Œæ¯ä¸€ä¸ªä»£è¡¨ä¸€ç§ç¯å¢ƒï¼š

*   `application-dev.properties/yml` å¼€å‘ç¯å¢ƒ
*   `application-test.properties/yml` æµ‹è¯•ç¯å¢ƒ
*   `application-pro.properties/yml` ç”Ÿäº§ç¯å¢ƒ

**æ³¨æ„ï¼**ï¼šæ ¼å¼å¿…é¡»ä¸º`application-xxx.properties/yml`

![](<images/1683635584149.png>)

åœ¨ä¸»é…ç½®æ–‡ä»¶`application.properties`é€‰æ‹©ç”¨å“ªç§ç¯å¢ƒï¼š

**æ ¼å¼**ï¼š`spring.profiles.active=xxx`

```
spring.profiles.active=dev
```

**ï¼ˆ2ï¼‰yaml å¤šæ–‡æ¡£æ–¹å¼**

`---`ç”¨æ¥åˆ’åˆ† yaml æ–‡ä»¶åŒºåŸŸ

```
---

server:
 port: 8081
spring:
 config:
 activate:
 on-profile: dev
---
server:
 port: 8082
spring:
 config:
 activate:
 on-profile: test
---
server:
 port: 8083
spring:
 config:
 activate:
 on-profile: pro
---
spring:
 profiles:
 active: test
```

### 4.2profile æ¿€æ´»æ–¹å¼

**ï¼ˆ1ï¼‰é…ç½®æ–‡ä»¶**

å³ä¸Šé¢æ‰€è®²çš„ï¼šåœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®ï¼š`spring.profiles.active=dev`

**ï¼ˆ2ï¼‰è™šæ‹Ÿæœº**

åœ¨`VM options` æŒ‡å®šï¼š`-Dspring.profiles.active=xxx`

![](<images/1683635584193.png>)

**ï¼ˆ3ï¼‰å‘½ä»¤è¡Œå‚æ•°**

`java â€“jar xxx.jar --spring.profiles.active=xxx`

â‘ ç›´æ¥åœ¨`Program arguments`é…ç½®

![](<images/1683635584245.png>)

â‘¡æ‰“åŒ…æ–¹å¼é…ç½®

![](<images/1683635584303.png>)

è¿›å…¥ target æ–‡ä»¶å¤¹ï¼ˆå¿«æ·é”®`Ctrl+Alt+F12`)

![](<images/1683635584405.png>)

åœ¨å½“å‰ç›®å½•æ‰“å¼€ cmd

![](<images/1683635584450.png>)

è¾“å…¥`java â€“jar xxx.jar`å¯åŠ¨ SpringBoot é¡¹ç›®

![](<images/1683635584506.png>)

è¾“å…¥`java â€“jar xxx.jar --spring.profiles.active=xxx`å³å¯æ›´æ”¹ç¯å¢ƒ  

![](<images/1683635584555.png>)

## 5. å†…ç½®é…ç½®åŠ è½½é¡ºåº

Springboot ç¨‹åºå¯åŠ¨æ—¶ï¼Œä¼šä»ä»¥ä¸‹ä½ç½®åŠ è½½é…ç½®æ–‡ä»¶ï¼š

1.  `file:./config/`ï¼šå½“å‰é¡¹ç›®ä¸‹çš„ / config ç›®å½•ä¸‹
2.  `file:./` ï¼šå½“å‰é¡¹ç›®çš„æ ¹ç›®å½•
3.  `classpath:/config/`ï¼šclasspath çš„ / config ç›®å½•
4.  `classpath:/` ï¼šclasspath çš„æ ¹ç›®å½•ï¼ˆä¹‹å‰æˆ‘ä»¬ç”¨çš„å°±æ˜¯è¿™ç§ï¼‰

åŠ è½½é¡ºåºä¸ºä¸Šæ–‡çš„æ’åˆ—é¡ºåºï¼Œé«˜ä¼˜å…ˆçº§é…ç½®çš„å±æ€§ä¼šç”Ÿæ•ˆ

![](<images/1683635584604.png>)

## 6. å¤–éƒ¨é…ç½®åŠ è½½é¡ºåº

é€šè¿‡[å®˜ç½‘](https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-external-config.html)æŸ¥çœ‹å¤–éƒ¨å±æ€§åŠ è½½é¡ºåºï¼š

æœ€åå–œæ¬¢çš„å°ä¼™ä¼´åˆ«å¿˜äº†ä¸€é”®ä¸‰è¿å“¦ğŸˆğŸˆğŸˆ  

![](<images/1683635584651.png>)