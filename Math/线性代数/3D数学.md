---
banner: "![[2019061650899329.gif]]"
---
# 注意约定
左手坐标系/右手坐标系：注意左/右手定则
行向量/列向量：行向量右乘，列向量左乘


行向量：
	$$\begin{array}
\\
\begin{bmatrix}x & y & z\end{bmatrix}\begin{bmatrix}m_{11} & m_{12} & m_{13} \\ m_{21} & m_{22} & m_{23} \\ m_{31} & m_{32} & m_{33}\end{bmatrix}
\\=\begin{bmatrix}xm_{11}+ym_{21}+zm_{31} & xm_{12}+ym_{22}+zm_{32} & xm_{13}+ym_{23}+zm_{33}\end{bmatrix}\end{array}$$
列向量：
$$
\begin{bmatrix}m_{11}&m_{12}&m_{13}\\ m_{21}&m_{22}&m_{23}\\ m_{31}&m_{32}&m_{33}\end{bmatrix}\begin{bmatrix}x\\ y\\ z\end{bmatrix}=\begin{bmatrix}x m_{11}+ym_{12}+z m_{13}\\ x m_{21}+ym_{22}+z m_{23}\\ x m_{31}+ym_{32}+z m_{33}\end{bmatrix}
$$

- 为什么列向量作为很多学科的通用标准？因为列向量方程看起来更精简，行向量太宽了。
- **对于游戏编程，行向量更适合表示坐标空间变换**，因为可以按顺序右乘。更具有可读性，本书在几乎所有行向量和列向量有区别的情况下都使用行向量。
- 对于一个行向量 $\vec{v}$ 和三个变换矩阵 $ABC$ ，变换表示为 $\vec{v}ABC$，若将 $\vec{v}$ 转换为列向量，那么需要将 $ABC$ 分别**转置**后左乘，才可以表示相同的变换： $CBA\vec{v}$
- 对于行向量：变换矩阵的行是基向量。对于列向量：变换矩阵的列是基向量
例如：列向量的变换
$\begin{bmatrix}0&&1&&2\\ 3&&4&&5\\ 6&&7&&8\end{bmatrix}\begin{bmatrix}x \\ y \\ z\end{bmatrix}=x\begin{bmatrix}0\\ 3\\ 6\end{bmatrix}+y\begin{bmatrix}1\\ 4\\ 7\end{bmatrix}+z\begin{bmatrix}2\\ 5\\ 8\end{bmatrix}$

# 向量（矢量） 
向量最基本的定义就是一个方向。或者更正式的说，向量有一个方向 (Direction)和大小 (Magnitude，也叫做强度或长度)。由于**向量表示的是方向，起始于何处并不会改变它的值**。下图我们可以看到向量 v 和 w 是相等的，尽管他们的起始点不同：

![img](vectors.png)

## 向量与标量运算

标量 (Scalar)只是一个数字（或者说是仅有一个分量的向量）。当把一个向量加/减/乘/除一个标量，我们可以简单的把向量的每个分量分别进行该运算。对于加法来说会像这样:

![image-20220914222144295](image-20220914222144295.png)



其中的+可以是+，-，·或÷，其中·是乘号。注意－和÷运算时不能颠倒（标量-/÷向量），因为颠倒的运算是没有定义的。

> 注意，**数学上是没有向量与标量相加这个运算的**，但是很多线性代数的库都对它有支持（比如说我们用的 GLM）。如果你使用过 numpy 的话，可以把它理解为 [Broadcasting](https://numpy.org/doc/1.18/user/basics.broadcasting.html)。
## 加减
![img](vectors_addition.png)

![img](vectors_subtraction.png)
## 点积 (dot product)

> [!NOTE] 点积公式
>1.  代数定义： $$\mathbf{a}\cdot\mathbf{b}=\sum_{i=1}^n a_i b_i=a_1b_1+a_2b_2+\cdots+a_n b_n$$
> 2. 几何定义： $$\mathbf{a}\cdot\mathbf{b}=\|\mathbf{a}\|\ \|\mathbf{b}\|\cos\theta$$
> 点积为 0，向量正交
> 
> 3. 正交投影 (向量 a 落在向量 b 上的正交投影)
> $$\mathbf p=proj_{b}(a)=||a||\cos{\theta}$$

## 叉积 (cross product)

> [!NOTE] 叉积公式
> 1. 代数定义，注意第二行的顺序：
> $$\begin{bmatrix}x_1\\ y_1\\ z_1\end{bmatrix}\times\begin{bmatrix}x_2\\ y_2\\ z_2\end{bmatrix}=\begin{bmatrix}y_1z_2-z_1y_2\\ z_1x_2-x_1z_2\\ x_1y_2-y_1x_2\end{bmatrix}$$
> 
>1. 几何定义：c 是一个正交（垂直）于 **a** 和 **b** 的向量
> $$c=a\times b$$
>
>4. 叉积的大小=平行四边形面积：
> $$||\mathbf{a}\times\mathbf{b}||\,=\,||\mathbf{a}||\,||\mathbf{b}||\,\sin\theta=两个边a和b形成的平行四边形的面积$$
> 

## 颜色分量相乘

将两个向量的分量相乘，用于计算颜色。

> 假设颜色 color 1 = {r, g, b, a}; color 2 = {x, y, z, w};
>
> 那么颜色分量相乘 color 1 * color 2 = {r * x, g * y, b * z, a * w};

**颜色相加是指光的叠加，物理上是光的强度相加。**例如多个光源照射到一佃表面後反射至撮像禨，就可以把各固光照的反射结果相加。而题目中的例子是 Phong 或 Blinn 材質的反射模型，其意羲可以算是一棰凝合，把材質的反射分解成漫反射和镜面反射，然後把两千反射光的结果相加。
**颜色相乘，其霣稠不是数学中常晃的矢量积，而应该理解颜色的非等比缩放。**例如，光通逼有色玻璃畤，玻璃吸收某百分比的红、蓝、绿，就可以把光的红蓝缘强度分别乘以对应的百分比。漫反射也可以理解成材質吸收了某百分比的入射光後向各方向反射。
如果考虞 HDR 的情况，光的颜色可以大於 1，但吸收率仍是[0，1]。遣漾大概更不鲁混淆两律斓算。

## 规范化
**normalize** 的不同译法：标准化，归一化，规范化，规格化，单位化...... 译者按：区间、范围为归一化，名词向量或空间为规范化 (把一个向量的长度变为单位长度称为向量的规范化，方法是将向量的每个分量除以该向量的模，结果得到一个单位向量。

有一个特殊类型的向量叫做**单位向量 (Unit Vector)**。单位向量有一个特别的性质——它的长度是 1。我们可以用任意向量的每个分量除以向量的长度得到它的单位向量 $\hat{n}$：
$$\:\hat{n}=\dfrac{\bar{v}}{||\bar{v}||}$$
## 正交化
如果向量集 $\{{v_0,\cdots,v_{n-1}} \}$ 中的每个向量都是互相正交且皆具单位长度，那么我们就称此集合是**规范正交 (orthonormal)的。

![[Pasted image 20230402125557.png]]
2D 正交化：假设我们有向量集合 ${v_0,v_1}$ ，现欲将它正交化为图 1.11 中所示的正交集 ${w_0, w_1}$。首先设 ${w_0=v_0}$, 通过使 $v_1$ 减去它在 $w_0$ 上的分量（投影）来令它正交于 $w_0$ :
$$w_1=v_1-proj_{w_0} (v_1)$$
此时得到了元素相互正交的向量集合 $\{w_0,w_1 \}$ ，最后将其规范化为单位向量即可。

3D 正交化方法类似，这种方法比较麻烦，我们可以采用更通用的方法，即格拉姆-施密特 （Gram-Schmidt Orthogonalization）正交化（以下简称施密特正交化）。
### 施密特正交化

> [!NOTE] 计算方法
> 如果向量组 $\alpha_1,\alpha_2,\alpha_3$ 线性无关，令
> $$
\begin{array}{l}
\boldsymbol{\beta}_{_1}=\boldsymbol{\alpha}_{_1}\:,\\
\boldsymbol{\beta}_2\:=\:\boldsymbol{\alpha}_2-\frac{(\boldsymbol{\alpha}_2\:,\boldsymbol{\beta}_1)}{(\boldsymbol{\beta}_1\:,\boldsymbol{\beta}_1)}\boldsymbol{\beta}_1\\
\boldsymbol{\beta}_3\:=\:\boldsymbol{\alpha}_3-\frac{(\boldsymbol{\alpha}_3\:,\boldsymbol{\beta}_1\:)}{(\boldsymbol{\beta}_1\:,\boldsymbol{\beta}_1\:)}\boldsymbol{\beta}_1-\frac{(\boldsymbol{\alpha}_3\:,\boldsymbol{\beta}_2\:)}{(\boldsymbol{\beta}_2\:,\boldsymbol{\beta}_2\:)}\boldsymbol{\beta}_2\:,
\end{array}
>$$
那么 $\beta_1,\beta_2,\beta_3$ 两两正交，称为正交向量组，将其规范化，有 $$
\boldsymbol{\gamma}_1=\dfrac{\boldsymbol{\beta}_1}{\|\boldsymbol{\beta}_1\|},\boldsymbol{\gamma}_2=\dfrac{\boldsymbol{\beta}_2}{\|\boldsymbol{\beta}_2\|},\boldsymbol{\gamma}_3=\dfrac{\boldsymbol{\beta}_3}{\|\boldsymbol{\beta}_3\|},$$完成由 $\alpha 到 \gamma$ 的施密特正交化。

基本步骤：设 ${w_0=v_0}$
对于 $1\leqslant i\leqslant-1$，令 $\displaystyle{w}_{i}={\nu}_{i}-\sum_{j=0}^{i-1}\mathrm{proj}_{{w}_{j}}\left({\nu}_{i}\right)$
规范化：令 $\displaystyle{w}_{i}={\frac{{w}_{i}}{\left\|\:{w}_{i}\right\|}}$

从直观上来说，在将给定集合内的向量添加到规范正交集中时，我们需要令减去它在现有规范正交集中其他向量 ${w_0, w_1,…, w_{i-1}}$ 方向上的分量（投影)，这样方可确保新加入规范正交集的向量与该集合中的其他向量互相正交。

### 通过叉积正交化

> [!NOTE] 通过叉积正交化
> 1. 令 $\displaystyle{w}_{0}=\frac{{\nu}_{0}}{\left\|{\nu}_{0}\right\|}$
> 
>2. 令 $\displaystyle w_{2}=\frac{{w}_{0}\times w_{1}}{\parallel{w}_{0}\times{w}_{1}\parallel}$
>
>3. 令 $w_1=w_2\times w_0$ 
>
由于 ${w}_{2}\perp w_{0}$，且 $||w_2||=||w_1||=1$，因此 $||w_2\times w_0||=1$ ，所以结果已经是规范化的。
此时 $\{w_0,w_1,w_2 \}$ 是规范正交的。

在上面的示例中，我们首先令 $\displaystyle{w}_{0}=\frac{{\nu}_{0}}{\left\|{\nu}_{0}\right\|}$，这意味着将向量 $v_0$ 转换到向量 $w_0$ 时并未改变方向，仅缩放了的长度。但是，向量 $w1$ 与向量 $w2$ 的方向却可以分别不同于 $v_1$ 和向量  $v_2$ 。**对于特定的应用来说，不改变集合中某个向量的方向也许是件很重要的事。**
例如，龙书中利用 3 个规范正交向量 $\{v_0, v_1, v_2\}$ 来表示摄像机（camera)的朝向，而其中的第三个向量 $v_2$ 描述的正是摄像机的观察方向。在对这些向量进行正交化处的过程中，我们通常并不希望改变此摄像机的观察方向。所以，我们会运用上面的算法，在第一步中处理向量 $v_2$，再通过修改向量 $v_0$ 和向量 $v_1$ 来使它们正交化。

# 变换矩阵
### 缩放
缩放矩阵因为是对角矩阵，转置相等。所以行向量、列向量形式一致
#### 2D 缩放

$\begin{bmatrix}S_1 & 0 \\ 0 & S_2\end{bmatrix}$

#### 3D 缩放

$\begin{bmatrix}S_1&0&0&0\\ 0&S_2&0&0\\ 0&0&S_3&0\\ 0&0&0&1\end{bmatrix}$

#### 任意方向缩放
3D 数学 P128
### 位移

![image-20220914224935857](image-20220914224935857.png)

### 旋转

首先我们来定义一个向量的旋转到底是什么。2 D 或 3 D 空间中的旋转用角 (Angle)来表示。角可以是角度制或弧度制的，周角是 360 角度或 2π弧度。我个人更喜欢用角度，因为它们看起来更直观。

> 大多数旋转函数需要用弧度制的角，但幸运的是角度制的角也可以很容易地转化为弧度制的：
>
> - 弧度转角度：`角度 = 弧度 * (180.0f / PI)`
> - 角度转弧度：`弧度 = 角度 * (PI / 180.0f)`
>
> `PI` 约等于 3.14159265359。

#### 二维矩阵旋转
1. 行向量
$\left[\begin{array}{cc}\cos\theta&\sin\theta\\ -\sin\theta&\cos\theta\end{array}\right]$

2. 列向量
$\left[\begin{array}{cc}\cos\theta&-\sin\theta\\ \sin\theta&\cos\theta\end{array}\right]$

#### 三维旋转矩阵
行向量和列向量形式互为**转置**
##### 沿 x 轴旋转
1. 行向量
$\begin{bmatrix}1&0&0&0\\ 0&\cos\theta&\sin\theta&0\\ 0&-\sin\theta&\cos\theta&0\\ 0&0&0&1\end{bmatrix}$
3. 列向量
$\begin{bmatrix}1&0&0&0\\ 0&\cos\theta&-\sin\theta&0\\ 0&\sin\theta&\cos\theta&0\\ 0&0&0&1\end{bmatrix}$


##### 沿 y 轴旋转
1. 行向量
$\begin{bmatrix}\cos\theta&0&-\sin\theta&0\\ 0&1&0&0\\ \sin\theta&0&\cos\theta&0\\ 0&0&0&1\end{bmatrix}$
2. 列向量
$\begin{bmatrix}\cos\theta&0&\sin\theta&0\\ 0&1&0&0\\ -\sin\theta&0&\cos\theta&0\\ 0&0&0&1\end{bmatrix}$

##### 沿 z 轴旋转
1. 行向量
$\begin{bmatrix}\cos\theta&\sin\theta&0&0\\ -sin\theta&\cos\theta&0&0\\ 0&0&1&0\\ 0&0&0&1\end{bmatrix}$

3. 列向量
$\begin{bmatrix}\cos\theta&-\sin\theta&0&0\\ \text{sin}\theta&\cos\theta&0&0\\ 0&0&1&0\\ 0&0&0&1\end{bmatrix}$


可以将多个矩阵复合，比如先沿着 x 轴旋转再沿着 y 轴旋转。但是这会很快导致一个问题——[万向节死锁（Gimbal Lock)]([无伤理解欧拉角中的“万向死锁”现象_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1Nr4y1j7kn?spm_id_from=333.337.search-card.all.click))，对于 3 D 空间中的旋转，一个更好的模型是沿着任意的一个轴，比如单位向量 $(0.662, 0.2, 0.7222)$ 旋转，而不是对一系列旋转矩阵进行复合。

##### 沿任意轴旋转
$\quad(R_x,R_y,R_z)\text{,}$ 表示任意旋转轴
1. 行向量
$$
\begin{bmatrix}{R_x}^2\left(1-\cos\theta\right)+\cos\theta&R_x R_y\left(1-\cos\theta\right)+R_z\sin\theta&R_x R_z\left(1-\cos\theta\right)-R_y\sin\theta & 0\\ R_x R_y\left(1-\cos\theta\right)-R_z\sin\theta&{R_y}^2\left(1-\cos\theta\right)+\cos\theta&R_y R_z\left(1-\cos\theta\right)+R_x\sin\theta  & 0\\ R_x R_z\left(1-\cos\theta\right)+R_y\sin\theta&R_y R_z\left(1-\cos\theta\right)-R_x\sin\theta&{R_z}^2\left(1-\cos\theta\right)+\cos\theta  & 0 \\ 0 & 0 & 0 & 1\end{bmatrix}
$$
2. 列向量
$$
\begin{bmatrix}{R_x}^2(1-\cos\theta)+\cos\theta&R_x R_y(1-\cos\theta)-R_z\sin\theta&R_xR_z(1-\cos\theta)+R_y\sin\theta&0\\ R_y R_x(1-\cos\theta)+R_z\sin\theta&{R_y}^2(1-\cos\theta)+\cos\theta&R_y R_z(1-\cos\theta)-R_x\sin\theta&0\\ R_z R_x(1-\cos\theta)-R_y\sin\theta&R_z R_y(1-\cos\theta)+R_x\sin\theta&{R_z}^2(1-\cos\theta)+\cos\theta&0\\ 0&0&0&1\end{bmatrix}
$$

### 组合

先缩放，然后旋转，再位移

## 投影
### 投影到主轴或主平面
#### 投影到主轴（2D）
zhu
$\mathbf P_x=\mathbf S\left(\begin{bmatrix}0&1\end{bmatrix},0\right)=\left[\begin{array}{cc}1&0\\ 0&0\end{array}\right]$

$\mathbf P_y=\mathbf S\left(\begin{bmatrix}1&0\end{bmatrix},0\right)=\left[\begin{array}{cc}0&0\\ 0&1\end{array}\right]$

#### 投影到主平面（3D）
主平面指 $xyz$ 坐标形成的面
$\mathbf P_{xy}=\mathbf S\left(\begin{bmatrix}0&0&1\end{bmatrix},0\right)=\left[\begin{array}{ccc}1&0&0\\ 0&1&0\\ 0&0&0\end{array}\right]$

$\mathbf{P}_{xz}=\mathbf{S}\left(\begin{bmatrix}0&1&0\end{bmatrix},0\right)=\left[\begin{array}{ccc}1&0&0\\ 0&0&0\\ 0&0&1\end{array}\right]$

$\mathbf{P}_{yz}=\mathbf{S}\left(\begin{bmatrix}1&0&0\end{bmatrix},0\right)=\begin{bmatrix}0&0&0\\ 0&1&0\\ 0&0&1\end{bmatrix}$

### 投影到任意线或平面
#### 投影到任意线（2D）
#### 投影到任意平面


