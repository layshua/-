
大器晚成，大音希声，大象无形。

## 常见基类

我们先来学习一下 UE4 的 5 个常见基类：
- UObject
- Actor
- Pawn
- Controller
- Character

![[5e01f6a77b6e69f39b08335af45f4650_MD5.jpg]]

### UObject 类

> [!question] 什么时候该继承自 UObject 类? 什么时候应该声明一个纯 C++类?
> 
> 当需要以下功能时继承 UObject 类。

UObject是 UE4 大部分类的基类。它提供了如下几种功能：

![[1973fd181d34b367eaa73e5a4fd549b7_MD5.jpg]]
1.  Garbage collection **垃圾收集**
    - C++的内存管理由程序员完成，何时释放内存很棘手。UE 提供了两个解决方案：
    - （1）继承自 UObject 类, 同时指向 UObject 类实例对象的指针成员变量，使用 `UPROPERTY` 宏进行标记。虚幻引擎的 UObject 架构会自动地**被 `UPROPERTY` 标记的变量**考虑到垃圾回收系统中，在没有其他地方引用时候，定期清理，释放内存。自动地进行对象的生命周期管理。
    - （2）采用**智能指针**。请注意, **只有非 UObject 类型，才能够使用智能指针进行自动内存释放**。
2. Reference updating **引用自动更新**
3. Reflection **反射**
    - 运行时能获取一个类，动态创建类的对象，并且能动态获取到类有哪些函数和成员变量等，UE4 的蓝图中大量使用了反射技术。
4. Serialization **序列化**
5. Automatic updating of default property changes **自动检测默认变量的更改**
6. Automatic property initialization **自动变量初始化**
7. Automatic editor integration **和虚幻引擎编辑器的自动交互**
8. Type information available at runtime **运行时类型识别**
    - 请注意，虚幻引擎打开了/GR-编译器参数。意味着你无法使用 C++标准的 RTTI 机制: `dynamic_cast`。UE 实现了一套自己的、更高效的运行时类型识别的方案。**如果你希望使用，请继承自 UObject 类，然后使用 `Cast<>` 函数来完成。**
9. Network replication **网络复制**
    - 当你在进行网络游戏开发 （c/s 架构）时, 你一定希望能够自动地处理变量的同步。而继承自 UObject 类，其被宏标记的变量能够自动地完成网络复制的功能。从服务器端复制对应的变量到客户端。

综上所述，当你需要这些功能的时候，你的这个类应该继承自 UObject 类。
请注意: UObject 类会在引擎加载阶段，创建一个 Default Object 默认对象。这意味着:
- 构造函数并不是在游戏运行的时候调用，同时即便你只有一个 UObject 对象存在于场景中, 构造函数依然会被调用两次。
- 构造函数被调用的时候，UWorld 不一定存在。`GetWorld()`返回值有可能为空!


### Actor 类

> [!question] 什么时候该继承自 Actor 类
> 

Actor 的字面意思是演员。

在 UE4 中 Actor 拥有这样的能力：**它能够被挂载组件**。

![[1040341fdeaf2123fdf8add79225f020_MD5.jpg]]

如上，如果需要它被渲染，可以挂一个 静态模型组件，或者骨骼模型组件，如果需要它移动，可以挂一个移动组件。

### Pawn 类

在国际象棋中，pawn 代表的是：

![[eee81f393376a8786c638b6eabe292ed_MD5.jpg]]

也就是说，它提供了被 “操作” 的特性。它能被后面要提到的 “Controller” 所操纵。

### Character 类

它继承自 Pawn，提供了一个特殊组件：Character Movement。这个组件提供了一个基础的，基于胶囊体的角色移动功能。包括移动和跳跃，还能扩展出蹲伏和爬行等。所以如果你的游戏角色是人类的话，特别适合使用 Character 类。

![[b822fae4a1d16b63aeccd92312078af9_MD5.jpg]]

### Controller 类

Controller 是用来操控 Pawn/Character 的人。 可以把它看作是下棋的棋手，或者提线木偶的操作者。

![[48a96ad32e3217302ffcf634ee29a044_MD5.jpg]]

它既可以是玩家，比如 Player Controller，通过键盘或者手柄输入来操作游戏角色，也可以是电脑 AI，比如 AI Controller 来操作游戏中的 NPC 和怪物等角色。

它通过 Possess 来接管并控制一个角色，然后通过 UnPossess 来结束接管一个角色。

![[2335a0d74602ec1194ba6a229a8946f8_MD5.jpg]]

至此，第一节的笔记就分享完成了。后面应该会直接讲模块机制，或者 对象模型相关。敬请期待！