## 前言

UE5.2 中，增强输入是默认设置，可直接使用

Plugins-Input-Enhanced Input

![[8200e9b095d7e30de6af3455e4d27e42_MD5.jpg]]

Project Settings -Engine-Input-Default Classes

![[de81e716e3e4601977e411a14637342e_MD5.png]]

input 已经不建议使用了 (Deprecated)，弃用的原因主要是不好用（特别是在组合键上）和性能问题。

## 简单用法：控制角色跳跃与移动

### 增强输入 - Input Action

定义一个输入动作，等同于一个自定义事件，声明输出值类型、触发时机，修改器可用于调整输出值

内容管理器右键 - Input-Input Action(IC)

![[8c9325bd8f38419a9c9ad0bfaa06314b_MD5.jpg]]

新建 IA_jump1 和 IA_move1：

IA_jump1 定义 bool 输出值:

控制跳跃只需要一个 bool 值或浮点数（一个轴的值）即可

![[1d0d80bae09d0a14bca2abd0514c3fa0_MD5.jpg]]

IA_move1 定义 2D 向量（两个轴的值）输出值，通过获取 x 轴与 y 轴序列值来分别控制左右移动与前后移动

![[a2f101de2ed17186abef0129eb515ec7_MD5.jpg]]

也可以通过定义两个浮点数的 input action 来分别控制左右移动与前后移动

### 增强输入 - Input Mapping Context(IMC)

IMC 定义 IC 与按键的绑定关系，实现按键触发动作事件

在 IMC 中也可以添加约束：触发器、修改器，和 IC 中的触发器、修改器会叠加生效，下面会详细说明

新建 IMC_Test

内容管理器右键 - Input-Input Mapping Context

![[ec0ded96c4a298d4e7575a08e3055cc4_MD5.jpg]]

IMC_Test：

空格控制跳跃，AD 控制左右移动，WS 控制前后移动

![[f4944342091e45dbbd8bd5123d4fef11_MD5.jpg]]

### 角色蓝图

新建角色蓝图 BP_Test：

![[2fc5dacbe39d40269e1fd5a0cf488a90_MD5.jpg]]

设置 mesh，添加机械臂与相机

调整 mesh 方向、调整机械臂高度与距离

角色蓝图下有个 character movement 组件，角色蓝图中的 jump、add movement input、add controller yaw input 等，控制跳跃、移动、旋转，皆依赖此组件实现

![[6f16d8e0450bef7db6b4e6eb016a4e77_MD5.jpg]]

设置角色蓝图由 player0 控制

![[1d0d2dffed4e7bd1ce4a96dc22734266_MD5.jpg]]

蓝图添加动作映射：

通过 Enhanced Input Local Player Subsystem，将玩家控制器与 IMC 作代理绑定

绑定后 IMC 能够获取到玩家控制器的输入

IMC 再根据按键声明匹配，去触发 IC

蓝图可以添加多个 IMC，优先级高的起作用

Priority：优先级，数字约大，优先级越高

![[ea3d996019b3834469e921cb12e683eb_MD5.jpg]]

蓝图添加按键监听：

事件名即 IC 文件名，在 IMC 中一一对应

![[835ae481edf67456e118b1e8bcd6c499_MD5.jpg]]

![[b71f0a5d02c003c1789e225bca11ad11_MD5.jpg]]

IC_move1 的输出值是一个二维向量，可以拆分成 x 轴与 y 轴

按键 D 声明获取默认值，事件回调输出值为 x=1,y=0 的二维向量

按键 A 声明获取相反值，事件回调输出值为 x=-1,y=0 的二维向量

按键 W 声明交换输入轴的值，默认的 XYZ，将交换后输出 YXZ，事件回调输出值为 x=0,y=1 的二维向量

按键 S 声明交换输入轴的相反值，默认的 XYZ，将交换后输出 YXZ，事件回调输出值为 x=0,y=-1 的二维向量

对于 EnhancedInputAction IA_move1 事件而言，它负责监听按键，当按键输入与 IMC 表上声明的按键匹配，事件触发，在回调中返回输出值，输出 IC 中定义好的值

执行回调再值用于控制角色移动

### 效果呈现

新建关卡地图，将角色蓝图拖到地图中，点击运行

  
添加图片注释，不超过 140 字（可选）

### 三者关系

角色蓝图添加 IMC，IMC 添加 IC

角色蓝图添加 IC, 作按键监听, 蓝图双击事件，可以调到 IC

这样子 IMC 只作用于当前的角色蓝图，而非全局，缩小影响范围，也方便定义多套按键声明

![[79c79a13bcc385cbe5737e8153d540ce_MD5.jpg]]

### 补充：镜头旋转

IA_look1:

![[50e3f61d27bf57adacf188275a53eb62_MD5.jpg]]

通过 2D 轴值输出 XY 轴向数值

IMC_Test1:

Y 轴值取反，使镜头上下旋转的方向与鼠标方向一直

![[6dfde71fcae1abc770991fd8f1722582_MD5.jpg]]

角色蓝图，X 轴控制左右旋转，Y 轴控制上下旋转

![[d865780b81107439167626cc16dbaa11_MD5.jpg]]

设置机械臂：

允许鼠标进行旋转控制，否则上下旋转不生效

![[e11e83e4e5436a892b1d82ad57f2fb36_MD5.jpg]]

优化角色移动：

上下旋转镜头后，角色移动会变慢，因为角色正前方的向量被分解了

所以只获取正前方的向量值

![[bb20d7c7b1e3d6be4fd1d9f2662b0264_MD5.jpg]]

旋转镜头角色不跟着旋转：

![[ea15f9b3d47278684df4d423280fdef5_MD5.png]]

use controller rotation yaw 要取消勾选

![[cbd1edd0b46cd2e696ba290f0d2635b8_MD5.png]]

## 解析

新建 IA_test 用于测试

IMC:

![[45070408f63daefe72f01a86b4055b56_MD5.jpg]]

角色蓝图：

  
添加图片注释，不超过 140 字（可选）

查看在事件开始、结束与触发过程中的输出值

### IC 输入值类型

控制事件输出值类型

*   整数 / 布尔值：事件开始与触发输出 true，结束输出 false

  
添加图片注释，不超过 140 字（可选）

*   浮点数 / X 轴值：事件开始与触发输出 1.0，结束输出 0.0

![[dd9bb7d18e2762801121789774d9884f_MD5.jpg]]

*   二维向量 / XY 轴值：事件开始与触发输出 x=1.000 y=0.000，结束输出 x=0.000 y=0.000

![[82d4d038afc005722acf908a6363a60f_MD5.jpg]]

*   三维向量 / XYZ 轴值：事件开始与触发输出 x=1.000 y=0.000 z=0.000，结束输出 x=0.000 y=0.000 z=0.000

  
添加图片注释，不超过 140 字（可选）

### IC 修改器 - IM

*   Negate：值取反，事件开始与触发输出 x=-1.000 y=-0.000 z=-0.000，结束输出 x=-0.000 y=-0.000 z=-0.000

对常量 / 布尔的输入值类型不起作用，还是在事件开始与触发输出 true，结束输出 false

  
添加图片注释，不超过 140 字（可选）

*   SwizzleInputAxisValues：互换轴值，当输入值为两个轴以上的时候，可以将输出值顺序从 XYZ 调整为其他顺序

输出值若为一个轴或 bool 值，将无法获得输出值

以三维向量为例：

  
添加图片注释，不超过 140 字（可选）

此时 Z 轴有值

![[9ed3530e4c6e313ab42f419ba953e3de_MD5.jpg]]

*   Scalar：缩放一个标量

将输出值缩放 2 倍

![[341f7a0a2b7e8fb20092c3522e0495c8_MD5.jpg]]

![[09afd22683bad8ed24daa69e52d1f257_MD5.jpg]]

* 注意：此处对修改器的顺序有要求，对调轴值后，输出值在 Y 轴，此时对 Y 轴进行缩放才有效，否则无效

无脑操作可以三个缩放值同时修改

其他的修改器有（多与摇杆有关，具体可向 GPT 提问）：

*   DeadZone： 限定触发值的范围
*   FOVScaling： FOV 缩放
*   CurveExponential：指数曲线，XYZ
*   CurveUser：自定义指数曲线，CurveFloat
*   Smooth：多帧之间平滑
*   ToWorldSpace：输入设备坐标系向世界坐标系转换

当将修改器设置为 ToWorldSpace 时，输入设备的输入值将被转换为世界空间（World Space）中的向量，而不是相对于游戏角色的本地空间（Local Space）中的向量。这意味着，无论游戏角色朝向何方，输入设备的输入值都将产生相同的效果，从而减少了玩家在控制角色时需要考虑本地坐标系的复杂性。

举例来说，如果你将一个摇杆的输入值（X，Y）转换为世界空间中的向量，那么这个向量的方向将与摇杆的偏移方向相同，但是大小将根据摇杆的偏移量来确定。这个向量的大小可以通过修改器的 Scale 属性进行缩放，从而控制游戏角色的移动速度。

需要注意的是，将修改器设置为 ToWorldSpace 可能会对游戏的响应速度产生一定的影响，因为它需要对输入值进行矩阵变换以将其从本地空间转换到世界空间。同时，ToWorldSpace 的效果也可能会因不同的游戏和输入设备而有所不同。

### IMC 与 IC 可同时设置 IM、IT

修改器和触发器可以在 Maping 和 InputAciton 中同时设置：

*   Mapping.Modifiers / Triggers 针对当前 IMC 场景，和按键强相关的
*   InputAction.Modifiers / Triggers 针对全局，不需要关心按键，主要关心值怎么动，处理逻辑相关的，
*   执行熟悉怒

先 IMC 后 IC

![[bb354f4d73f12e07b8063433f34098d1_MD5.jpg]]

先交换轴值，再缩放 X 轴值 2 倍，输出值为 0,1,0

![[aecb2dafe451c04c676d6b3f34682d3e_MD5.jpg]]

IC 中将 Y 轴缩放值改为 2，输出 0,2,0

![[76c99246a1988065e21f79354cdd24f3_MD5.jpg]]

IC 的 IM 会覆盖 IMC 的 IM

IMC 和 IC 定义相同的 IM 时，IC 的 IM 最终生效

![[c569fea167b6e2290c3aaf49b40bdd03_MD5.jpg]]

![[47c460074da77aa02f9874372ce01f40_MD5.jpg]]

此时输出 0,0,1

![[71d532e713b497a2bec30d2330882882_MD5.jpg]]

### IC 触发器 - IT

*   None：此时使用的是 Down 类型

1.  按下按键触发 Started
2.  保持按下会不断触发 Triggered 事件
3.  松开按键触发 Completed

*   Pressed：

按下按键依次触发 Started、Triggered 与 Completed，松开按键不触发任何事件。

*   Down：可用于机枪的连续射击，Started 开始射击，Completed 停止射击，Triggered 检查弹夹。

1.  按下按键触发 Started 事件
2.  保持按下会不断触发 Triggered 事件
3.  松开按键触发 Completed 事件

*   Hold：

1.  IsOneShot 没有勾选时：可用于按下保持一段时间，松开才会触发的动作。如吃鸡里手雷投掷。
2.  按下按键触发 Started，保持按下不断触发 Ongoing，松开时如果保持的时间达到或超过 HoldTimeThreshold 设置的时间则触发 Completed，否则触发 Canceled。
3.  IsOneShot 勾选：用于按下保持一段时间后自动触发的动作，如 CS 里拆包。
4.  按下按键触发 Started，保持按下不断触发 Ongoing，在达到 HoldTimeThreshold 设置的时间前松开触发 Canceled。保持按下达到 HoldTimeThreshold 设置的时间后会依次触发 Triggered 与 Completed。

*   HoldAndRelease：与 Hold 类型不勾选 IsOneShot 类似。

1.  按下按键触发 Started
2.  保持按下不断触发 Ongoing
3.  松开按键时如果保持的时间达到 HoldTimeThreshold 设置的时间会依次触发 Triggered 与 Completed，否则触发 Canceled。

*   Pulse：用于保持按下时每隔一段时间触发一次的动作。如按下吃药键，每隔一段时间执行一次吃药的动作

1.  按下时触发 Started 事件
2.  如果勾选 TriggerOnStart 则立即触发一次 Triggered 事件，不勾选则间隔一段时间后触发 Triggered。
3.  保持按下触发 Ongoing 事件。
4.  距上一次 Trigger 的时间间隔达到 Interval 设置的时间触发一次 Triggered 事件，随后判断 Trigger 触发的数量是否达到 TriggerLimit 的限制 (TriggerLimit<=0 表示不限制次数)，未达到则继续上一步，否则触发 Completed。

*   Release：作用与 Down 类似

1.  按下时触发 Started 事件
2.  保持按下触发 Ongoing 事件
3.  松开时依次触发 Triggered 与 Completed

*   Tap 按下后快速抬起（默认 0.2）：

1.  按下按键触发 Started 事件
2.  保持按下触发 Ongoing 事件
3.  如果保持的时间超过 TapReleaseTimeThreshold 设置的时间触发 Canceled 事件。
4.  松开按键时保持的时间小于 TapReleaseTimeThreshold 设置的时间依次触发 Triggered 与 Completed 事件。

*   Chorded Action：用于多个 Action 的串联形成组合键。

示例

![[9e4d90c7941f3920a964d5ed26f0ae2b_MD5.jpg]]

1.  按下 Q+A/B/C 中一个或两个键，触发 Started 事件，后触发 Ongoing 事件
2.  此时松开 Q，或松开其他键只按住 Q，触发 Cancel 事件
3.  当 Q+A+B+C 触发 Triggered 事件，按住持续触发，松开其中一个键松开按键触发 Completed 事件

*   Combo：用于类似上上下下左右左右 BABA 在短时间内完成的组合键。

1.  按下第一个键触发 Started
2.  过程当中不断触发 Ongoing
3.  如果某个键按下的时间没有达到 TimeToPressKey 或者按错键触发 Canceled
4.  当所有的键完成后依次触发 Triggered 与 Completed

IT 设置 Combo 后，不需要按键触发，是通过 IC 组合来触发

示例：按下 AABBCC 触发：

![[696599e5b2744eed75358f0502fb2cd6_MD5.jpg]]

IA_Action123 设默认值即可

## 调试

命令行输入

```
showdebug enhancedinput
```

## 引用

[牵线木偶：UE5 InputAction 使用手册](https://zhuanlan.zhihu.com/p/615553951)  
[Unreal Engine 增强输入框架 EnhancedInput](https://juejin.cn/post/7195746542069628988#heading-8)