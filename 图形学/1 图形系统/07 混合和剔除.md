
---
title: 08 混合和剔除
aliases: [08 Blending and Culling]
tags: []
create_time: 2023-06-20 10:30
uid: 202306201030
banner: "![[Pasted image 20230620103015.png]]"
---
# 定义
_Blend_ 就是把两种颜色混在一起。具体就是把某一像素位置**原来颜色和将要会上去的颜色**，通过某种**方式**或者**算法**混在一起，从而实现新的效果。
例如：PS 内的**正片叠底**，**叠加**都属于混合模式的一种。
![[Pasted image 20221208200713.png]]
# 混合指令
**混合指令以 `Blend` 关键词开始，后面接混合模式**。它可以在 Subshader 中使用，也可以在 Pass 中使用。
- 在 SubShader 中使用会影响到 SubShader 中的所有 pass
- 在 Pass 中使用只会对当前 Pass 起作用。

-   混合命令**开启后**，会**禁用 GPU 上的一些优化**（主要是隐藏表面/**去除 Early-Z**），这会使**GPU 帧时间增加**。
-   默认操作符是 Add。
-   **单独的 RGB 和 Alpha 混合与高级 OpenGL 混合操作不兼容**。

> [!NOTE] 参数解释
>  - `Src`： 该片元产生的颜色 Source（源颜色）
   >-  `Dst`： 已经存在于颜色缓存的颜色被称为 Destination（目标颜色）
   >- `SrcFactor` ：源颜色的**混合系数**
   >- `Dst Factor` ：目标颜色的混合系数

**可用的混合模式如下：**
1.  `Blend Off`：关闭混合处理，当 Shader 中没有添加任何混合指令的时候，**默认就是关闭状态。**

2.  `BlendSrcFactor DstFactor`：开启混合处理，允许自定义混合模式。源颜色和目标颜色按照如下公式进行颜色混合：$Color_{rgba}=Source_{rgba}·SrcFactor+Destination_{rgba}·DstFactor$

3.  `Blend SrcFactor DstFactor，SrcFactorA DstFactorA`：跟上述指令类似，但是**对于源颜色和目标颜色的 alpha 通道分别使用 SrcFactorA 和 DstFactorA 进行混合**：
$Color_{rgb}=Source_{rgb}·SrcFactor+Destination_{rgb}·DstFactor$
$Color_a=Source_a·SrcFactorA+Destination_a·DstFactorA$

1. `BlendOp Op`：使用其他**混合操作**进行颜色混合，而不再只是进行颜色相加。
2. `BlendOpOpColor，OpAlpha`：跟上述指令类似，但是对于颜色和 alpha 通道分别使用 OpColor 和 OpAlpha 不同的操作。

# 混合系数
当混合操作中使用了逻辑操作的时候，混合系数则不会被计算。
![[Pasted image 20230620134604.png]]

Unity 还提供了一些常用的混合指令：
![[Pasted image 20230620134620.png]]

# 混合操作
![[Pasted image 20230620134637.png]]

![[AP01_L13_18.jpg]]

# 剔除 Culling

**法线剔除：** 也被称为背面消隐，根据法线朝向判断哪个面被剔除掉。可以用来控制是否双面渲染。

**语法：**  Cull Off/ Front / Back

**面裁剪：** clip 函数会将**参数小于 0 直接在片元着色器直接丢弃**，常用于**制作溶解，裁剪等效果**。
 void clip (float4 x); void clip (float3 x); void clip (float2 x); void clip (float1 x); void clip (float x);
 **给定参数任何一个分量是负数，就舍弃当前像素的输出颜色**
 
 clip 函数等同于一下代码：
 ```cs
 void clip (float4)
 {
     if ((any<0))
     discard;
 }
```



**语法：** clip ()；默认会切掉 0 的部分。


