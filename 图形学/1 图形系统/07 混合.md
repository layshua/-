
---
title: 08 混合
aliases: [08 Blend]
tags: []
create_time: 2023-06-20 10:30
uid: 202306201030
banner: "![[Pasted image 20230620103015.png]]"
---
# 定义
_Blend_ 就是把两种颜色混在一起。具体就是把某一像素位置**原来颜色和将要会上去的颜色**，通过某种**方式**或者**算法**混在一起，从而实现新的效果。
例如：PS 内的**正片叠底**，**叠加**都属于混合模式的一种。
![[Pasted image 20221208200713.png]]
# 混合指令
**混合指令以 Blend 关键词开始，后面接混合模式**。它可以在 Subshader 中使用，也可以在 Pass 中使用。
- 在 SubShader 中使用会影响到 SubShader 中的所有 pass
- 在 Pass 中使用只会对当前 Pass 起作用。

**可用的混合模式如下：**
1.  `Blend Off`：关闭混合处理，当 Shader 中没有添加任何混合指令的时候，默认就是关闭状态。
2.  `BlendSrcFactor DstFactor`：开启混合处理，允许自定义混合模式。
    - 新渲染出来的图像被称为 Source（源图像），简称 Src；
    - 已经绘制完的图像被称为 Destination（目标图像），简称 Dst。
    - SrcFactor 为源图像的混合系数
    - Dst Factor 为目标图像的混合系数
    - 最终源图像和目标图像按照如下公式进行图像混合：$Color_{rgba}=Source_{rgba}·SrcFactor+Destination_{rgba}·DstFactor$
3.  `Blend SrcFactor DstFactor，SrcFactorA DstFactorA`：跟上述指令类似，但是对于源图像和目标图像的 alpha 通道分别使用 SrcFactorA 和 DstFactorA 进行混合，计算公式如下

# 混合模式的公式

![[Pasted image 20221208200957.png]]
![[AP01_L13_18.jpg]]

最终颜色 = Shader 计算后的颜色值 (当前计算出来的颜色，Output) * 源因子 (_SrcFactor_) + 累积颜色 (颜色缓冲区中的颜色) * 目标因子 (_DstFactor_).

**累计颜色**可以理解为渲染当前物体后面的颜色即**GBuffer 中的像素**（**颜色缓冲区中的颜色**）。

混合模式控制的就是源因子和目标因子，在脚本里会看到的就是 ：Blend SrcFactor DstFactor。

![[a01f8df47bb0de6e833b1734e0521d9b_MD5.png]]

![[219b9bb96b46c4cac58bf7216a48c97c_MD5.png]]

## Unity ShaderLab 支持的混合因子

![[f8b3d6db1d94bc6f62a2090e4380bbaa_MD5.png]]

## 混合模式的操作符
常见：
![[Pasted image 20221208201153.png]]

## 剔除

**法线剔除：** 也被称为背面消隐，根据法线朝向判断哪个面被剔除掉。可以用来控制是否双面渲染。

**语法：**  Cull Off/ Front / Back

**面裁剪：** clip 函数会将**参数小于 0 直接在片元着色器直接丢弃**，常用于**制作溶解，裁剪等效果**。

**语法：** clip ()；默认会切掉 0 的部分。

## 总结

-   混合命令**开启后**，会**禁用 GPU 上的一些优化**（主要是隐藏表面/**去除 Early-Z**），这会使**GPU 帧时间增加**。
-   默认操作符是 Add。
-   **单独的 RGB 和 Alpha 混合与高级 OpenGL 混合操作不兼容**。
