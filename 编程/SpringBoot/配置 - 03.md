### 文章目录

*   [SpringBoot - 配置 - 03](#SpringBoot03_1)
*   *   [1. 配置文件分类](#1_3)
    *   [2.yaml](#2yaml_26)
    *   *   [2.1yaml 定义](#21yaml_28)
        *   [2.2yaml 基本语法](#22yaml_60)
        *   [2.3yaml 数据格式](#23yaml_69)
        *   [2.4yaml 参数引用](#24yaml_101)
    *   [3. 读取配置文件内容](#3_109)
    *   *   [3.1@Value](#31Value_133)
        *   [3.2Environment](#32Environment_165)
        *   [3.3@ConfigurationProperties](#33ConfigurationProperties_187)
    *   [4.profile](#4profile_221)
    *   *   [4.1profile 配置方式](#41profile_225)
        *   [4.2profile 激活方式](#42profile_281)
    *   [5. 内置配置加载顺序](#5_324)
    *   [6. 外部配置加载顺序](#6_338)

# SpringBoot - 配置 - 03

该文章参考：[黑马 SpringBoot](https://www.bilibili.com/video/BV1Lq4y1J77x?spm_id_from=333.999.0.0)

## 1. 配置文件分类

SpringBoot 是基于约定的，所以很多配置都有默认值，但如果想使用自己的配置替换默认配置的话，就可以使用 `application.properties`或者`application.yml(application.yaml)`进行配置。

*   [properties](https://so.csdn.net/so/search?q=properties&spm=1001.2101.3001.7020)：
    
    ```
    server.port=8080
    ```
    
*   [yaml](https://so.csdn.net/so/search?q=yaml&spm=1001.2101.3001.7020)：
    
    ```
    server:
    port: 8080
    ```
    

总结：

*   SpringBoot 提供了 2 种配置文件类型：`properteis`和`yml/yaml`
*   默认配置文件名称：`application`
*   在同一级目录下优先级为：`properties > yml > yaml`

## 2.yaml

### 2.1yaml 定义

yaml：YAML 全称是 YAML Ain’t Markup Language 。YAML 是一种直观的能够被电脑识别的的数据数据序列化格式，并且容易被人类阅读，容易和脚本语言交互的，可以被支持 YAML 库的不同的编程语言程序导入，比如： C/C++, Ruby, Python, Java, Perl, C#, PHP 等。YML 文件是以数据为核心的，比传统的 xml 方式更加简洁。 YAML 文件的扩展名可以使用`.ym`l 或者`.yaml`。

对比：

*   properties：
    
    ```
    server.port=8080
    server.address=127.0.0.1
    ```
    
*   xml：
    
    ```
    <server>
        <port>8080</port>
        <address>127.0.0.1</address>
    </server>
    ```
    
*   yaml：
    
    ```
    server: 
    port: 8080
    address: 127.0.0.1
    ```
    

可以看出：对比其他两种方式，**yaml 更简洁，以数据为核心**。

### 2.2yaml 基本语法

*   大小写敏感
*   数据值前边必须有空格，作为分隔符
*   使用缩进表示层级关系
*   缩进时不允许使用 Tab 键，只允许使用空格（各个系统 Tab 对应的 空格数目可能不同，导致层次混乱）。
*   缩进的空格数目不重要，只要相同层级的元素左侧对齐即可
*   `#`表示注释，从这个字符一直到行尾，都会被解析器忽略。

### 2.3yaml 数据格式

*   对象（map）：键值对的集合
    
    ```
    person:
    name: zhangsan
    # 行内写法
    person: {name: zhangsan}
    ```
    
*   数组：一组按次序排列的值
    
    ```
    address:
    - beijing
    - shanghai
    # 行内写法
    address: [beijing,shanghai]
    ```
    
*   纯量：单个的，不可再分的值
    
    ```
    msg1: 'hello \n world' # 单引忽略转义字符
    msg2: "hello \n world" # 双引识别转义字符
    ```
    

### 2.4yaml 参数引用

```
name: lisi
person:
name: ${name} # 引用上边定义的name值
```

## 3. 读取配置文件内容

先预先准备好测试的 ymal 文件：

```
name: xpp

person:
  name: ${name}
  age: 23
  address:
    - benjing
    - shanghai

address:
  - benjing
  - shanghai

msg1: 'hello \n springboot'
msg2: "hello \n springboot"
```

### 3.1@Value

```
@Value("${name}")
private String name;
@Value("${person.name}")
private String name1;
@Value(("${address[0]}"))
private String address1;
@Value("${msg1}")
private String msg1;
@Value("${msg2}")
private String msg2;

@RequestMapping("/hello2")
public String hello2(){
    System.out.println(name);
    System.out.println(name1);
    System.out.println(address1);
    System.out.println(msg1);
    System.out.println(msg2);
    return "Hello SpringBoot !";
}
输出结果：
xpp
xpp
benjing
hello \n springboot
hello 
springboot
```

### 3.2Environment

```
@Autowired
private Environment env;

@RequestMapping("/hello2")
public String hello2(){
    System.out.println(env.getProperty("name"));
    System.out.println(env.getProperty("person.age"));
    System.out.println(env.getProperty("address[0]"));

    return "Hello SpringBoot !";
}
输出：
xpp
benjing
```

### 3.3@ConfigurationProperties

准备一个 Person 类：

```
@Component//表示这个类被spring识别了
@ConfigurationProperties(prefix = "person")//绑定前缀
//下面四个注解为LomBok提供的，简化开发，自动帮我们写好get，set，有参，无参和toString方法
@Data
@NoArgsConstructor
@AllArgsConstructor
@ToString
public class Person {
    private String name;
    private Integer age;
    private String[] address;
}
```

测试：

```
@Autowired
private Person person;

@RequestMapping("/hello2")
public String hello2(){
    System.out.println(person);
    return "Hello SpringBoot !";
}
输出结果：
Person(name=xpp, age=23, address=[benjing, shanghai])
```

## 4.profile

我们在开发 Spring Boot 应用时，通常同一套程序会被安装到不同环境，比如：开发、测试、生产等。其中数据库地址、服务器端口等等配置都不同，如果每次打包时，都要修改配置文件，那么非常麻烦。**profile 功能就是来进行动态配置切换的。**

### 4.1profile 配置方式

**（1）多 profile 文件方式**

提供多个配置文件，每一个代表一种环境：

*   `application-dev.properties/yml` 开发环境
*   `application-test.properties/yml` 测试环境
*   `application-pro.properties/yml` 生产环境

**注意！**：格式必须为`application-xxx.properties/yml`

![](<images/1683635584149.png>)

在主配置文件`application.properties`选择用哪种环境：

**格式**：`spring.profiles.active=xxx`

```
spring.profiles.active=dev
```

**（2）yaml 多文档方式**

`---`用来划分 yaml 文件区域

```
---

server:
 port: 8081
spring:
 config:
 activate:
 on-profile: dev
---
server:
 port: 8082
spring:
 config:
 activate:
 on-profile: test
---
server:
 port: 8083
spring:
 config:
 activate:
 on-profile: pro
---
spring:
 profiles:
 active: test
```

### 4.2profile 激活方式

**（1）配置文件**

即上面所讲的：在配置文件中配置：`spring.profiles.active=dev`

**（2）虚拟机**

在`VM options` 指定：`-Dspring.profiles.active=xxx`

![](<images/1683635584193.png>)

**（3）命令行参数**

`java –jar xxx.jar --spring.profiles.active=xxx`

①直接在`Program arguments`配置

![](<images/1683635584245.png>)

②打包方式配置

![](<images/1683635584303.png>)

进入 target 文件夹（快捷键`Ctrl+Alt+F12`)

![](<images/1683635584405.png>)

在当前目录打开 cmd

![](<images/1683635584450.png>)

输入`java –jar xxx.jar`启动 SpringBoot 项目

![](<images/1683635584506.png>)

输入`java –jar xxx.jar --spring.profiles.active=xxx`即可更改环境  

![](<images/1683635584555.png>)

## 5. 内置配置加载顺序

Springboot 程序启动时，会从以下位置加载配置文件：

1.  `file:./config/`：当前项目下的 / config 目录下
2.  `file:./` ：当前项目的根目录
3.  `classpath:/config/`：classpath 的 / config 目录
4.  `classpath:/` ：classpath 的根目录（之前我们用的就是这种）

加载顺序为上文的排列顺序，高优先级配置的属性会生效

![](<images/1683635584604.png>)

## 6. 外部配置加载顺序

通过[官网](https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-external-config.html)查看外部属性加载顺序：

最后喜欢的小伙伴别忘了一键三连哦🎈🎈🎈  

![](<images/1683635584651.png>)