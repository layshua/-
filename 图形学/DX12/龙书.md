---
banner: "![[Pasted image 20230101204819.png]]"
banner_y: 0.33
---
# 1 Direct3D 初始化
# 1.1 预备知识
# DX12 概述
DX12较之上个版本主要改变：性能优化方面大大减少了 CPU 开销，改进了对多线程的支持。性能提升！
通过 Direct3D 这种底层**图形应用程序编程接口（Application Programming Interface, API)**, 即可在在应用程序中对**图形处理器 (Graphics Processing Unit, GPU)** 进行控制和编程。我们能够借此以硬件加速的方式渲染出虚拟的 3D 场景。
**render target（渲染目标）** 是为了渲染场景而将像素绘制到的特定缓冲区 (buffer)。通常是占用部分显存的后台缓冲区，以及纹理（详见后文）。
### 组件对象模型
**组件对象模型 (Component Object Model, COM)** 是一种令 DirectX 不受编程语言束缚，并且使之向后兼容的技术。
我们通常将 COM 对象视为一种接口，但考虑当前编程的目的，遂将它当作一个 C++类来使用。用 C++语言编写 DirectX 程序时，COM 帮我们隐藏了大量底层细节。

**不使用 C++的 new 和 delete**：
要获取指向某 COM 接口的指针，需借助特定函数或另一 COM 接口的方法一而不是用 C+语言中的关键字 new 去创建一个 COM 接口。
COM 对象会统计其引用次数；因此，在使用完某接口时，我们便应调用它的 Release 方法 (COM 接口的所有功能都是从 IUnknown 这个 COM 接口继承而来的，包括 Release 方法在内)，而不是用 delete 来别删除——当 COM 对象的引用计数为 0 时，它将自行释放自己所占用的内存。

为了**辅助用户管理 COM 对象的生命周期**，Windows 运行时库 (Windows Runtime Library, WRL)专门为此提供了 `Microsoft::WRL: ComPtr` 类 ( `#include <wrl.h>`), 我们可以把它当作是 **COM 对象的智能指针**。当一个 `ComPtr` 实例超出作用域范围时，它便会自动调用相应 COM 对象的 Release方法，继而省掉了我们手动调用的麻烦。本书中常用的 3 个 `ComPtr` 方法如下。
1. `Get`：返回一个指向此底层 COM 接口的指针。此方法常用于把原始的 COM 接口指针作为参数传递给函数。例如：
```c++ nums
ComPtr<ID3D12Rootsignature> mRootsignature;
......
//SetGraphicsRootsignature 需要获取 ID3D12 RootSignature*类型的参数
mCommandList->SetGraphicsRootsignature (mRootsignature.Get());
```

2. `GetAddressof`: 返回指向此底层 COM 接口指针的地址。凭此方法即可利用函数参数返回 COM接口的指针。例如：
```c++ nums
ComPtr<ID3D12CommandAllocator> mDirectCmdListAlloc;
ThrowIfFailed(md3dDevice->CreateCommandAllocator (
		D3D12 COMMAND LIST TYPE DIRECT,
		mDirectCmdListAlloc. GetAddressof ())
	);
```
3. `Reset` : 将此 ComPtr 实例设置为 nullptr 释放与之相关的所有引用（同时减少其底层 COM 接口的引用计数)。此方法的功能与将 ComPtr 目标实例赋值为 nullptr 的效果相同。

> [!NOTE] 
> COM 接口都以大写字母“I”作为开头。例如，表示命令列表的 COM 接口为  
> `ID3D12GraphicsCommandList`
