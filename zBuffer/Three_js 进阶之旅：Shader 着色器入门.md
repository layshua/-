https://juejin.cn/column/7140122697622618119
# RawShaderMaterial

## æ•ˆæœ

éšç€æœ¬æ–‡å†…å®¹ä¸€æ­¥æ­¥æ·±å…¥ï¼Œæœ€ç»ˆå°†ä½¿ç”¨ç€è‰²å™¨æ„å»ºä¸€ä¸ªå¦‚ä¸‹æ‰€ç¤ºçš„æ³¢åŠ¨æ——å¸œ `ğŸš©` æ•ˆæœï¼Œé€šè¿‡æ»‘åŠ¨è°ƒæ•´é¡µé¢å³ä¸Šæ–¹çš„ `dat.GUI` æ§åˆ¶å™¨ï¼Œå¯ä»¥è°ƒæ•´ `xè½´` å’Œ `yè½´` ä¸Šçš„æ³¢åŠ¨å¹…åº¦ã€‚

![](<images/1685672274361.png>)

æ‰“å¼€ä»¥ä¸‹é“¾æ¥ä¸­çš„ä»»æ„ä¸€ä¸ªï¼Œåœ¨çº¿é¢„è§ˆæ•ˆæœï¼Œå¤§å±è®¿é—®æ•ˆæœæ›´ä½³ã€‚

*   `ğŸ‘â€ğŸ—¨` åœ¨çº¿é¢„è§ˆåœ°å€ 1ï¼š[dragonir.github.io/3d/#/flag](https://link.juejin.cn?target=https%3A%2F%2Fdragonir.github.io%2F3d%2F%23%2Fflag "https://dragonir.github.io/3d/#/flag")
*   `ğŸ‘â€ğŸ—¨` åœ¨çº¿é¢„è§ˆåœ°å€ 2ï¼š[3d-eosin.vercel.app/#/flag](https://link.juejin.cn?target=https%3A%2F%2F3d-eosin.vercel.app%2F%23%2Fflag "https://3d-eosin.vercel.app/#/flag")

æœ¬ä¸“æ ç³»åˆ—ä»£ç æ‰˜ç®¡åœ¨ `Github` ä»“åº“[ã€threejs-odesseyã€‘](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdragonir%2Fthreejs-odessey "https://github.com/dragonir/threejs-odessey")ï¼Œ**åç»­æ‰€æœ‰ç›®å½•ä¹Ÿéƒ½å°†åœ¨æ­¤ä»“åº“ä¸­æ›´æ–°**ã€‚

`ğŸ”—` ä»£ç ä»“åº“åœ°å€ï¼š[git@github.com:dragonir/threejs-odeâ€¦](https://link.juejin.cn?target=)


## æ­£æ–‡

### ç€è‰²å™¨çš„ç±»å‹

#### é¡¶ç‚¹ç€è‰²å™¨ Vertex Shader

`Vertex Shader` ç”¨äºå®šä½å‡ ä½•ä½“çš„é¡¶ç‚¹ï¼Œå®ƒçš„å·¥ä½œåŸç†æ˜¯å‘é€é¡¶ç‚¹ä½ç½®ã€ç½‘æ ¼å˜æ¢ï¼ˆ`position`ã€æ—‹`rotation`å’Œ `scale` ç­‰ï¼‰ã€æ‘„åƒæœºä¿¡æ¯ï¼ˆ`position`ã€`rotation`ã€`fov` ç­‰ï¼‰ã€‚`GPU` å°†æŒ‰ç…§ `Vertex Shader` ä¸­çš„æŒ‡ä»¤å¤„ç†è¿™äº›ä¿¡æ¯ï¼Œç„¶åå°†é¡¶ç‚¹æŠ•å½±åˆ° `2D` ç©ºé—´ä¸­æ¸²æŸ“æˆ `Canvas`ã€‚

å½“ä½¿ç”¨ `Vertex Shader` æ—¶ï¼Œå®ƒçš„ä»£ç å°†ä½œç”¨äºå‡ ä½•ä½“çš„æ¯ä¸ªé¡¶ç‚¹ã€‚
- **åœ¨æ¯ä¸ªé¡¶ç‚¹ä¹‹é—´ï¼Œæœ‰äº›æ•°æ®ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè¿™ç±»æ•°æ®ç§°ä¸º `attribute`ï¼›**
- **æœ‰äº›æ•°æ®åœ¨é¡¶ç‚¹ä¹‹é—´æ°¸è¿œä¸ä¼šå˜åŒ–ï¼Œç§°è¿™ç§æ•°æ®ä¸º `uniform`ã€‚**

*   `attribute`ï¼šä½¿ç”¨é¡¶ç‚¹æ•°ç»„å°è£…æ¯ä¸ªé¡¶ç‚¹çš„æ•°æ®ï¼Œä¸€èˆ¬ç”¨äºæ¯ä¸ªé¡¶ç‚¹éƒ½å„ä¸ç›¸åŒçš„å˜é‡ï¼Œå¦‚é¡¶ç‚¹çš„ä½ç½®ã€‚
*   `uniform`ï¼šé¡¶ç‚¹ç€è‰²å™¨ä½¿ç”¨çš„å¸¸é‡æ•°æ®ï¼Œä¸èƒ½è¢«ä¿®æ”¹ï¼Œä¸€èˆ¬ç”¨äºå¯¹åŒä¸€ç»„é¡¶ç‚¹ç»„æˆçš„å•ä¸ª `3D` ç‰©ä½“ä¸­æ‰€æœ‰é¡¶ç‚¹éƒ½ç›¸åŒçš„å˜é‡ï¼Œå¦‚å½“å‰å…‰æºçš„ä½ç½®ã€‚

#### ç‰‡å…ƒç€è‰²å™¨ Fragment Shader

`Fragment Shader` åœ¨ `Vertex Shader` ä¹‹åæ‰§è¡Œï¼Œå®ƒçš„ä½œç”¨æ˜¯ä¸ºå‡ ä½•ä½“çš„æ¯ä¸ªå¯è§åƒç´ è¿›è¡Œç€è‰²ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡`uniforms` å°†æ•°æ®å‘é€ç»™å®ƒï¼Œä¹Ÿå¯ä»¥å°† `Vertex Shader` ä¸­çš„æ•°æ®å‘é€ç»™å®ƒï¼Œæˆ‘ä»¬å°†è¿™ç§ä» `Vertex Shader` å‘é€åˆ° `Fragment Shader` çš„æ•°æ®ç§°ä¸º `varying`ã€‚

`Fragment Shader` ä¸­æœ€ç›´æ¥çš„æŒ‡ä»¤å°±æ˜¯å¯ä»¥ä½¿ç”¨ç›¸åŒçš„é¢œè‰²ä¸ºæ‰€æœ‰åƒç´ è¿›è¡Œç€è‰²ã€‚å¦‚æœåªè®¾ç½®äº†é¢œè‰²å±æ€§ï¼Œå°±ç›¸å½“äºå¾—åˆ°äº†ä¸ `MeshBasicMaterial` ç­‰ä»·çš„æè´¨ã€‚å¦‚æœæˆ‘ä»¬å°†å…‰ç…§çš„ä½ç½®å‘é€ç»™ `Fragment Shader`ï¼Œç„¶åæ ¹æ®åƒç´ æ”¶åˆ°å…‰ç…§å½±å“çš„å¤šå°‘æ¥ç»™åƒç´ ä¸Šè‰²ï¼Œæ­¤æ—¶å°±èƒ½å¾—åˆ°ä¸ `MeshPhongMaterial` æ•ˆæœç­‰ä»·çš„æè´¨ã€‚

*   **`varying`: ä»é¡¶ç‚¹ç€è‰²å™¨å‘é€åˆ°ç‰‡å…ƒç€è‰²å™¨ä¸­çš„æ’å€¼è®¡ç®—æ•°æ®**


### åŸå§‹ç€è‰²å™¨æè´¨ RawShaderMaterial

åœ¨ `Three.js` ä¸­å¯ä»¥æ¸²æŸ“ç€è‰²å™¨çš„æè´¨æœ‰ä¸¤ç§ï¼š`RawShaderMaterial` å’Œ `ShaderMaterial`ï¼Œå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«æ˜¯ `ShaderMaterial` ä¼šè‡ªåŠ¨å°†ä¸€äº›åˆå§‹åŒ–ç€è‰²å™¨çš„å‚æ•°æ·»åŠ åˆ°ä»£ç ä¸­ï¼ˆå†…ç½® `attributes` å’Œ `uniforms`ï¼‰ï¼Œè€Œ `RawShaderMaterial` åˆ™ä»€ä¹ˆéƒ½ä¸ä¼šæ·»åŠ ã€‚

æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ `RawShaderMaterial` æè´¨ï¼Œé¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¹³é¢ï¼Œç„¶åå’Œåˆ›å»ºå…¶ä»–æè´¨ä¸€æ ·ï¼Œé€šè¿‡ `new THREE.RawShaderMaterial` åˆå§‹åŒ–åŸå§‹ç€è‰²å™¨æè´¨ï¼Œå¹¶ç»™å®ƒæ·»åŠ ä¸¤ä¸ªå‚æ•° `vertexShader` å’Œ `fragmentShader` ä»£è¡¨æè´¨çš„**é¡¶ç‚¹ç€è‰²å™¨**å’Œ**ç‰‡å…ƒç€è‰²å™¨**ã€‚

```
const material = new THREE.RawShaderMaterial({
  vertexShader: '',
  fragmentShader: ''
})
```

ç„¶åå¼€å§‹ç¼–å†™æè´¨çš„é¡¶ç‚¹ç€è‰²å™¨å’Œç‰‡å…ƒç€è‰²å™¨ï¼Œåˆ†åˆ«æ·»åŠ å¦‚ä¸‹çš„ä»£ç ã€‚

```
const material = new THREE.RawShaderMaterial({
  vertexShader: `
    uniform mat4 projectionMatrix;
    uniform mat4 viewMatrix;
    uniform mat4 modelMatrix;

    attribute vec3 position;

    void main() {
      gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.0);
    }
  `,
  fragmentShader: `
    precision mediump float;

    void main(){
      gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
    }
  `
});
```

æ­¤æ—¶å¯ä»¥å¾—åˆ°ä¸€ä¸ª**çº¢è‰²**çš„å¹³é¢ï¼Œè¯´æ˜æˆ‘ä»¬ç¼–å†™çš„ç¬¬ä¸€ä¸ªç€è‰²å™¨è¿è¡ŒæˆåŠŸäº† `ğŸ‰`ã€‚

![](<images/1685672274949.png>)

#### åˆ†ç¦»ä¸¤ç§ç€è‰²å™¨

åœ¨å®é™…å¼€å‘ä¸­ï¼Œç€è‰²å™¨æ¯”è¾ƒå¤æ‚ï¼Œä»£ç é‡æ¯”è¾ƒå¤šï¼Œå¦‚æœç›´æ¥æ”¾åœ¨æè´¨ä¸­çš„è¯ä¼šå¢åŠ ä»£ç é˜…è¯»å›°éš¾é‡ã€‚æˆ‘ä»¬å¯ä»¥å°†ç€è‰²å™¨ä»£ç å•ç‹¬æ‹†åˆ†å‡ºæ¥ï¼Œåˆ†åˆ«å­˜æ”¾åœ¨ `vertex.glsl` å’Œ `fragment.glsl` æ–‡ä»¶ä¸­ï¼Œç„¶ååœ¨ä»£ç ä¸­åƒä¸‹é¢è¿™æ ·å¼•å…¥å³å¯ã€‚è¿™æ ·åšè¿˜æœ‰ä¸€ä¸ªå¥½å¤„å°±æ˜¯å¯ä»¥å®‰è£…ä»£ç ç¼–è¾‘å™¨çš„ `GLSL` é«˜äº®è¯­æ³•æ’ä»¶ï¼Œæé«˜ç¼–ç¨‹æ•ˆç‡ã€‚

```
import testVertexShader from './shaders/test/vertex.glsl';
import testFragmentShader from './shaders/test/fragment.glsl';

const material = new THREE.RawShaderMaterial({
  vertexShader: testVertexShader,
  fragmentShader: testFragmentShader
});
```

æ­¤æ—¶æŸ¥çœ‹é¡µé¢ï¼Œå¾—åˆ°çš„ç»“æœè¿˜æ˜¯ä¸€æ ·çš„ã€‚

![](<images/1685672275031.png>)

#### å±æ€§

æè´¨çš„ä¸€äº›é€šç”¨å±æ€§åœ¨ `RawShaderMaterial` åŒæ ·æ˜¯é€‚ç”¨çš„ï¼Œæ¯”å¦‚ `wireframe`ã€`side`ã€`transparent`ã€`flatShading` ç­‰éƒ½å¯ä»¥ç”Ÿæ•ˆï¼Œå¯¹ä¸Šé¢æè´¨å¼€å¯ `wireframe` å±æ€§ï¼Œå¯ä»¥å¾—åˆ°å¦‚ä¸‹å›¾æ‰€ç¤ºçš„å¹³é¢çš„ç½‘æ ¼æ¨¡å‹ã€‚

```
const material = new THREE.RawShaderMaterial({
 vertexShader: testVertexShader,
 fragmentShader: testFragmentShader,
 wireframe: true
});
```

![](<images/1685672275084.png>)

`ğŸ“Œ` ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåƒ mapã€alphaMapã€opacityã€color ç­‰å±æ€§åœ¨ç€è‰²å™¨æè´¨ä¸­ä¼šå¤±æ•ˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç€è‰²å™¨ä»£ç ä¸­è‡ªå·±å®ç°ã€‚

### GLSL è¯­è¨€

åœ¨ `Three.js` ä¸­ï¼Œéœ€è¦ä½¿ç”¨ `GLSL` è¯­è¨€æ¥ç¼–å†™ç€è‰²å™¨ï¼Œå…¨ç§°æ˜¯ `OpenGL Shading Language`ï¼Œæ„ä¸º `OpenGL` ä¸­çš„ç€è‰²è¯­è¨€ã€‚å®ƒçš„è¯­æ³•ç±»ä¼¼äº `Cè¯­è¨€`ï¼Œåœ¨å¼€å§‹ç¼–å†™ç€è‰²å™¨ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸€äº›å®ƒçš„åŸºæœ¬è¯­æ³•ã€‚

*   **æ—¥å¿—**ï¼šç”±äºç€è‰²å™¨è¯­è¨€æ˜¯é’ˆå¯¹æ¯ä¸ªé¡¶ç‚¹å’Œæ¯ä¸ªç‰‡å…ƒæ‰§è¡Œçš„ï¼Œæ—¥å¿—è®°å½•æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå› æ­¤ç¼–å†™ `GLSL` æ—¶æ²¡æœ‰æ§åˆ¶å°ã€‚
*   **ç¼©è¿›**ï¼šä»£ç ç¼©è¿›æ ¼å¼**æ²¡æœ‰ä¸¥æ ¼è¦æ±‚**ï¼Œåªè¦æ˜“è¯»ç¾è§‚å°±è¡Œã€‚
*   **åˆ†å·**ï¼šå’Œ `Cè¯­è¨€` ä¸€æ ·ï¼Œç¼–å†™ `GLSL` è¯­è¨€æ—¶ï¼Œä»»ä½•æŒ‡ä»¤çš„ç»“å°¾éƒ½**å¿…é¡»æ·»åŠ åˆ†å·**ï¼Œä¸¢å¤±åˆ†å·å°±ä¼šå¯¼è‡´ä»£ç æ— æ³•è¿è¡Œã€‚
*   **ç±»å‹**ï¼šå’Œ `Cè¯­è¨€` ä¸€æ ·ï¼Œ `GLSL` æ˜¯ä¸€ç§å¼ºç±»å‹è¯­è¨€ï¼Œ**ä¸åŒç±»å‹çš„å˜é‡ä¸èƒ½æ··ç”¨**ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚

#### å˜é‡

åœ¨ `GLSL` ä¸­æœ‰å¾ˆå¤šå˜é‡ç±»å‹ï¼Œç¼–å†™ç€è‰²å™¨æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®éœ€è¦é€‰æ‹©åˆé€‚ç±»å‹çš„å˜é‡ã€‚

##### æ•´å‹

ç”¨ä»¥å®šä¹‰æ•´æ•°ã€‚

```
int foo = 123;
int bar = - 1;
```

##### æµ®ç‚¹ç±»å‹

æµ®ç‚¹æ•°å°±æ˜¯å°æ•°ï¼Œå¯ä»¥æ˜¯æ­£æ•°ä¹Ÿå¯ä»¥æ˜¯è´Ÿæ•°ï¼Œå¿…é¡»æä¾›å°æ•°ç‚¹ `.`ã€‚

```
float foo = - 0.123;
float bar = 1.0;
```

##### å¸ƒå°”ç±»å‹

ç”¨äºè¡¨ç¤ºå€¼å¾—çœŸå‡ã€‚

```
bool foo = true;
bool bar = false;
```

##### äºŒç»´å‘é‡ vec2

å¦‚æœæˆ‘ä»¬éœ€è¦å­˜å‚¨å…·æœ‰ `x` å’Œ `y` å±æ€§è¿™æ ·å…·æœ‰ 2 ä¸ªåæ ‡çš„å€¼æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ `vec2`ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç›´æ¥ä½¿ç”¨ `vec2 foo = vec2()` è¿™æ ·æœªæ·»åŠ å‚æ•°çš„ç©ºå€¼ä¼šæŠ¥é”™ï¼Œåº”è¯¥åƒä¸‹é¢è¿™æ ·æä¾›å®Œæ•´çš„å‚æ•°ï¼š

```
vec2 foo = vec2(1.0, 2.0);
```

åˆ›å»º `vec2` åä¿®æ”¹å±æ€§å€¼ï¼š

```
vec2 foo = vec2(0.0);
foo.x = 1.0;
foo.y = 2.0;
```

è¿›è¡Œæµ®ç‚¹æ•°ä¸ `vec2` ç›¸ä¹˜ç­‰æ“ä½œè¿ç®—æ—¶ï¼Œç»“æœå°†åŒæ—¶ä½œç”¨äº `x` å’Œ `y`ï¼š

```
vec2 foo = vec2(1.0, 2.0);
foo *= 2.0;
```

##### ä¸‰ç»´å‘é‡ vec3

ä¸ `vec2` ç±»ä¼¼ï¼Œ`vec3` ç”¨äºè¡¨ç¤ºå…·æœ‰ `x`ã€`y`ã€`z` ä¸‰ä¸ªåæ ‡çš„å€¼ï¼Œå¯ä»¥ç”¨å®ƒéå¸¸æ–¹ä¾¿çš„è¡¨ç¤º**ä¸‰ç»´ç©ºé—´åæ ‡**ã€‚

```
vec3 foo = vec3(0.0);
vec3 bar = vec3(1.0, 2.0, 3.0);
bar.z = 4.0;
```

`RGB` é¢œè‰²ä¹ŸåŒæ ·é€‚åˆä½¿ç”¨ `vec3` è¡¨ç¤ºï¼š

```
vec3 color = vec3(0.0);
color.r = 0.5;
color.b = 1.0;
```

å¯ä»¥ä½¿ç”¨ `vec2` æ¥åˆ›å»º `vec3`ï¼š

```
vec2 foo = vec2(1.0, 2.0);
vec3 bar = vec3(foo, 3.0);
```

ä¹Ÿå¯ä»¥ä½¿ç”¨ `vec3` æ¥åˆ›å»º `vec2`ï¼Œå…¶ä¸­ `bar` çš„å€¼ä¸º `1.0, 2.0`ï¼Œ`baz` çš„ å€¼ä¸º `2.0, 1.0`ï¼š

```
vec3 foo = vec3(1.0, 2.0, 3.0);
vec2 bar = foo.xy;
vec2 baz = foo.yx;
```

##### å››ç»´å‘é‡ vec4

ä¸å‰é¢å‡ ä¸ªç±»ä¼¼ï¼Œ`vec4` ç”¨äºè¡¨ç¤ºå››ç»´å‘é‡ï¼Œå››ä¸ªå€¼å‘½åä¸º `x, y, z, w` æˆ– `r, g, b, a`ï¼Œå‘é‡ä¹‹é—´åŒæ ·èƒ½è¿›è¡Œç›¸äº’è½¬æ¢ï¼š

```
vec4 foo = vec4(1.0, 2.0, 3.0, 4.0);
vec4 bar = vec4(foo.zw, vec2(5.0, 6.0));
```

é™¤ä¸Šè¿°ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›å…¶å®ƒç±»å‹çš„å˜é‡ï¼Œå¦‚ `mat2`ã€`mat3`ã€`mat4`ã€`sampler2D` ç­‰å°†åœ¨åç»­å­¦ä¹ ä¸­ä»‹ç»ã€‚

*   åœ¨ç€è‰²å™¨å†…ï¼Œä¸€èˆ¬å‘½åä»¥ `gl_` å¼€å¤´çš„å˜é‡æ˜¯ç€è‰²å™¨çš„å†…ç½®å˜é‡ã€‚
*   `webgl_` å’Œ `_webgl` æ˜¯ç€è‰²å™¨ä¿ç•™å­—ï¼Œè‡ªå®šä¹‰å˜é‡ä¸èƒ½ä»¥ `webgl_` æˆ– `_webgl` å¼€å¤´ã€‚
*   **å˜é‡å£°æ˜**ä¸€èˆ¬åŒ…å« `<å­˜å‚¨é™å®šç¬¦> <æ•°æ®ç±»å‹> <å˜é‡åç§°>`ï¼Œä»¥ `attribute vec4 a_Position` ä¸ºä¾‹ï¼Œ`attribute` è¡¨ç¤ºå­˜å‚¨é™å®šç¬¦ï¼Œ`vec` æ˜¯æ•°æ®ç±»å‹ï¼Œ`a_Position` ä¸ºå˜é‡åã€‚


##### å†…ç½®å‡½æ•°

`GLSL` å†…ç½®äº†å¾ˆå¤šä½¿ç”¨çš„å‡½æ•°ï¼Œä¸‹é¢åˆ—ä¸¾äº†ä¸€äº›æ¯”è¾ƒå¸¸ç”¨çš„ï¼š

*   **è¿ç®—å‡½æ•°**
    *   `abs(x)`ï¼šå– `x` çš„ç»å¯¹å€¼
    *   `radians(x)`ï¼šè§’åº¦è½¬å¼§åº¦
    *   `degrees(x)`ï¼šå¼§åº¦è½¬è§’åº¦
    *   `sin(x)`ï¼šæ­£å¼¦å‡½æ•°ï¼Œä¼ å…¥å€¼ä¸ºå¼§åº¦ã€‚è¿˜æœ‰ `cos` ä½™å¼¦å‡½æ•°ã€`tan` æ­£åˆ‡å‡½æ•°ã€`asin` åæ­£å¼¦ã€`acos`åä½™å¼¦ã€`atan` åæ­£åˆ‡ç­‰
    *   `pow(x,y)`ï¼š`x^y`
    *   `exp(x)`ï¼š`e^x`
    *   `exp2(x)`ï¼š`2^x`
    *   `log(x)`ï¼š`logex`
    *   `log2(x)`ï¼š`log2x`
    *   `sqrt(x)`ï¼š`xâˆš`
    *   `inversesqr(x)`ï¼š`1xâˆš`
    *   `sign(x)`ï¼š`x>0` è¿”å› `1.0`ï¼Œ`x<0` è¿”å› `-1.0`ï¼Œå¦åˆ™è¿”å› `0.0`
    *   `ceil(x)`ï¼šè¿”å›å¤§äºæˆ–è€…ç­‰äº `x` çš„æ•´æ•°
    *   `floor(x)`ï¼šè¿”å›å°äºæˆ–è€…ç­‰äº `x` çš„æ•´æ•°
    *   `fract(x)`ï¼šè¿”å› `x-floor(x)` çš„å€¼
    *   `mod(x,y)`ï¼šå–æ¨¡æ±‚ä½™æ•°
    *   `min(x,y)`ï¼šè·å– `x`ã€`y` ä¸­å°çš„é‚£ä¸ª
    *   `max(x,y)`ï¼šè·å– `x`ã€`y` ä¸­å¤§çš„é‚£ä¸ª
    *   `mix(x,y,a)`ï¼šè¿”å› `xâˆ—(1âˆ’a)+yâˆ—a`
    *   `step(x,a)`ï¼š`x<a`è¿”å› `0.0`ï¼Œå¦åˆ™è¿”å› `1.0`ã€‚
    *   `smoothstep(x,y,a)`ï¼š`a<x` è¿”å› `0.0`ï¼Œ`a>y` è¿”å› `1.0`ï¼Œå¦åˆ™è¿”å› `0.0-1.0` ä¹‹é—´å¹³æ»‘çš„ `Hermite` æ’å€¼ã€‚
    *   `dFdx(p)`ï¼š`p` åœ¨ `x` æ–¹å‘ä¸Šçš„åå¯¼æ•°
    *   `dFdy(p)`ï¼š`p` åœ¨ `y` æ–¹å‘ä¸Šçš„åå¯¼æ•°
    *   `fwidth(p)`ï¼š`p` åœ¨ `x` å’Œ `y` æ–¹å‘ä¸Šçš„åå¯¼æ•°çš„ç»å¯¹å€¼ä¹‹å’Œ
*   **å‡ ä½•å‡½æ•°**
    *   `length(x)`ï¼šè®¡ç®—å‘é‡ `x` çš„é•¿åº¦
    *   `distance(x, y)`ï¼šè¿”å›å‘é‡ `xy` ä¹‹é—´çš„è·ç¦»
    *   `dot(x,y)`ï¼šè¿”å›å‘é‡ `xy` çš„ç‚¹ç§¯
    *   `cross(x,y)`ï¼šè¿”å›å‘é‡ `xy` çš„å·®ç§¯
    *   `normalize(x)`ï¼šè¿”å›ä¸ `x` å‘é‡æ–¹å‘ç›¸åŒï¼Œé•¿åº¦ä¸º `1` çš„å‘é‡
*   **çŸ©é˜µå‡½æ•°**
    *   `matrixCompMult(x,y)`ï¼šå°†çŸ©é˜µç›¸ä¹˜
    *   `lessThan(x,y)`ï¼šè¿”å›å‘é‡ `xy` çš„å„ä¸ªåˆ†é‡æ‰§è¡Œ `x<y` çš„ç»“æœ
    *   lessThanEqual(x,y)ï¼šè¿”å›å‘é‡ `xy` çš„å„ä¸ªåˆ†é‡æ‰§è¡Œ `x<=y` çš„ç»“æœï¼Œç±»ä¼¼çš„æœ‰ç±»ä¼¼çš„æœ‰ `greaterThanEqual`
    *   `any(bvec x)`ï¼š`x` æœ‰ä¸€ä¸ªå…ƒç´ ä¸º `true`ï¼Œåˆ™ä¸º `true`
    *   `all(bvec x)`ï¼š`x` æ‰€æœ‰å…ƒç´ ä¸º `true`ï¼Œåˆ™è¿”å› `true`ï¼Œå¦åˆ™è¿”å› `false`
    *   `not(bvec x)`ï¼š`x` æ‰€æœ‰åˆ†é‡æ‰§è¡Œé€»è¾‘éè¿ç®—

`ğŸ”—` å¦‚æœæƒ³äº†è§£æ›´å¤š GLSL çš„å†…ç½®å‡½æ•°ï¼Œå¯ä»¥åˆ°è¿™ä¸ªç½‘ç«™æŸ¥è¯¢ï¼š[Kronos Group OpenGL reference pages](https://link.juejin.cn?target=https%3A%2F%2Fwww.khronos.org%2Fregistry%2FOpenGL-Refpages%2Fgl4%2Fhtml%2Findexflat.php "https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/indexflat.php")

### ç†è§£é¡¶ç‚¹ç€è‰²å™¨ Vertex Shader

æ¥ä¸‹æ¥è®²è§£ç€è‰²å™¨é‡Œä»£ç çš„å…·ä½“å†…å®¹ã€‚

**é¡¶ç‚¹ç€è‰²å™¨**çš„ä½œç”¨æ˜¯å°†å‡ ä½•ä½“çš„æ¯ä¸ªé¡¶ç‚¹æ”¾ç½®åœ¨ `2D` æ¸²æŸ“ç©ºé—´ä¸Šï¼Œå³é¡¶ç‚¹ç€è‰²å™¨å°† `3D` é¡¶ç‚¹åæ ‡è½¬æ¢ä¸º `2D` `canvas` åæ ‡ã€‚

#### main å‡½æ•°

å®ƒå°†è¢«è‡ªåŠ¨è°ƒç”¨ï¼Œå¹¶ä¸”ä¸ä¼šè¿”å›ä»»ä½•å†…å®¹ã€‚

```
void main() {}
```

#### gl_Position

`gl_Position` æ˜¯ä¸€ä¸ªå†…ç½®å˜é‡ï¼Œæˆ‘ä»¬åªéœ€è¦ç»™å®ƒé‡æ–°èµ‹å€¼å°±èƒ½ä½¿ç”¨ï¼Œå®ƒå°†ä¼šåŒ…å«å±å¹•ä¸Šçš„é¡¶ç‚¹çš„ä½ç½®ã€‚ä¸‹é¢ `main` å‡½æ•°ä¸­å°±æ˜¯ç”¨äºç»™å®ƒè®¾ç½®åˆé€‚çš„å€¼ã€‚æ‰§è¡Œè¿™æ®µæŒ‡ä»¤åï¼Œå°†å¾—åˆ°ä¸€ä¸ª `vec4`ï¼Œæ„å‘³ç€æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨ `gl_Position` å˜é‡ä¸Šä½¿ç”¨å…¶`x`ã€`y`ã€`z` å’Œ `w` å±æ€§ã€‚

```
void main() {
  gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.0);
  gl_Position.x += 0.5;
  gl_Position.y += 0.5;
}
```

å¹³é¢å‘å³ä¸Šè§’å‘ç”Ÿäº†ä½ç§»ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰åƒåœ¨ `Three.js` ä¸­ä¸€æ ·å°†å¹³é¢åœ¨ä¸‰ç»´ç©ºé—´ä¸­è¿›è¡Œäº†ç§»åŠ¨ï¼Œæˆ‘ä»¬åªæ˜¯åœ¨äºŒç»´ç©ºé—´ä¸­ç§»åŠ¨äº†å¹³é¢çš„æŠ•å½±ã€‚å°±åƒä½ åœ¨æ¡Œå­ä¸Šç”»äº†ä¸€å¹…å…·æœ‰é€è§†æ•ˆæœçš„ç”»ï¼Œç„¶åæŠŠå®ƒå‘æ¡Œå­å³ä¸Šè§’ç§»åŠ¨ï¼Œä½†æ˜¯ä½ çš„ç”»ä¸­çš„é€è§†æ•ˆæœå¹¶æ²¡æœ‰å‘ç”Ÿå˜åŒ–ã€‚

`gl_Position` çš„ä½œç”¨æ˜¯åœ¨ `2D` ç©ºé—´ä¸Šå®šä½ `ğŸ“` é¡¶ç‚¹ï¼Œæ—¢ç„¶æ˜¯ `2D` ç©ºé—´ï¼Œä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨ä¸€ä¸ªå››ç»´å‘é‡è¡¨ç¤ºå‘¢ï¼Ÿå®é™…ä¸Šæ˜¯è¿™äº›åæ ‡å¹¶ä¸æ˜¯ç²¾ç¡®çš„åœ¨ `2D` ç©ºé—´ï¼Œè€Œæ˜¯ä½äºè¢«ç§°ä¸º `Clip Space` éœ€è¦å››ä¸ªç»´åº¦çš„**è£åˆ‡ç©ºé—´**ã€‚è£åˆ‡ç©ºé—´æ˜¯æŒ‡åœ¨ `-1` åˆ° `+1` èŒƒå›´å†…æ‰€æœ‰ `x`ã€`y`ã€`z` `3`ä¸ªæ–¹å‘ä¸Šçš„ç©ºé—´ï¼Œç¬¬å››ä¸ªå€¼ `w` ç”¨äºè¡¨ç¤ºé€è§†ã€‚å°±åƒæŠŠæ‰€æœ‰ä¸œè¥¿éƒ½æ”¾åœ¨ `3D` ç›’å­ä¸­ä¸€æ ·ï¼Œä»»ä½•è¶…å‡ºèŒƒå›´çš„å†…å®¹éƒ½å°†è¢«è£åˆ‡ã€‚`gl_Position` è¿™äº›å†…å®¹çš„è¿™äº›å†…å®¹éƒ½æ˜¯è‡ªåŠ¨å®Œæˆçš„ï¼Œæˆ‘ä»¬åªéœ€æ˜ç™½å…¶å¤§æ¦‚åŸç†å³å¯ã€‚

#### ä½ç½®å±æ€§ Position attributes

ç›¸åŒçš„ä»£ç å°†åº”ç”¨äºå‡ ä½•ä½“çš„æ¯ä¸€ä¸ªé¡¶ç‚¹ï¼Œå±æ€§å˜é‡ `attribute` æ˜¯åœ¨é¡¶ç‚¹ä¹‹é—´å”¯ä¸€ä¼šå‘ç”Ÿæ”¹å˜çš„å˜é‡ã€‚ç›¸åŒçš„é¡¶ç‚¹ç€è‰²å™¨ `Vertex Shader` å°†åº”ç”¨äºæ¯ä¸€ä¸ªé¡¶ç‚¹ï¼Œ`position` å±æ€§å°†åŒ…å«å…·ä½“é¡¶ç‚¹çš„ `x, y, z` åæ ‡å€¼ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä»£ç **è·å–é¡¶ç‚¹ä½ç½®**ï¼š

```
attribute vec3 position;
```

å› ä¸º `gl_Position` æ˜¯ `vec4` ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•å°† `vec3` è½¬åŒ–æˆ `vec4`ï¼š

```
gl_Position = /* ... */ vec4(position, 1.0);
```

#### çŸ©é˜µé™å®šå˜é‡ Matrices uniforms

æ¯ä¸ªçŸ©é˜µå°†è½¬æ¢ `position`ï¼Œç›´åˆ°æˆ‘ä»¬è·å¾—æœ€ç»ˆçš„è£åˆ‡ç©ºé—´åæ ‡ã€‚ä¸‹é¢æ˜¯ `3` ä¸ªçŸ©é˜µï¼Œå› ä¸ºåœ¨å‡ ä½•ä½“æ‰€æœ‰é¡¶ç‚¹ä¸­å®ƒä»¬çš„å€¼éƒ½æ˜¯ç›¸åŒçš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ `uniform` æ¥è·å–å®ƒä»¬ã€‚

```
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat4 modelMatrix;
```

ä¸‹é¢å°†å¯¹æ¯ä¸ªçŸ©é˜µåšå‡ºä¸€äº›å˜æ¢ï¼š

*   `modelMatrix`ï¼šå°†è¿›è¡Œç½‘æ ¼ç›¸å…³çš„å˜æ¢ï¼Œå¦‚ç¼©æ”¾ã€æ—‹è½¬ã€ç§»åŠ¨ç­‰æ“ä½œå˜æ¢éƒ½å°†ä½œç”¨äº `position`ã€‚
*   `viewMatrix`ï¼šå°†è¿›è¡Œç›¸æœºç›¸å…³çš„å˜æ¢ï¼Œå¦‚æˆ‘ä»¬å‘å·¦ç§»åŠ¨ç›¸æœºï¼Œé¡¶ç‚¹åº”è¯¥åœ¨å³è¾¹ã€å¦‚æœæˆ‘ä»¬æœç€ç½‘æ ¼æ–¹å‘ç§»åŠ¨ç›¸æœºï¼Œé¡¶ç‚¹ä¼šå˜å¤§ç­‰ã€‚
*   `projectionMatrix`ï¼šä¼šå°†æˆ‘ä»¬çš„åæ ‡è½¬åŒ–ä¸ºè£åˆ‡ç©ºé—´åæ ‡ã€‚

ä¸ºäº†ä½¿ç”¨çŸ©é˜µï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶ç›¸ä¹˜ï¼Œå¦‚æœæƒ³è®©ä¸€ä¸ª `mat4` ä½œä¸ºå˜é‡ï¼Œåˆ™è¯¥å˜é‡ç±»å‹å¿…é¡»æ˜¯ `vec4`ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†å¤šä¸ªçŸ©é˜µç›¸ä¹˜ï¼š

```
gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.0);
```

å®é™…ä¸Šè¿˜å¯ä»¥ä½¿ç”¨æ›´çŸ­çš„å†™æ³•æ¥è®© `viewMatrix` å’Œ `modelMatrix` ç»„åˆæˆä¸€ä¸ª `projectionMatrix`ï¼Œè™½ç„¶ä»£ç å°‘äº†ï¼Œä½†æˆ‘ä»¬å¯æ§åˆ¶çš„æ­¥éª¤ä¹Ÿå°‘äº†ã€‚

```
uniform mat4 projectionMatrix;
uniform mat4 modelViewMatrix;
attribute vec3 position;

void main(){
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
```

å®é™…ä¸­æˆ‘ä»¬ä¼šé€‰æ‹©æ›´é•¿çš„å†™æ³•ï¼Œä»¥ä¾¿äºæ›´å¥½åœ°ç†è§£åŠå¯¹ `position` è¿›è¡Œæ›´å¤šçš„æ§åˆ¶ã€‚

```
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat4 modelMatrix;
attribute vec3 position;

void main(){
  vec4 modelPosition = modelMatrix * vec4(position, 1.0);
  vec4 viewPosition = viewMatrix * modelPosition;
  vec4 projectedPosition = projectionMatrix * viewPosition;~~~~
  gl_Position = projectedPosition;
}
```

ä¸Šé¢ä¸¤ç§å†™æ³•éƒ½æ˜¯ç­‰ä»·çš„ï¼Œä½¿ç”¨ä¸‹é¢è¿™ç§æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ–¹ä¾¿åœ°è¿›è¡Œæ§åˆ¶ï¼Œæ¯”å¦‚å¯ä»¥é€šè¿‡è°ƒæ•´ `modelPosition` çš„å€¼æ¥å¯¹æ•´ä¸ªæ¨¡å‹è¿›è¡Œç§»åŠ¨ï¼Œé€šè¿‡ä»¥ä¸‹ä»£ç ï¼Œå°±èƒ½å‘ä¸Šç§»åŠ¨æ¨¡å‹ï¼š

```
void main() {
  vec4 modelPosition = modelMatrix * vec4(position, 1.0);
  modelPosition.y += 1.0;
  // ...
}
```

![](<images/1685672275473.png>)

æˆ‘ä»¬è¿˜å¯ä»¥åšä¸€äº›æ›´æœ‰è¶£çš„æ“ä½œï¼Œæ¯”å¦‚å°†å¹³é¢å˜æ¢ä¸º**æ³¢æµªå½¢çŠ¶**ï¼š

```
void main() {
  vec4 modelPosition = modelMatrix * vec4(position, 1.0);
  modelPosition.z += sin(modelPosition.x * 10.0) * 0.1;
  // ...
}
```

![](<images/1685672275775.png>)

### ç†è§£ç‰‡å…ƒç€è‰²å™¨ Fragment Shader

**ç‰‡å…ƒç€è‰²å™¨**çš„ä»£ç å°†åº”ç”¨äºå‡ ä½•ä½“çš„æ¯ä¸ªå¯è§åƒç´ ï¼Œè¿™å°±æ˜¯ç‰‡å…ƒç€è‰²å™¨åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¹‹åè¿è¡Œçš„åŸå› ï¼Œå®ƒçš„ä»£ç æ¯”é¡¶ç‚¹ç€è‰²å™¨æ›´æ˜“äºç®¡ç†ã€‚

#### ä¸»å‡½æ•° main

åŒæ ·ï¼Œç‰‡å…ƒç€è‰²å™¨ä¸­ä¹Ÿæœ‰ä¸€ä¸ªä¸»å‡½æ•°ï¼š

```
void main() {}
```

#### ç²¾åº¦ Precision

åœ¨é¡¶éƒ¨æœ‰ä¸€æ¡è¿™æ ·çš„æŒ‡ä»¤ï¼Œæˆ‘ä»¬ç”¨å®ƒæ¥å†³å®šæµ®ç‚¹æ•°çš„ç²¾åº¦ï¼Œæœ‰ä»¥ä¸‹å‡ ç§å€¼ä¾›é€‰æ‹©ï¼š

*   `highp`ï¼šä¼šå½±å“æ€§èƒ½ï¼Œåœ¨æœ‰äº›æœºå™¨ä¸Šå¯èƒ½æ— æ³•è¿è¡Œï¼›
*   `mediump`ï¼šå¸¸ç”¨çš„ç±»å‹ï¼›
*   `lowp`ï¼šå¯èƒ½ä¼šç”±äºç²¾åº¦é—®é¢˜äº§ç”Ÿé”™è¯¯ã€‚

```
precision mediump float;
```

**æˆ‘ä»¬ç°åœ¨ç¤ºä¾‹ä½¿ç”¨çš„æ˜¯ `RawShaderMaterial` åŸå§‹ç€è‰²å™¨æè´¨æ‰éœ€è¦è®¾ç½®ç²¾åº¦ï¼Œåœ¨ç€è‰²å™¨æè´¨ `ShaderMaterial`ä¸­ä¼šè‡ªåŠ¨å¤„ç†ã€‚**

åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­ä¹Ÿå¯ä»¥æ˜¯æŒ‡ç²¾åº¦ï¼Œä½†æ˜¯è¿™æ˜¯éå¿…é¡»çš„ã€‚

#### gl_FragColor

`gl_FragColor` å’Œ `gl_Position` ç±»ä¼¼ï¼Œä½†å®ƒç”¨äºé¢œè‰²ã€‚å®ƒä¹Ÿä¸€æ ·æ˜¯å·²ç»è¢«å†…ç½®å£°æ˜äº†çš„ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨`main` å‡½æ•°ä¸­é‡æ–°ç»™å®ƒèµ‹å€¼ã€‚å®ƒæ˜¯ä¸€ä¸ª `vec4`ï¼Œå‰ä¸‰ä¸ªå€¼æ˜¯çº¢è‰²ã€ç»¿è‰²ã€è“è‰²é€šé“ `(r, g, b)`ï¼Œç¬¬å››ä¸ªå€¼æ˜¯é€æ˜åº¦ `alpha` `(a)`ã€‚`gl_FragColor` çš„æ¯ä¸ªå€¼çš„å–å€¼èŒƒå›´æ˜¯ `0.0` åˆ° `1.0`ï¼Œå¦‚æœæˆ‘ä»¬è®¾ç½®çš„å€¼é«˜äºå®ƒä»¬ï¼Œä¹Ÿä¸ä¼šäº§ç”ŸæŠ¥é”™ã€‚

ä¸‹é¢è¿™æ®µä»£ç å°†ç”Ÿæˆä¸€ä¸ª**ç´«è‰²**çš„å‡ ä½•ä½“

```
gl_FragColor = vec4(0.5, 0.0, 1.0, 1.0);
```

![](<images/1685672275815.png>)

ä¸ºäº† `alpha` é€æ˜åº¦å€¼å¯ä»¥ç”Ÿæ•ˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨æè´¨ä¸­å°† `transparent` å±æ€§è®¾ç½®ä¸º `true`ï¼š

```
const material = new THREE.RawShaderMaterial({
 vertexShader: testVertexShader,
 fragmentShader: testFragmentShader,
 transparent: true
})
```

### å±æ€§ Attributes

`Attributes` æ˜¯æ¯ä¸ªé¡¶ç‚¹ä¹‹é—´å˜åŒ–çš„å€¼ï¼Œæˆ‘ä»¬ä¹‹å‰å·²ç»æœ‰ä¸€ä¸ªå‘½åä¸º **`position` çš„å±æ€§å˜é‡ï¼Œå®ƒæ˜¯æ¯ä¸ªé¡¶ç‚¹åœ¨æ¨¡å‹ç©ºé—´ä¸­çš„ `vec3` å€¼**ã€‚
æˆ‘ä»¬å°†ä¸ºæ¯ä¸ªé¡¶ç‚¹æ·»åŠ ä¸€ä¸ªéšæœºå€¼ï¼Œå¹¶æ ¹æ®è¿™ä¸ªå€¼åœ¨ `z` è½´ä¸Šç§»åŠ¨è¯¥é¡¶ç‚¹ã€‚åœ¨ `JavaScript` ä»£ç ä¸­æˆ‘ä»¬å¯ä»¥åƒä¸‹é¢è¿™ä¸ªç›´æ¥ç»™ `BufferGeometry` æ·»åŠ  `attribute` å±æ€§ã€‚ç„¶åå†åˆ›å»ºä¸€ä¸ª `32ä½` çš„æµ®ç‚¹ç±»å‹æ•°ç»„ `Float32Array`ï¼Œä¸ºäº†çŸ¥é“å‡ ä½•ä½“ä¸­æœ‰å¤šå°‘ä¸ªé¡¶ç‚¹ï¼Œç°åœ¨å¯ä»¥é€šè¿‡ `attributes` å±æ€§è·å–ã€‚æœ€ååœ¨ `BufferAttribute` ä¸­ä½¿ç”¨è¯¥æ•°ç»„ï¼Œå¹¶å°†å®ƒæ·»åŠ åˆ°å‡ ä½•ä½“çš„å±æ€§ä¸­ã€‚

*   `setAttribute`ï¼šç¬¬ä¸€ä¸ªå‚æ•°æ˜¯éœ€è¦è®¾ç½®çš„ `attribute` **å±æ€§åç§°**ï¼Œç„¶ååœ¨ç€è‰²å™¨ä¸­å¯ä»¥ä½¿ç”¨è¯¥åå­—ï¼Œå±æ€§åå‘½åæ—¶æœ€å¥½åŠ ä¸€ä¸ª `a` å‰ç¼€æ–¹ä¾¿åŒºåˆ†ã€‚
*   `BufferAttribute`ï¼šç¬¬ä¸€ä¸ªå‚æ•°æ˜¯**æ•°æ®æ•°ç»„**ï¼›ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºç»„æˆä¸€ä¸ªå±æ€§çš„å€¼çš„æ•°é‡ï¼Œå¦‚æˆ‘ä»¬è¦å‘é€ä¸€ä¸ª `(x, y, z)` æ„æˆä½ç½®ï¼Œåˆ™éœ€è¦ä½¿ç”¨ `3`ï¼Œç¤ºä¾‹ä¸­æ¯ä¸ªé¡¶ç‚¹çš„éšæœºæ•°åªæœ‰ `1ä¸ª`ï¼Œå› æ­¤è¿™ä¸ªå‚æ•°ä½¿ç”¨ `1`ã€‚

```
const geometry = new THREE.PlaneBufferGeometry(1, 1, 32, 32)
const count = geometry.attributes.position.count
const randoms = new Float32Array(count)
// ä½¿ç”¨éšæœºæ•°å¡«å……æ•°ç»„
for(let i = 0; i < count; i++) {
  randoms[i] = Math.random()
}
// æ·»åŠ åˆ°å‡ ä½•ä½“çš„å±æ€§ä¸­
geometry.setAttribute('aRandom', new THREE.BufferAttribute(randoms, 1))
```

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨**é¡¶ç‚¹ç€è‰²å™¨**ä¸­è·å–è¯¥å±æ€§ï¼Œå¹¶ä½¿ç”¨å®ƒç§»åŠ¨é¡¶ç‚¹ï¼Œå¯ä»¥å¾—åˆ°ä¸€ä¸ªå¦‚ä¸‹å›¾æ‰€ç¤ºçš„ä¸€ä¸ªç”±**éšæœºå°–å³°**æ„æˆçš„å¹³é¢ã€‚

```
attribute float aRandom;

void main(){
  // ...
  modelPosition.z += aRandom * 0.1;
  // ...
}
```

![](<images/1685672275853.png>)

### é™å®šå˜é‡ Varyings

ç°åœ¨æˆ‘ä»¬è‹¥æƒ³åœ¨**ç‰‡å…ƒç€è‰²å™¨**ä¸­æƒ³ä½¿ç”¨ `aRandom` å±æ€§ç»™ç‰‡å…ƒç€è‰²ï¼Œæ˜¯æ— æ³•ç›´æ¥ä½¿ç”¨ `attribute` å±æ€§å˜é‡çš„ã€‚æ­¤æ—¶ï¼Œå®ç°è¿™ä¸ªåŠŸèƒ½çš„æ–¹æ³•å°±æ˜¯å°†è¿™ä¸ªå€¼ä»**é¡¶ç‚¹ç€è‰²å™¨å‘é€åˆ°ç‰‡å…ƒç€è‰²å™¨**ï¼Œç§°è¿™ç§å˜é‡ä¸º `varying`ã€‚æˆ‘ä»¬éœ€è¦åœ¨ä¸¤ç§ç€è‰²å™¨ä¸­éƒ½åšå¦‚ä¸‹çš„æ“ä½œï¼š

åœ¨**é¡¶ç‚¹ç€è‰²å™¨**ä¸­ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ `main` å‡½æ•°ä¹‹å‰åˆ›å»º `varying`ï¼Œå°†å…¶å‘½åä¸ºä»¥ `v` ä½œä¸ºå‰ç¼€çš„å˜é‡å `vRandom`ï¼Œç„¶ååœ¨ `main` å‡½æ•°ä¸­ç»™å®ƒèµ‹å€¼ï¼š

```
varying float vRandom;

void main() {
  // ...
  vRandom = aRandom;
}
```

åœ¨**ç‰‡å…ƒç€è‰²å™¨**ä¸­ï¼Œä½¿ç”¨ç›¸åŒçš„æ–¹æ³•å£°æ˜ï¼Œç„¶ååœ¨ `main` å‡½æ•°ä¸­ä½¿ç”¨å®ƒï¼Œå¯ä»¥å¾—åˆ°å¦‚ä¸‹çš„æŸ“è‰²æ•ˆæœï¼š

```
precision mediump float;
varying float vRandom;

void main() {
  gl_FragColor = vec4(0.5, vRandom, 1.0, 1.0);
}
```

![](<images/1685672275917.png>)

`ğŸ“Œ` varying çš„ä¸€ä¸ªæœ‰è¶£ä¹‹å¤„æ˜¯ï¼Œé¡¶ç‚¹ä¹‹é—´çš„å€¼æ˜¯çº¿æ€§æ’å€¼çš„ï¼Œå¦‚ GPU åœ¨ä¸¤ä¸ªé¡¶ç‚¹ä¹‹é—´ç»˜åˆ¶ä¸€ä¸ªç‰‡å…ƒï¼Œä¸€ä¸ªé¡¶ç‚¹çš„ varying æ˜¯ 1.0ï¼Œå¦ä¸€ä¸ªé¡¶ç‚¹çš„ varying æ˜¯ 0.0ï¼Œåˆ™è¯¥ç‰‡å…ƒå€¼å°†ä¸º 0.5ã€‚è¿™ä¸ªç‰¹æ€§å¯ä»¥å®ç°å¹³æ»‘çš„æ¸å˜æ•ˆæœã€‚

ç°åœ¨æˆ‘ä»¬å…ˆç§»é™¤ä¸Šé¢æ‰€æœ‰çš„æ•ˆæœï¼Œæ¢å¤åˆ°çº¯ç´«è‰²çš„å¹³é¢ã€‚

![](<images/1685672275966.png>)

### ç»Ÿä¸€å˜é‡ Uniforms

`uniform` ç”¨äºå°†æ•°æ®ä» `JavaScript` å‘é€åˆ° `ç€è‰²å™¨`ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨åŒä¸€ä¸ªç€è‰²å™¨ä½†æ˜¯å‚æ•°ä¸åŒæ—¶å°±å¯ä»¥ä½¿ç”¨ `uniform`ï¼Œä½¿ç”¨æœŸé—´å‚æ•°è¿˜å¯ä»¥æ”¹å˜ã€‚åœ¨**é¡¶ç‚¹ç€è‰²å™¨** å’Œ `ç‰‡å…ƒç€è‰²å™¨` ä¸­éƒ½å¯ä»¥ä½¿ç”¨ `uniform`ï¼Œå®ƒçš„å€¼åœ¨æ¯ä¸ªé¡¶ç‚¹å’Œæ¯ä¸ªç‰‡å…ƒä¸­çš„æ•°æ®éƒ½æ˜¯ç›¸åŒçš„ã€‚å®é™…ä¸Šåœ¨æˆ‘ä»¬çš„ä»£ç ä¸­å·²ç»æœ‰ `projectionMatrix`ã€`viewMatrix`ã€`modelMatrix` ç­‰ `uniform`ï¼Œ`Three.js` å†…ç½®åˆ›å»ºäº†å®ƒä»¬ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬æ¥åˆ›å»ºè‡ªå·±çš„ `uniform`ã€‚ä¸ºäº†å°†ç»Ÿä¸€å˜é‡æ·»åŠ åˆ°æè´¨ä¸­ï¼Œéœ€è¦ä½¿ç”¨ `uniforms` å±æ€§ã€‚æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªæ³¢åŠ¨çš„å¹³é¢ï¼Œå¹¶ä½¿ç”¨å˜é‡æ¥æ§åˆ¶æ³¢æµªçš„é¢‘ç‡ã€‚ä¸‹é¢ç”¨äºæ§åˆ¶ **é¢‘ç‡** çš„å˜é‡å‘½åä¸º `uFrequency`ï¼Œç‰¹åœ°åŠ äº†ä¸€ä¸ª `u` å­—ç¬¦ä½œä¸ºå‰ç¼€æ¥æ ‡è¯†æ˜¯ `uniform` å˜é‡ï¼Œæ–¹ä¾¿åœ¨ç€è‰²å™¨ä¸­å’Œå…¶ä»–å‚æ•°åŒºåˆ†å¼€æ¥ï¼Œä½†è¿™ä¸æ˜¯å¼ºåˆ¶çš„ã€‚

```
const material = new THREE.RawShaderMaterial({
  vertexShader: testVertexShader,
  fragmentShader: testFragmentShader,
  uniforms: {
    uFrequency: { value: 10 }
  }
})
```

ç„¶åï¼Œå¯ä»¥åœ¨ç€è‰²å™¨ä»£ç ä¸­è·å– `uniform` å€¼ï¼Œå¹¶åœ¨ `main` å‡½æ•°ä¸­ä½¿ç”¨å®ƒï¼š

```
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat4 modelMatrix;
uniform float uFrequency;

attribute vec3 position;

void main() {
    // ...
    modelPosition.z += sin(modelPosition.x * uFrequency) * 0.1;
}
```

![](<images/1685672276046.png>)

æ˜¾ç¤ºç»“æœå’Œå‰é¢çš„ç›¸åŒï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨ `JavaScript` æ¥æ§åˆ¶é¢‘ç‡äº†ã€‚æˆ‘ä»¬å¯ä»¥æŠŠé¢‘ç‡ `frequency` æ”¹æˆ `vec2` æ¥æ§åˆ¶æ°´å¹³å’Œå‚ç›´æ–¹å‘çš„æ³¢åŠ¨ï¼Œåœ¨ `Three.js` ä¸­å¯ä»¥ä½¿ç”¨äºŒç»´å‘é‡ `THREE.Vector2`ï¼š

```
const material = new THREE.RawShaderMaterial({
  vertexShader: testVertexShader,
  fragmentShader: testFragmentShader,
  uniforms: {
    uFrequency: { value: new THREE.Vector2(10, 5) }
  }
})
```

ç„¶ååœ¨ç€è‰²å™¨ä¸­ï¼Œå°† `uFrequency` çš„ç±»å‹ä» `float` æ”¹ä¸º `vec2` å¹¶åœ¨ `zè½´` åŒæ—¶åº”ç”¨ `uFrequency` çš„ `xå€¼` å’Œ `yå€¼`ï¼Œæ­¤æ—¶æˆ‘ä»¬çš„æ¨¡å‹ç½‘æ ¼å°±ä¼šåŒæ—¶äº§ç”Ÿåœ¨**æ°´å¹³**å’Œ**å‚ç›´**æ–¹å‘çš„æ³¢åŠ¨ï¼š

```
// ...
uniform vec2 uFrequency;

void main() {
  // ...
  modelPosition.z += sin(modelPosition.x * uFrequency.x) * 0.1;
  modelPosition.z += sin(modelPosition.y * uFrequency.y) * 0.1;
  // ...
}
```

![](<images/1685672276088.png>)

[ã€ŠThree.js è¿›é˜¶ä¹‹æ—…ï¼šç¥å¥‡çš„ç²’å­ç³»ç»Ÿ - è¿·å¤±å¤ªç©º ğŸ‘¨â€ğŸš€ã€‹](https://juejin.cn/post/7155278132806123557 "https://juejin.cn/post/7155278132806123557")ä¸€æ–‡ä¸­æˆ‘ä»¬å·²ç»äº†è§£è¿‡ `dat.GUI` çš„ç”¨æ³•ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒåŠ¨æ€ä¿®æ”¹ `uFrequency` çš„å€¼åœ¨é¡µé¢ä¸Šå®æ—¶æŸ¥çœ‹ä¸åŒå‚æ•°ç”Ÿæˆçš„æ³¢åŠ¨æ•ˆæœã€‚

```
gui.add(material.uniforms.uFrequency.value, 'x').min(0).max(20).step(0.01).name('frequencyX');
gui.add(material.uniforms.uFrequency.value, 'y').min(0).max(20).step(0.01).name('frequencyY');
```

![](<images/1685672276125.png>)

è®©æˆ‘ä»¬å†æ–°åŠ ä¸€ä¸ª `uniform` æ¥è®©å¹³é¢åƒåœ¨é£ä¸­é£˜åŠ¨çš„æ——å¸œã€‚æˆ‘ä»¬å°†ä½¿ç”¨ç»Ÿä¸€å˜é‡ **`uTime` å‘ç€è‰²å™¨å‘é€ä¸€ä¸ªæ—¶é—´å€¼ï¼Œç„¶ååœ¨ `sin(...)` å‡½æ•°ä¸­ä½¿ç”¨å®ƒï¼š**

```
const material = new THREE.RawShaderMaterial({
 vertexShader: testVertexShader,
 fragmentShader: testFragmentShader,
 uniforms: {
 uFrequency: { value: new THREE.Vector2(10, 5) },
 uTime: { value: 0 }
  }
})
```

ä¸è¦å¿˜äº†åœ¨ `tick` é¡µé¢é‡ç»˜å‡½æ•°ä¸­æ›´æ–° `uTime`ï¼Œæˆ‘ä»¬ä½¿ç”¨ `getElapsedTime` æ¥è·å–å·²ç»èŠ±è´¹äº†å¤šå°‘æ—¶é—´:

```
const tick = () => {
  const elapsedTime = clock.getElapsedTime();
  material.uniforms.uTime.value = elapsedTime;
  // ...
}
```

ç„¶ååœ¨ç€è‰²å™¨ä¸­è·å– `uTime` å¹¶åœ¨ `sin(...)` å‡½æ•°ä¸­ä½¿ç”¨å®ƒï¼Œæˆ‘ä»¬çš„å¹³é¢å°±ä¼šçœ‹èµ·æ¥åƒä¸€ä¸ªåœ¨é£ä¸­é£˜åŠ¨çš„æ——å¸œ `ğŸš©`ï¼š

```
// ...
uniform float uTime;

void main() {
  modelPosition.z += sin(modelPosition.x * uFrequency.x + uTime) * 0.1;
  modelPosition.z += sin(modelPosition.y * uFrequency.y + uTime) * 0.1;
  // ...
}
```

![](<images/1685672276522.png>)

æˆ‘ä»¬ä¹Ÿå¯ä»¥å°† `uTime` ä¹‹å‰çš„ `+` æ”¹ä¸º `-` æ¥ä¿®æ”¹æ³¢åŠ¨çš„æ–¹å‘ã€‚

```
modelPosition.z += sin(modelPosition.x * uFrequency.x - uTime) * 0.1;
modelPosition.z += sin(modelPosition.y * uFrequency.y - uTime) * 0.1;
```

![](<images/1685672276961.png>)

`ğŸ“Œ` æ³¨æ„ï¼Œä½¿ç”¨ uTime æ—¶å¦‚æœç›´æ¥ä½¿ç”¨ JavaScript çš„ Date.now()ï¼Œä¼šå‘ç°ä¸èµ·ä½œç”¨ï¼Œå› ä¸ºå®ƒçš„æ•°å€¼å¯¹äºç€è‰²å™¨è€Œè¨€å¤ªè¿‡åºå¤§ï¼Œæˆ‘ä»¬ä¸èƒ½å‘é€å¤ªå°æˆ–å¤ªå¤§çš„ç»Ÿä¸€å˜é‡å€¼ã€‚

è™½ç„¶ç°åœ¨ç½‘æ ¼æ¨¡å‹å…·æœ‰æ³¢åŠ¨æ•ˆæœï¼Œä½†æ˜¯å®ƒä»ç„¶æ˜¯ä¸€ä¸ªå¹³é¢ç½‘æ ¼æ„æˆï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹å®ƒçš„å±æ€§æ¥ä½¿å®ƒçœ‹èµ·æ¥æ›´åƒä¸ªæ——å­ `ğŸš©`ã€‚æˆ‘ä»¬å¯ä»¥ä¿®æ”¹å®ƒçš„å¤§å°æ¯”ä¾‹ï¼š

```
const mesh = new THREE.Mesh(geometry, material);
mesh.scale.y = 2 / 3;
```

![](<images/1685672277035.png>)

åœ¨ç‰‡å…ƒç€è‰²å™¨ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨ `uniform` ç»Ÿä¸€å˜é‡ï¼Œæˆ‘ä»¬æ·»åŠ ä¸€ä¸ª `uColor` ä½œä¸ºé¢œè‰²å˜é‡ï¼š

```
const material = new THREE.RawShaderMaterial({
 vertexShader: testVertexShader,
 fragmentShader: testFragmentShader,
 uniforms: {
 uFrequency: { value: new THREE.Vector2(10, 5) },
 uTime: { value: 0 },
 uColor: { value: new THREE.Color('orange') }
  }
})
```

ç„¶ååœ¨ç‰‡å…ƒç€è‰²å™¨ä¸­è·å–é¢œè‰²å˜é‡ï¼Œå¹¶å°†å®ƒä½œä¸º `gl_FragColor` çš„å€¼ï¼Œä½ ä¼šçœ‹åˆ°å¹³é¢å°†å˜æˆè®¾å®šçš„é¢œè‰²æ•ˆæœï¼š

```
precision mediump float;
uniform vec3 uColor;

void main() {
  gl_FragColor = vec4(uColor, 1.0);
}
```

![](<images/1685672277092.png>)

### çº¹ç† Textures

`Textures` çŸ¥è¯†æ¯”è¾ƒå¤æ‚ï¼Œåœ¨ä¹‹å‰çš„æ–‡ç« ä¸­å·²ç»ä»‹ç»è¿‡ä½¿ç”¨ `THREE.TextureLoader` åŠ è½½çº¹ç†ï¼Œä¸‹é¢æˆ‘ä»¬ç»™ç€è‰²å™¨æè´¨æ·»åŠ ä¸€ä¸ªå›¾ç‰‡çº¹ç†ï¼Œå¹¶ä½¿ç”¨ `uTexture` ç»Ÿä¸€å˜é‡ä¼ é€’ç»™ç€è‰²å™¨ï¼š

```
const material = new THREE.RawShaderMaterial({
  // ...
  uniforms: {
    // ...
    uTexture: { value: textureLoader.load('/textures/flag.png') }
  }
})
```

ç„¶ååœ¨ç€è‰²å™¨ä¸­ï¼Œä¸ºäº†ä½¿çº¹ç†çš„é¢œè‰²åº”ç”¨äºæ¯ä¸ªå¯è§ç‰‡å…ƒä¸Šï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ `texture2D(...)`ï¼Œå®ƒæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯éœ€è¦åº”ç”¨çš„çº¹ç†å³ `uTexture`ï¼Œç¬¬äºŒä¸ªæ˜¯çº¹ç†ä¸Šæ‹¾å–é¢œè‰²çš„åæ ‡ç³»ï¼Œè¿™ä¸ªåæ ‡ç³»å…¶å®å°±æ˜¯å‰é¢è®¨è®ºçš„ `UVåæ ‡`ï¼Œå®ƒçš„ä½œç”¨æ˜¯å°†çº¹ç†åæ ‡æŠ•å°„åˆ°å‡ ä½•ä½“ä¸Šã€‚æˆ‘ä»¬ç”¨äºåˆ›å»ºå‡ ä½•ä½“çš„ `PlaneBufferGeometry` ä¼šè‡ªåŠ¨ç”Ÿæˆè¿™ä¸ªåæ ‡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ `geometry.attributes.uv` æ¥æŸ¥çœ‹å®ƒã€‚`texture2D(...)` çš„è¿”å›ç»“æœæ˜¯ä¸€ä¸ªç”± `r, g, b, a` æ„æˆçš„ `vec4`ã€‚

å› ä¸º `uv` æ˜¯ä¸€ä¸ª `attribute` å±æ€§ï¼Œå› æ­¤éœ€è¦åœ¨**é¡¶ç‚¹ç€è‰²å™¨**ä¸­éœ€è¦è¿™æ ·è·å–å®ƒï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç‰‡å…ƒç€è‰²å™¨ä¸­ä½¿ç”¨å®ƒï¼Œå› æ­¤è¿˜éœ€è¦é€šè¿‡ `varying` å‘é€åˆ°ç‰‡å…ƒç€è‰²å™¨ï¼Œå¹¶åœ¨ `main` å‡½æ•°ä¸­æ›´æ–°å®ƒï¼š

```
// ...
attribute vec2 uv;
varying vec2 vUv;

void main() {
  // ...
  vUv = uv;
}
```

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨**ç‰‡å…ƒç€è‰²å™¨**ä¸­è·å– `vUv` å˜é‡ï¼Œå¹¶åœ¨ `texture2D(...)`æ–¹æ³•ä¸­ä½¿ç”¨å®ƒï¼š

```
precision mediump float;

uniform vec3 uColor;
uniform sampler2D uTexture;

varying vec2 vUv;

void main() {
  vec4 textureColor = texture2D(uTexture, vUv);
  gl_FragColor = textureColor;
}
```

![](<images/1685672277131.png>)

### é¢œè‰²å˜åŒ–

ç°åœ¨è™½ç„¶æœ‰äº†å›¾ç‰‡è´´å›¾ï¼Œä½†æ˜¯æ——å­ `ğŸš©` çš„æ˜æš—é¢œè‰²å˜åŒ–è¿˜ä¸å¤ªæ˜æ˜¾ï¼Œä¸‹é¢æˆ‘ä»¬å°†ä¸ºå®ƒæ·»åŠ ä¸€äº›é˜´å½±å˜åŒ–ã€‚

é¦–å…ˆåœ¨**é¡¶ç‚¹ç€è‰²å™¨**ä¸­ï¼Œæˆ‘ä»¬å°†æŠŠé£çš„é«˜ç¨‹å­˜å‚¨ `elevation` å˜é‡ä¸­ï¼Œç„¶åé€šè¿‡ `varying` å‘é€åˆ°**ç‰‡å…ƒç€è‰²å™¨**ï¼š

```
varying float vElevation;

void main() {
  // ...
  float elevation = sin(modelPosition.x * uFrequency.x - uTime) * 0.1;
  elevation += sin(modelPosition.y * uFrequency.y - uTime) * 0.1;
  modelPosition.z += elevation;
  // ...
  vElevation = elevation;
}
```

ç„¶ååœ¨**ç‰‡å…ƒç€è‰²å™¨**ä¸­è·å– `vElevation`ï¼Œç”¨å®ƒæ¥æ”¹å˜ `textureColor` çš„ `r, g, b`å±æ€§ï¼š

```
// ...
varying float vElevation;

void main() {
  vec4 textureColor = texture2D(uTexture, vUv);
  textureColor.rgb *= vElevation * 2.0 + 0.5;
  gl_FragColor = textureColor;
}
```

![](<images/1685672277189.png>)

### ç€è‰²å™¨æè´¨ ShaderMaterial

ä¸Šé¢æ‰€æœ‰å†…å®¹ï¼Œä¸ºäº†æ·±å…¥ç†è§£ç€è‰²å™¨çš„åŸç†ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ `RawShaderMaterial`ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨**æ›´ç®€å•**çš„ `ShaderMaterial` æ¥é‡æ„ä¸Šé¢å®Œæˆçš„æ‰€æœ‰åŠŸèƒ½ã€‚ `ShaderMaterial` å’Œ `RawShaderMaterial` çš„å·¥ä½œåŸç†å…¶å®æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡å…¶å†…ç½® `attributes` å’Œ `uniforms`ï¼Œ`ç²¾åº¦` ä¹Ÿä¼šè‡ªåŠ¨è®¾ç½®ã€‚æˆ‘ä»¬åªéœ€æŒ‰ä¸‹é¢æµç¨‹ç¨åŠ ä¿®æ”¹ä»£ç å³å¯ã€‚

åœ¨ `JavaScript` ä»£ç ä¸­å°†æè´¨æ¢ä¸º `THREE.ShaderMaterial`ã€‚

```
const material = new THREE.ShaderMaterial({});
```

ç„¶å**åˆ é™¤**ç€è‰²å™¨ä¸­ä»¥ä¸‹å±æ€§å’Œå®šä¹‰ï¼š

*   `uniform mat4 projectionMatrix;`
*   `uniform mat4 viewMatrix;`
*   `uniform mat4 modelMatrix;`
*   `attribute vec3 position;`
*   `attribute vec2 uv;`
*   `precision mediump float;`

### å…¶ä»–

*   æŸ¥é”™ï¼šå› ä¸ºç€è‰²å™¨æ˜¯å¯¹æ¯ä¸ªç‰‡å…ƒæ‰§è¡Œï¼Œå› æ­¤æ²¡æœ‰æ—¥å¿—è®°å½•ï¼Œå‡ºé”™çš„è¯å¾ˆéš¾æŸ¥æ‰¾ï¼Œå¦‚æœæˆ‘ä»¬å¿˜å†™äº†åˆ†å·ï¼Œ`Three.js` ä¼šå°†æ•´ä¸ªç€è‰²å™¨ä»£ç æ‰“å°å‡ºæ¥å¹¶ä¼šæç¤ºå‡ºé”™çš„è¡Œå·ï¼›
*   è°ƒè¯•ï¼šè°ƒè¯•æ•°å€¼çš„ä¸€ç§æ–¹æ³•æ˜¯å¯ä»¥åœ¨ `gl_FragColor` ä¸­ä½¿ç”¨å®ƒï¼Œè™½ç„¶ä¸å¤Ÿç²¾ç¡®ï¼Œä½†æ˜¯å¯ä»¥çœ‹åˆ°é¢œè‰²å˜åŒ–ï¼›
*   `GLSLify`ï¼šä¸€ä¸ª `node module` æ¨¡å—ï¼Œå¯ä»¥æ”¹å¯¹ `glsl` æ–‡ä»¶çš„å¤„ç†ï¼Œé€šè¿‡ `glslify` æˆ‘ä»¬å¯ä»¥åƒæ¨¡å—ä¸€æ ·å¯¼å…¥å’Œå¯¼å‡º `glsl` ä»£ç ã€‚ä½ å¯ä»¥ä½¿ç”¨ `glslify-loader` å¹¶å°†å…¶åŠ åˆ° `webpack` é…ç½®ä¸­ã€‚
*   æ‹“å±•é˜…è¯»ï¼š[The Book of Shaders](https://link.juejin.cn?target=https%3A%2F%2Fthebookofshaders.com%2F "https://thebookofshaders.com/")ã€[ShaderToy](https://link.juejin.cn?target=https%3A%2F%2Fwww.shadertoy.com%2F "https://www.shadertoy.com/")

`ğŸ”—` æºç åœ°å€ï¼š[github.com/dragonir/thâ€¦](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdragonir%2Fthreejs-odessey "https://github.com/dragonir/threejs-odessey")


## ShaderMaterial

æ–‡æ¡£ï¼š
[ShaderMaterial â€“ three.js docs (threejs.org)](https://threejs.org/docs/#api/zh/materials/ShaderMaterial)
å†…ç½® attributes å’Œ uniforms:
[ShaderMaterial â€“ three.js docs (threejs.org)](https://threejs.org/docs/#api/zh/materials/ShaderMaterial)
