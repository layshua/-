# 创建项目

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ZWFhYWY4MmNmMGM0MTAzZGRlZjNiZGNmZGIzMDk5NGRfcGNRUFBRblN6OXpLYU1KOEZFU2lya3RwRWZCZzhUbWxfVG9rZW46Ym94Y25pbk1NZ0RBRkhkbEpXaE01d2I4QmNiXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

game空项目，选择CPP

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=NTdmMjRlMzAzYTQzNThlOTE1NDY3YzI4NDc3MjMyMDFfUlp6SVUzZ2NUaFF0WjRCbUl0cmd3RHJ6T0J2UGVFZFdfVG9rZW46Ym94Y25IZHlJblVEQUdmdWEyWThnR3JUZ0VoXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

项目目录下新建Plugins,把我们的MultiplayerSessions放里面

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=N2JkOGFiZDQwNWZkNzBkNmZhYTMwYThiZjA4MDYyNWZfVjZ2cGlOWWk5T2Y3V3k4YjhwaHB3WDFiSUR4NE03d2hfVG9rZW46Ym94Y25aaEdtU2pzMzZyWlhGR0lRYklSY0diXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

打开steam插件

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=MmQ5MzZmNDlkOGY5N2QxMGE0OWJlOTI4ZTBlNDBmM2RfWjBueTg2WDlnS1VxVVd6RWFubmpFTlJqZkw5TTdIaGVfVG9rZW46Ym94Y25tMjdiQkw0VlpnYm9uOGJ3Rms1ODdkXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

将官网这一段复制到config中

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=MWM2YjViMzgwYzRlNmYwNmY5NTExYTgwZGNiNjEwNzNfcTNOWDJoS01ZeXpJSTNGMjRDbkVpcmJabFQyQ3lrVHZfVG9rZW46Ym94Y25QMnQ1VnVrdkZaamRDeVIyUVp6SWNnXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

更改另一个config文件

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ZWJhOWI4N2YyMzBjY2NiMWMzZjNmNGVhY2IyNTUwMThfbU1LTjJHWUhWMlNLQjBnQUNWYXZxTERmT2hrM2wydzdfVG9rZW46Ym94Y244bkV2dmFhaWM5TDFza3RMQWE4NXBnXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

删除三个文件，用rider不用删

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=N2QxNTI3YTA0ZjRjNTI5ZjdjN2ZkNTQyZmY0MjcwMGNfYkhnQjIzb2JrV0ZqQlltRGJOS3hMRnpNUUVIa1ZkUkVfVG9rZW46Ym94Y243QXJzYkFwSmpqYkhwc1ozbFhQcHNnXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

创建菜单地图，配置一下

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=YzgxZTllMTQ5YWMwNGFiMDhiMTk0N2E5YzA5MjliMThfQzZnSEg5RkFsWUc3WHpXak90eVNGMjZzTFpEOGMyMmdfVG9rZW46Ym94Y25xazdwSWNYN1JoQ3pzdUZ2Q3NQOXVlXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

项目设置中增加两个地图配置

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=Y2I2MzZkMjkzZDU1ZjgxMDQ4NzljYzM0OGVkNTg4YTBfSEtBcHFKMmY5TWVZZkplSDFzYk9lcjBNYW83bGJhTnNfVG9rZW46Ym94Y25NcEZVTjFDUE1IMXg2VThkVVJYV29iXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

添加蓝图第三人称模板

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=OTEzMWU1Yjk3ZDZiMTY0YjEwMDY5ZGJjNjAxYzBhN2FfM3A4VUcycXY5dU1sZXQ2WUVENFNFVm5sVG9meG5aaWNfVG9rZW46Ym94Y252aEc2eG1Tcmw5aDM0WlN1Tlg0dWlnXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

将lobby的gamemode改成刚刚下的第三人称默认gameMode，因为第三人称自带同步代码

## 添加免费资产

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=MjI0YTNjM2QxMzQ0Y2FlZTUyZmIxMjk1ODE5ZGIwYTlfczNkOVdkczI3SWI5dnh2TEF2ZVdaWkRLdkdhT0tWd2xfVG9rZW46Ym94Y25JdlI5bWtVUmdQNklXTlFrU3BIYldlXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

选择这个包，是因为他不支持UE5，我们可以趁机学习怎么在UE5中加入以前版本的资产（现在这个包支持5.0）

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=MDlmYzZhOTM3N2RmN2RiY2MwMDg2NTEwZTgwYTIwMWNfS2tqOWVaTnZnT3NnZUlza08yQ2RidnlydzUwV3NjaTdfVG9rZW46Ym94Y25DaXNIQTcxekZGSjllN0Q3a2lxNnRnXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

加入一个专门用于转化资产的空项目

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=MjYzNjRkZTFlZjk4ZWIwZWM5MjUyMjkwMjI2YTk3ZTZfV2tyZE1qVEJKcVNkQW9MckJWeVpJR3JPOUhVV2VIUjdfVG9rZW46Ym94Y243a0lNa1p0dTVPY0J5MGs5OVVacm5nXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

选择迁移

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=YzgyZjhmMmI0ZmY3NjQyMTJjMDhhNmRhNzY5NTY5MTlfRW1jalR4N1hQaFg3alV6SFA5bEtpSVQ5dW1XTTkwUmVfVG9rZW46Ym94Y25UaXZVMmExOE92WDFmNlJiRXhpN3pjXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ZTdkOWQ5M2NjMWZjMWU4NWE1ZTc2ZjRjNmQ4M2M4Y2JfRXZSWXlYak8xQTFEZTlQSjNEYTZXYnhGQnZJWVQ2MTRfVG9rZW46Ym94Y25qdVNNdXY4SzFiY0tBNXh5Z3liUzJnXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

再来一些项目

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=MTY2NTg3NmM1MTcyNGY1NjI3Yzc2OGVmODQxMTU2NmRfSzk4R1BvamNVeVJTZXZQYzlidDBwTmMwS2pCRHQzdTZfVG9rZW46Ym94Y25pdzhwb2dST0VtUjR1a3dnMldxWmlkXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

mixamo中下载一些动画

## 动画重定向

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=Yzg4NDJlYTBjNjVjZTg1MzRhYzIwYmQyYTZjYmNhYjlfZTgwRkxJNVdUQllGWXRCSm93cWJSS2pVeTJrWFIyblBfVG9rZW46Ym94Y25iTTFPYjRjcmR3UGNyU1hKQWlkWXFiXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

新建两个IK Rig

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=OWE3OGRiOWQ1NWM4ODVjMDZmNzExMzQ1ZTQxNGY4NzNfT0dydUxPbFp5ZFB6TUpBTngwUXVQRmd2em9ETE51N0ZfVG9rZW46Ym94Y243UmVXbGZVT3kzVzJtOWlETlNua2pnXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

将右手所有骨骼定义为链

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=NWRmNThkNzk3NWU2ZTExNjZhYmUzZDc1YTQ0ZDAwZWVfRFhuaFhBSEZ1dGphNWVjMndDeWRvSEI0RW5RbU5QN1RfVG9rZW46Ym94Y25OeGc2MzBlelhjQVRDd0RUdEFZV0hnXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

重复这个工作，将所有部分定义完

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ZDQ1M2RiOTkxMTEyMTI4ZTgxMWJhMWMyMWQ3Y2NhNjBfVzRrWFlBeTBNQW5ISU1rMnZ1eHVJMk1wcXdrVVIwdUdfVG9rZW46Ym94Y25OWlFldFl2RGRUMXQwckVtNnVDWTVjXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

新建IK重定向器，这里我们需要小白人的动画，选择小白人

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ODllMzFkN2VjMmM3OTNjMzRiYTYyYjQ5ZDQ0NjA3YjhfcUpNT3VTWjQwTGJubExta0VUMlJTc3Q1c0xQYkFhVzNfVG9rZW46Ym94Y24weElubmJHMVVYclZmMGRFWFp5TmVkXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

修改姿势

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=NTFiMjMyMmUyOWJjYTk4YjgzOWI1Njg2Y2I5OTEzOTBfYzFmd1ZESEt5WkhieFR3c3FmUkRtekZ5Y2ZDdTh5TmtfVG9rZW46Ym94Y25qTWlOcWt3d0NzMTh0eUJ3WGJmcjZkXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

选择hips之类的作为retarget root，然后导出即可

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=M2Y2ODcyMmQ1NTQ4ZDgwNTNmMzBiOGQzMDBjN2UyMzVfYmx4N29Ibno4Q2lXOWJ0OENqc3JEcHRHMnV2Z1psa3VfVG9rZW46Ym94Y25wcVBKbFYxWjgwOElPdWFYV3pTOVRiXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=YmJiOTU0NWRjZDE3MzI5MGMxOGZlMDExYjE2ZTA0M2NfajhmdGxZM2N3ekI4eGtUOTNuR1NIU3FtYjFqaUJFSkVfVG9rZW46Ym94Y25pZEFwWlJNTlA4VHVnajFnaUNYTnRlXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

将需要的资源迁移过去

## 整理项目

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=N2JiMjEyZDhmMzAzYTk0NjUyNzUwNTI3NDZjZmU0ZGFfVmpsaVVrYVkwa2liRjhMbGNxcHFGa0xhbUlDMHB3ME5fVG9rZW46Ym94Y25VWU54TUM2eHZ2MlBaN1pVSW9uNXJoXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

把文件夹整理好

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=NjRkMjdmMzZlNTE4NDViZGZmNGIyNjg5NzlmNTIwZDVfOGNINGl5U0tvcXVOQmV5RlhBTGRPUnJoNFJMYWo0akhfVG9rZW46Ym94Y25DTlppdUZmcVRrTWdGb09admRWSmd5XzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

添加摇臂和摄像机，配置属性

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ZGZmMWE0MGI3NzFmNTRlMzZmNzYxZTA5OGQwNDk4MWRfSUxQaVB6UDhCVll0dFRhQndrVlJVTkZqYVpLVUhhckNfVG9rZW46Ym94Y25Eb3ZpS3VUMUpieHF3ZHN4aXpLOGdlXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

翻译一些蓝图常说的话，让角色动起来

## Rider快捷键

[【Rider for Unreal Engine】常用功能总结_Tanzq-blog的博客-CSDN博客](https://blog.csdn.net/qq_46276931/article/details/120380827)

# C++动画蓝图

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=NTBiM2U4MjgxNWI5MDdjYTExMjk4YjAzMzQ1MDQ2NDhfVzJ5SjRJd2VYTXJac1lLREVMcnpORVZjalFLOFM2U3dfVG9rZW46Ym94Y25sMWFhNnZkSXF5SXdnUUN4V1RGY2dkXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

继承自AnimInstance

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=NjQyMmZlZmIzNGM0YTUwZmM3OGJiOWZjZTIzOGMzNmJfeWFvZ2lkYndJQmQ0VkI3MmUzcEY0NDBubWNtZTlOZ0FfVG9rZW46Ym94Y25ib2lrbGNWcUE4dk5jQXdMQjRLWDJlXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

使用meta语法访问私有变量

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ZDE0MzRhNDQ4NDY4NzE0YmQ4MmUzMzQ0YmRkNTU5NWRfTDMwZG1tTkhXeTRPRmRKQk1jVE5zTlQwSVVmTDk4ejNfVG9rZW46Ym94Y25qZk8xVGdSZ1FmdmlYNU9YMjNNeFZoXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

将基础的属性tick放到C++中

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=NjJjMjkyZmQxODdjMjI0ZDJmMTcwNjY5ZTA4YWQzZTFfUHRQTmhZWjQ3cEVlZkRJYlEwcFM0VExXaEZWMFJWV0FfVG9rZW46Ym94Y25DeVVYcktITjdISnQ5RVdCTlVSOWdmXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

角色不随Controller旋转，但如果有移动输入，会把角色转向那个方向

# Seamless Travel⭐⭐⭐⭐⭐

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=YmRjYWI2NzE5YTJiY2UyYTdkM2NjNmNiZDU1NjU3YjFfYVVvNUFPM0doY1gzQ3VZTFBHRkRWblhQcmNTU3JWc0pfVG9rZW46Ym94Y25nWjFmYWFscDNjR0lkbWZFQ0JtNnRmXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ZjU5NTQ3ZTA4YzUwY2FjM2QzNTc4NWYzMzE4Nzk0Y2Zfd1JRcnU5WWlKdWdOSzNSdktscTlScVQybHpQRHRaSjlfVG9rZW46Ym94Y25aWVdjTE12U0lWYjljaVBMdDNEZW9hXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

服务器调用ServerTravel，所有客户端都会调用ClientTravel

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=MmI0ZDIzNjcwODA3MTlkZGE3YTFiN2Y3ZjE0NGU5ZjBfOWdUc21EVk1UYnhyOWFydlZyMTRURnE0Vnl5WndtVXFfVG9rZW46Ym94Y25tWklnMEhTRjN0RDFkekdENDI2TGZoXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

gamemode只存在于服务器上

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ZjVmYzg5NTQ4MzMzMDQ4YWJhMjNmY2IxY2NiYjUyMDRfdUNyelE0aWphWVQzUGhuNURVUUF4d1lwVmVlZ1hpWjNfVG9rZW46Ym94Y240clZGN1B6WVhobDRNR2hoazI3bXJnXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

设置转换关卡为这个空关卡，这步不太懂

# 网络同步角色⭐⭐⭐⭐⭐

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ZTY5YTM1NTVjOGNmNjg3OGU0Mzc4ZWE3ODk2ZThmMGNfSWhTcVZ5a0Myb2J3cERhempTMUgzUUhveWxRWFBuWE1fVG9rZW46Ym94Y25QV0ZEalBGR1lGUlQwOWhyeU5FQmZjXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

1. Authority,服务器自己控制的角色
    
2. SimulatedProxy，别的客户端控制的角色
    
3. AutonomousProxy，客户端自己控制的角色
    

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=YzU4NjNmMzVjNzFmMTcyMGQ4ZTA5NjI4NzVlNGM5NTlfcjhsTzdMazV2TE9rb21Ob3lMbXA4ZDQzSzF1R3RwdFRfVG9rZW46Ym94Y252ams2NlhubUtYOFU1QUZBZEJFRjJlXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=YmVmNjAwNzRjMTEyNDYwNmM5MjgwMmE4ZWNhZDZjNDJfbmNVM3ltMWRuZm5rekplNXpCNjBEakQ1bGFXYU84TVlfVG9rZW46Ym94Y25rWjVZNkFORHRoWGo3QjU0VVVmQUdmXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

组件效果

# 创建武器类

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=Y2JlOGQ3MTZlOGJmZTdkYzlhYjMyOWZjMzA2NTkyMzRfYVFkWE1qV2s2bXJyNU9xVEpwaEhHVzJvQWh5SHRMMmZfVG9rZW46Ym94Y25jYm92NmlaWjEwZnl3eE9XcW51M0NoXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

创建武器类，检查是否Authority

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=YzVhYmQ1MzZlZTU4MDAzYTMyZjQxYWRkNGQzYTk5MTRfcTRGdEpiRFNWVUhpS1pOSnJCS0x6OFJ3dGdPQ2djZWZfVG9rZW46Ym94Y25mODhCdEt3U2ZmZWpjdEhtcXdIUXZNXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

网络同步的代码，都需要bReplicates =true

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=MjEzY2RhNzUyNTZmZWU1MDJiMWIwYWExMDYyZTI5ZWVfeXhselFYNzJlUjN4VnFWNDJLUXk1Mzg2WExPSmc2bXZfVG9rZW46Ym94Y243QjNDaFJXU21vUTNsdGZVbTNPcGhiXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

自定义武器枚举，用UMETA限定编辑器时显示的名称

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=YzliZjM3OGNiYWMyMDQyNDI4MTMzNDYxZTljMmU4NjFfZDNiekVHMlh5RVhmcjVxTWhoaG9IMWtTT2xyWGN5WUFfVG9rZW46Ym94Y25LY09xdmtsRlFMeG1icDhkZWR6djllXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

只在服务器上绑定重叠事件

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=YmE0MjUxNWY5NzIxYjFjMjUxYzA3MTdiMWRlNzYzY2ZfZWFzRjIybGR6aFlXZUVEMklra2ZZQ0ZrQnZTc2o4dURfVG9rZW46Ym94Y242QTNkSE9VZjJaSEthbE9WWlVNdXBjXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

这样子写，服务器重叠只有服务器可见，客户端重叠也只有服务器可见

# 变量网络复制⭐⭐⭐⭐⭐

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=NTdlZTRlYTU3OGQ5ZTI4ODE3M2Y1N2RkZjk3NzYwZWJfcW9qcVJZdzd1ZlVGMHdwSkpyZzhhdmtZa0JBT0lXY0tfVG9rZW46Ym94Y25xMWZzZWlVdjhveDY4eUNPcjlkOWhjXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

给需要网络复制的变量加上宏定义

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=MjhiOTU2MzdjYTBkZGIzMTQzNWJmYjRjOWNlMGQzZDFfWmFnajNIa3oyTDR1ZU1EZkJXSTRocmFyeVh2RjdQOFdfVG9rZW46Ym94Y25xMEdSM05MVGlvTmZiS2tXdTBDdmhnXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

接着，重写虚函数，复制这个变量

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ZDI4ZTM3YTg5N2Q5Yzk3ZGY1NGU2NjlmMDE4MWE4YTBfNkFiSWRwdFZoemlFTEdFQWc3QWhoajV3WkZYUW5RQUFfVG9rZW46Ym94Y25Sc1F4WFhnRUF2WThMODRZSWZIakZiXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

调用的时候复制变量

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=NTc2MWExYTg4OGNhMWQ2YWRjMzRjMjFjNTYwNjg5ZDNfSHk5RmxmazlveUNsZmU0WUIxMW5URHhoR2taY2VQSWFfVG9rZW46Ym94Y24yNUtPUzc5eFhXbm9ndzNLTEZPRm1iXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

书写一个inline函数

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ZDFlYzUzYTlmNDdkMzBhM2FkYjk3MWM0N2Y3ZDRkMTFfRHVnT2NOdEJGQjZ1MUt2S3JpejNXdGFSVHhaUm85c3RfVG9rZW46Ym94Y240U2hPT3BtWktZeEJBa0t4TzV2Q0dlXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

这样，客户端运行时，会在服务器和所有客户端上都看见这行字

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ZDIwZDRhMGIxNzI1MDRkZTJlZGIyMmFlOTRhZjAwMDVfODNiNXFvcHVSTlJEWTdWRlU5UGlhMFpmcnpsYTBoQ01fVG9rZW46Ym94Y242aVJXcko4dkp5VU54elVBa0VMZzRkXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

只在owner上复制这个变量，这样做的话，当前客户端和服务器都能看到这行文字（Pickup）

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=Mzc2ZTg1MDhiMjRmNTk2NDBlMTcwZDI4ZTc0MGY5ZWZfMDM0b3JmR3FIRDg4bGs2dlppUE1EeHROYzJlSkJ4anJfVG9rZW46Ym94Y25KUm03dVRMWkZCOEZQVkN0a2d2UGhiXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

定义变量复制事件，在变量被复制时执行，这样我们只在捡到武器的客户端上看到这行字

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ODQ4MDVlMjg1YzFhZWNkMDkzMWJjNWY3YzI1ODhiN2VfazRoWnFUVHEyRFR4ZmVua1dkTXp2UmU2UFgxMWF2M2ZfVG9rZW46Ym94Y25JSFpBYzBMeWNXbzNXeEJSV1NmWHpjXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

OnsphereOverlap仅仅发生在服务器上

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=YzU3YjkxOWI3NDg0MTdhYzUxZmVkMzRkZTBkM2FhYWJfV2w1bGtzTE9HUlowUjBDTmVrY2dJdDAzbER2dXFDZ0NfVG9rZW46Ym94Y255eEJVSzBUNm1DSHJNMjc5U1VFYkFoXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

这样，走出去时就不会显示ui了

变量复制只能从服务器传到客户端，不能反向传播

# 手动设置网络延迟⭐⭐⭐⭐⭐

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=NjdlNTM1ODQxOTAxM2NlMjdmZDAyZGQ2NmFlNjUxZmFfSmFNQllnSEI3aXNKczhPeEliQkdiQXhYUmJSdENXT3ZfVG9rZW46Ym94Y25rb0o5bGJheHFLaDBQdFBvUmFmQThjXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

模拟ping,除此之外还可以模拟丢包等

# 战斗组件

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ZmJlZjY5MTA1NjllNzFjNjY3MTdiYzFiOTNmZTgzYTJfUmVKUUJydUR6TW9lOUNaaXlmVDUwQlpyS0VBQWlBelpfVG9rZW46Ym94Y24zUHE3M1oySWs4bHpMQVhGbzFhSUUzXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

定义战斗组件

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ZTU2M2QxNWE4ZTZkZmRiNmVhZjU0OTc4Yzc3ZWFjM2JfaW1FbE1BSG5lWTNCVTBuOGFxT3NBeUpkUXJJOHV1S0dfVG9rZW46Ym94Y25oVVRwUFl4VzBkNjlDd1o0bVZjb1VoXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

互为朋友，这样角色就能随意访问战斗组件的所有函数，包括private和protected,捡起武器时，要确定是否是服务器。

# 多播拾起武器Rpc(1)⭐⭐⭐⭐⭐

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ZDAyMDljMmQxMGMwMzYxZGM1NjE3NGNmNDhiYzQ1YThfdDRiNG9ZSFZuNHBiZ1ZweHkydW5lenJhbFBQcXFHRTZfVG9rZW46Ym94Y25yNVFIWFlSb29VR01TUDV4U0p6WkltXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

reliable意味着会进行确认

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=Zjg0M2Q1M2RmNDI2MDM0Mzk2YWFjYjdiODJkZDVmNDhfOUtiekU0NUppM2lWMWNldWNnS0ZTa0ZxbjZDTHh2cGVfVG9rZW46Ym94Y25nRDB5eVpJNDlreU5hZXEyVUw1NE9sXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

Rider会自动加上Implementation，vs需要自己加

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=OGFkMzk3NGI5YmY3MzJjY2NlMWRkOTZmYTQ5MjU3N2JfclpHbnlsZFBsOXFiYWJzSWtEaXpnZUlhZ2E5UXAwOUxfVG9rZW46Ym94Y252WXJmVW9rNllpZUk0Z2puY2NOQTdkXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

如果是客户端，使用RPC的方式调用这个函数，但是会发现我们的UI没有隐藏

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=OWE5NTg0NGNmYzYxZDU0Yzg3MWY4ZmNkMGE1NTA0NmRfODlWcUllT2NTUTlGbUQ2ZkxFSk40Y0VsSXgxYjVodGFfVG9rZW46Ym94Y25lenZSTmZtOGZIQVpWd2l3ZU5GSnhxXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

这是因为setPickupWidget没有在客户端之间广播

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=YmE1Y2Y0ZWNlZTYyMmRkNDY0NWNhY2Y4ODczMGExMDZfMERPczVTUjNmaTBESmdrMmVkUlFJVGd4eHpDQUVPcnlfVG9rZW46Ym94Y25wbW1ZUWo4SDNaanVFb2U0UG1VaWJjXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

只有服务器上会产生overlap这种事件，一些例如meshAttachToPlayer这种操作，是自动复制的，我们不需要额外书写代码。RPC指远程程序调用，在这个例子中，我们让客户端上的装备事件在服务器上执行

# 多人游戏动画蓝图⭐⭐⭐⭐⭐

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=MjI5MGQ3Y2Q5MWU5OWRmNjhkMGRhMWI1ODE1MzRlNDdfUmFLVTdmTjlkM3ZZZmhxM1dxT25GeXVTTEg5WjIzbTFfVG9rZW46Ym94Y25pc0J2ejJzRXJ4TW14ME5MNTdtVk5jXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

这样是行不通的，因为EquippedWeapon并没有在客户端上复制

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ZThjNWE2YmY2NjZiODAyYTFjMDllZGM2YmVhMDNiNGFfd05GdjJ3eEk1UHp4ZXlsZjlRSEVQaVdRYjBpTFUwd0RfVG9rZW46Ym94Y251S0czTHpoNlVub0FNYTBFeEllbnNkXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

这一段非常难理解，在我们有三个角色的情况下，假设我们在服务器上，操作一个客户端的角色捡起武器，这个角色的EquippedWeapon被设置上了，但这个只在服务器上发生了，服务器上这个客户端的动画蓝图会发生状态改变，播放持枪动画，但这边没有复制到对应客户端上

`shift+👆全选一行`

# 添加下蹲

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ZjI0MGIwZDJmZjI5ZjA4ZTdmYTM3MGFkNTNjNDBmMDZfNTFKMGRnekNybWFIMWVNd253VVRRTTVGVXZ6enpvWnRfVG9rZW46Ym94Y25iZ3Z6Z096QjlUSVp0aGpDcTdkMjJmXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

移动组件内置了Crouch（）以及对应的网络复制函数，按下左Shift，什么都不会发生

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=NjhmNTNlMTEzYThhYTUzMGVkYTM5YzVhMmZiN2JlNmJfQUx1NktRaDlsemhjOUtoUGlEa1RKdnZEWDNqdUNQSldfVG9rZW46Ym94Y25wQm9CbUdIakZsMEIzOHJJQk1LZE5kXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

因为要在移动组件中打开

# 瞄准

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ZjQyYjE5N2QwNzRlYTNjMGMxNTM2ZDc2YTE2NjVjNWJfNjdpVWZhSTNqTUV1NHFGQmhwMXppOGZ5VnBvZmUybzNfVG9rZW46Ym94Y24yem93OFg3ZTlOYlFHenpnSG5kMWJkXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

和蹲基本上一样，但这个变量没有网络同步，无法在别的客户端上看到变化。网络同步后，可以在服务器上瞄准，但无法在客户端上瞄准。

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=MjUzZjlmYTBlZTY3ZDNiNTExNzU4MzA4NDE2YzZlOGVfUTJrZmVWOTJya2s3cDZmdEswdXlnd3JlM0MyY0FmWDZfVG9rZW46Ym94Y25ITkdEN0xCM056S3ZrMzVVZ2xRakViXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

需要为客户端编写RPC函数

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ZWFmOGI2MDQwNjEwYWZkODY5Y2QwZDU5NzVhMTI5NzVfOWs3d3ZHcG0yMWRlbTZtMnVHem5SMEQ5M3E2d3dUSkdfVG9rZW46Ym94Y245bmd6a3RraDkyM1hMRHFEb2lCaGhkXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

# Aim Offset⭐⭐⭐⭐⭐

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=Yjc0NTIxNjEyZTc3ZDNmOWNkMzg1Zjg3ODk2NjUzMjhfMng5OTRqVGthczNhOGpIYXVaMUNHMnpVYk56SHZrWHBfVG9rZW46Ym94Y25YOTB6SXd5Qk50a0h4bUpUb2d1YlliXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

手动制作AO动画

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=N2RiNzA2M2JmYjU1NjEwYTEwMzI0OTdkMWE0NjhkOThfcXoxZG9NR0thd3FsRFJZWW5kck83MkJzMHZYVmVzbXpfVG9rZW46Ym94Y252WTNXWHB4enJYMGNPYW5zeVNoMWFjXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

把AO动画都设置成Additive，选择meshSpace，参考CC动画

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=NmRhMGQ4NTgxNTk3Y2E1MGM5NmY1NWM0M2EwOTdkMTdfeXdJcmNGMlNOQ2syOXRRMklVTTFHamFjM3lZOVJ5NUZfVG9rZW46Ym94Y25wbkNDNHNmOFR0S3c0SDJFTmhuTk5oXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

在这个角色中，spine_01分开上下半身

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=MzBiNzI5YTM0MDQzNjk5ZTgxMTFmYmYyOTYwOTQ5MDBfRUhRV2xqY0hnUUpzY3ZJaFJpZkpMQmU1amVTbnFtdlVfVG9rZW46Ym94Y25iVldodUdocWkzYjB3R3VlQld2amRnXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

选择spine_01

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=MDNiOTI0ZWQ1ODcwYWM4ZWJlYjA1MWQ3MjM3YTkyZGRfejE0ZDU4OGV0OG03aFpvcHBkQTdzTlFCdnZQMUJCTVNfVG9rZW46Ym94Y25nbGViOXhwN29wbnVMRml4WTA1Z2liXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

使用AO，静止不动的时候，我们希望人物的行为是：

可以朝四周看，超过一定角度之后移动脚

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=MTZhYmFhYTA5YWQ4YTVlODM3YTZhYWFhZDJjOTJkMTJfd1pJMlI4ZEhlSlZUNDNZZ3EwSDVFNzU2cXR2bEpaZjlfVG9rZW46Ym94Y25KbTNXeXh3MVFlSTFjU2lpZGxkQ0piXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

不动时，我们需要yaw和pitch的AO，移动时，我们只需要pitch的AO。

注意这里不能用GetControlRotation,因为一台机器只有一个Controller，在联网编程时要使用GetBaseAimRotation()。

TODO:从服务器上捡起武器，Pitch值同步了，但Yaw值没同步

在客户端上捡起武器能把Pitch同步，但Yaw值不行

课程写到这里，确实是会有这个问题的

# TurnInPlace

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=NzU2NmY3NTA5YzUxNjlkNDg3ODg1YjIwMWNmZDcyNmVfQVYweFVjTzIzOWx6aGZzZk42MFVqOVYyRjVBbURFY01fVG9rZW46Ym94Y25scjZESURFdXRHbWc4M3h5amhIcGxiXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

新建TurnInPlace枚举，在Character类里处理这个枚举值

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=MDY4ZTg0OGFmMDJjNzI3OTNmZjUwMTZlYmE1YzgxY2NfYlEwaU55b3YwbTRwRkFSZ3JLajVkTW55MkFrMzRDVHNfVG9rZW46Ym94Y25CTkZoZXE3aFRNaVJtOXdWN1ZMTWZkXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

使用分层混合解决只有一个转身动画，但是需要在转身时区分瞄准和不瞄准，填spine_01即可

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=YzA3ODEyYTY5MjhlZGM5YTk4NmI3NTk1ZjMzMjliYzdfZHpmZHdock1yeGFKeWc3NlB6VXRhUFkxUDc2cEFKc2RfVG9rZW46Ym94Y25ZYmRJbjJWQzFYRmU5WjFYa3hxb3VmXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

动画飘在天上，可以直接拖下来，加一个key即可。不喜欢动画里有key可以直接导出资产

# 旋转根骨骼

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=OTFhNmNiNzY2ZGQyODYzNzkxZWZmYjAxZmJlN2JiOWVfNFdpQUdiUnZXVTR3TEwyRVRSZFhWZlVVY2tJTUE5UW9fVG9rZW46Ym94Y25acndzUThMRUc4bU1qaEFaeGR0RXVjXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

使用旋转根骨骼节点，稍加改动Character.cpp即可实现。

实际上就是人物胶囊体跟着controller在运动，而旋转根骨骼得到了Yaw值将旋转值移回去了，而上半身的AO依然生效，插值一定时间后将StartAimingRotation清零，停止旋转，AO参考的是StartAimingRotaion，所以表现正常。

# 倾斜跑BlendSpace

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ZGY2ZTZjNGUxNzA4NGY5YWEyZmE3NjY2OGZlNTkwNGRfRHlkMXllTnNNcG1ZQ05UdzNNU1pFTUpsTnhEU05ZcHRfVG9rZW46Ym94Y25RVW9oY2p0VHJBSlVrZkNhTUNIU2ZlXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=N2Y0OWY1NWQzMDI4YjQ5YzU5NzQyMDRiMzU4YThjMWRfZHBvMjlzWDlhV1V0NVc2SDRVZ09iOU8wdzBwYU5xbW5fVG9rZW46Ym94Y25GblI2cXVHNHN2V0M2TTM1YjliVlBmXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

制作倾斜动画

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=YTRlNzI5YTQwNmQ5M2ZhMmRlMThiNjg2ZjVlMjM5NTVfQXpqUXlHRWhMOTg5ek56R2MxblRWUEs0WUVBMHFMa0xfVG9rZW46Ym94Y25WRW9Gc2g5T2xyZTRNYXNoYUdOTDFmXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

自己制作Lean动画

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=NWViOTQ5N2I4MDBhNGM0ZmEyYWE0NzhlMDRmZjZkZGVfYWlackFFekVzRG5kdWRMWGxtUjlMcW9VQTNuM3pGT0RfVG9rZW46Ym94Y25RVFc5MVU4VUVqcnlrcjRNMkU0eWNmXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

在持械时，我们不需要朝向旋转，我们需要始终看向前方

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ZWNhN2E2ZDViZDExNTRlMDc1ZDNmMWNiY2QwYjA5ZGRfaHhNQ0RpSmdWWGlXSTdoQU1JOXBQVlFVcnY3OTJVTDJfVG9rZW46Ym94Y256bU5Qc3JrS0t2MmpQWmZoamZmN1NnXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

动画蓝图里不需要复制倾斜这种变量，是因为Actor的Rotation是引擎自动复制的，所以在各个客户端上计算出来的结果都是一样的。

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ZDQzODcxY2QwYzhlYjY2NTBhNDNjMDBjMjM3NzE1OThfZmt5Qzc4UGZ2aGVOaGVSRHdGd2tmOVNQWHpyc3hRa2pfVG9rZW46Ym94Y25PZkJab1h4NGZnekJ6c2NWcTJZaDlBXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

从-180到180的过渡非常奇怪，因为中间过渡了非常多中间动画，解决办法是插值，不能使用float插值，使用Rotator插值，UE会帮我们找到-180到180的最短路径，得到正确结果。

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=YmE5MmQzMmZmYjg5NjEyYWQ1YTM4NDJmYjMyY2UyZDRfVENzWWI5bFFudzZzbUZzWHBzUDEzcE1pTFB1ZnFBY3dfVG9rZW46Ym94Y25UdUpXUjJsbThOdlZoZmRaNFBxTTZKXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

负值可能会打包出错，因为虚幻在网络传输时会把float变成无符号数，压缩至5Byte。

# 自制八方向移动动画

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=OWZjOGVmYTY4NmRiMGJiY2ZlMjM3NmY2ZjdjZDQ2NTlfMWdzSzVoOFpueXpaRFg1eGxKdE5kY20zcXB5Und4dlpfVG9rZW46Ym94Y25BMGZzRGJ4cVRYUGR0ZjFyNk1udUpiXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

把向前跑动画根骨骼旋转45，spine01反向旋转45即可

# FABRIK IK⭐⭐⭐⭐⭐

P53 FBARIK IK

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ZDNlNDZiNTcxMDdmZDAxZTVjOTY3YjY5OTc5MDI4ZDlfUVRlMDUxSmJTTEw0NmhKejdONTZGbVhlSW01dmtKVlpfVG9rZW46Ym94Y25zMDRJMzRnajVWckxEU2tHeDJIaTJnXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

在突击步枪的根上加一个socket，命名需要统一

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=NzhmZDEyYTMxODgyNjc3YTcwMzRmNGM2NzgxYjcxMWFfQXJTeXZtNUlPQWFJVmVoZFVMM254b2xlMTBESUxoOFJfVG9rZW46Ym94Y25nY3NTMWNtRkVNYVAyalBqbkx1M1hnXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

计算应有位置

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=OWE2ZWI0MTE5NzIxY2JmMzIxMGEyNTFhMjM3NGQxMWVfQ2R6emhFNkVPR21wbkZCMnp0dU9ENHYwT0h4djVHZ0JfVG9rZW46Ym94Y25rOWFobWhJelVoYWRkU0xaaFhad1llXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

这种情况下End Effector是我们的右手，Solver是我们的左手，RootBone选择leftArm，这将决定我们的算法在哪停止

# 网络更新频率⭐⭐⭐⭐⭐

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=YjAxZTE5ZTU3OTZiODNjOWNlOWNjYzU1YWY0MGFiYzhfSDJYR2E4dW4xdTJVWXptNHliN09uV3M4NVAxbFpEUzhfVG9rZW46Ym94Y25Ta0duUnRPalh5OWlLRWhnTDUyeERnXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

这两个分别是正常情况下网络同步频率和actor不活跃情况下的网络同步频率，在项目中，我们可以手动设置网络延迟，也能手动降低网络同步频率来测试网络不稳定情况下的游戏表现

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=NTU3NWNkNzAzOWY5ZTA2NWNhNzgwMTc0NjM3YWM3NjJfWlgyUTRMdXU0WnVGS2wyNjFsQ1lBUVZFb2hJek5BaWNfVG9rZW46Ym94Y25EWFVDVzJ4VlV2RlJTSWtFN1dPa1RnXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

更改服务器tickRate

# 自制八方向动画

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=Y2RkMTkwMDdiYjUzOTlhNDM0NzE0MDY1MmVkNTBhMjFfVXVKV0FiaFM1MUQ2YTRHbFkzenUxOGZ0MUZaYjVoRHBfVG9rZW46Ym94Y250ZzdkY0lNZTdxTElhMnREZ2J3UU83XzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

使用向前跑动画，只旋转spine以上即可

# 添加声音

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=MWExYzMyY2NiNDY5NTlhMDllNjAyZTllMTA0ZjEzMGFfQk9MNTZYeFNQNEloQkoxbWJpeGFzVUZUTFA4aFI0RGNfVG9rZW46Ym94Y25wVFltcjhYTVhOcEZTNUxYN0dvWXNjXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

动画通知中的声音会自动复制，不需要额外操作

# 抛物子弹

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ODZmNGUzZGY0NjMwMWZiZTMwMzlkMWI3YTkwNGVhOTZfd3BEMWdBNm9TSEZ3T3JadFJ3SktodVdma2JMY3JtSVdfVG9rZW46Ym94Y25wSlRwSk1aSVR6ZTc4Qng1bU1VS1dHXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

基本设置

# 武器开火

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=OGZkN2ZmM2ViYjE4NGE0ZjMyMTdkNTk5MThlZGI2YmNfbDAyYUZlZElEcDczTk13b0o2SDhsMnhYRVIxM3U3UElfVG9rZW46Ym94Y252Zk9VdUlucVpUMDdKdU9mZ0JsbkFmXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

cpp中接受到是否按下左键的布尔值后，在CombatComponent中处理开火逻辑

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=N2ZlMmNhMDRiNzExMjk0NTc3ZTQ5Njc0OTlkNWNjYjRfaWViNG5xbGsya25hSjZRMGc3MTBEZUx3Zlc1U1pPVTdfVG9rZW46Ym94Y25lYzNmN1ZvdkszVGtDT01YZ3E3VjJSXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

一个蒙太奇即可处理两个开火动画

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=MDg2ZjI0YTdhZTkzZWRhYjdhMTg1Y2ExN2RjODVhNTlfWUtEc09UWjk2dWc1cGlVaHBRZzJSa2JHemZjMm1KNFNfVG9rZW46Ym94Y25OWkhvcUNoRThaUnNBMDFld2VsdmZnXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

简单选择逻辑

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=N2QyZmVjZDM1YmI1MDIxNTI0MGZiMjMwMjlhMTRlZThfaDZWRDZxTHlyOTRXVjRhZTVWdTRTNm1UMXhDQlprTVFfVG9rZW46Ym94Y25laTJIb2R1WmhKZ0t6WXdwQldXeDJnXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

开火动画和声音并没有在网络上复制，这个需要使用MultiCastRPC解决

# 多播武器开火RPC(2)⭐⭐⭐⭐⭐

https://docs.unrealengine.com/4.27/zh-CN/InteractiveExperiences/Networking/Actors/RPCs/

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=M2U4YThjNjM1ODk2OWU1NWMwMGUwMWM4YTgyNGE0NjdfaTJ0SUxpd1FBcU9YQWtWQ1Z0YzVkVVpYOFl2ckx4ODNfVG9rZW46Ym94Y243ckFUcW55MGdXZ1lHd3dKNGoxTVFnXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

这种情况下，在客户端上捡起武器，只有服务器能看见开火动画和音效

这里不能使用变量复制，变量复制在变量发生变化时自动赋值，我们的自动武器开火时并不会有变量发生变化

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ZjYzYzE4MjY3NzQzMzllODVkN2RhNWU0NjI5ZTA2N2FfY243WTZtVW1qY3VlbEhBc2o3NzRCSHRpZW1JaW05cklfVG9rZW46Ym94Y25ONEIxTDVBaHJwZUJqWkNkZjFlNDNlXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

使用MultiCastRPC

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=MWEzMGI1YzMxMGQ4NjIxMTBiOWE5ZDUzMTQ5NTUzZDZfb2c2bmlZVEpsWjVSTERpOUFIQ09vYzVyZkJ5YVdIaThfVG9rZW46Ym94Y25VOUxnSEdWZVZDRUh3bXZEdEVDSm9mXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

服务器和客户端上按下按键，都会触发RPC多播事件，在所有客户端上运行

# 准确发射Projectile⭐⭐⭐⭐⭐

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=Y2ZhODMxYjcyMjg5OWMyYTRjMzJmOTg1YjAzOWE3NDZfbTVCMDRmV2NnV2lPOXJ4Nkt2WkhSUVdOeTkzOU8yREhfVG9rZW46Ym94Y254aDVQSXRwekxkVjJ0eHhldHp2dFVnXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

UE自带函数，可以获得屏幕中间点的方向和第一个检测到的位置，填充到两个引用传递的参数里，并且返回一个bool。

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=NjY2NzI4YjYzNmExYTg4NTY5ODU0ZDRjNDI3NWMzMjlfWkR4dnFhSWJqanRWUVVtU2dYVG9vdVhZejhJNVI1djhfVG9rZW46Ym94Y25SUURQOFJXUzBIYTRBUDI5YnRIbllnXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

我们获得了屏幕中间的世界坐标和朝向，可以利用这个做射线检测，常量可以进行宏定义，减少代码中的数字量

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=N2RhNjg5MWIxNTdmODVjYjQyMzYxY2QwZGY2MDhhZTVfSXhORmtPRktCTXVJSHhzYWpNVnpkdFFsZ29qem9JbnZfVG9rZW46Ym94Y25JbjM4Uk5rSk1VRjU3dXNSZWVINnNkXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

对于子弹，可以这样定义，好处是可以接收任何派生自这个类的对象

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ODMwODRhZGI3MTQyNWQyODg1MjNiZjI1YTliZjkxYzNfMWNTR0lHUVJuZ3ZjM2FIV3QwRUt6U2J3RXg3WWZjd0tfVG9rZW46Ym94Y244RG9OZGZCMzRjdERFTTJ2d2JxUHBjXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

写完之后唯一的问题是，我们的射击是基于我们的viewport的，这意味着，simulate结果是错误的。我们要确保只在server上生成Projectile，然后复制到所有Client。

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=NTk5ZDg5NWIwMmU1MGNjNTE4OWM3M2RlYzM1NjI5YTNfcU5xYTlKYTVWR0s4cDJoVzNEcG56NHR0U1RxUzI5elZfVG9rZW46Ym94Y25tRkZzVFBFTHA1d2FCTkZ5UXU3Zm5mXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

只有服务器上能生成子弹，然后复制到所有客户端，将子弹也设置成网络复制的，现在客户端上也有子弹，但是因为目标没有复制到所有客户端上，开枪时子弹方向是不对的

# 网络同步正确方向⭐⭐⭐⭐⭐

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ZTlhNjExYTA4ODQ0MWM5NGI3NDVkNzkzZjExMjA3NjlfVnoyT29IUWNlQUhuWDNGWEtYSU05VGRKak9WZkJsbEhfVG9rZW46Ym94Y24zUkE3YzNiblBnYXRHYkZnSkRuRlhnXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

使用FVector_NetQuantize进行网络传输优化，FVector_NetQuantize是FVector的子类，削减了精度，提高了网络传输速率

# 命中事件网络同步

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=NmI4NjhjY2M4NDk2OGYyOWI0OGY3MjBjYzQyZGI0MDBfc2t1aTZNMmtyTmluWlRDR1VzS2o2QXJodWNTQzNXNWZfVG9rZW46Ym94Y244dTJqY2dsY3VqRnBZYkdVRVpBSHVmXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

先声明回调函数，可以点击CollisionBox的Hit，查看需要什么参数，WorldContextObject指的是一个世界中的物体，一般传入this

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=MGE1MDViZjQyMzZmZTE1MTdkNDViZjIwMjNjMTQ5MjNfTWtvRTY5WmZwdEVhMVBDZlhIMXlhSUNscU40aU14SXVfVG9rZW46Ym94Y25PRWoxNmhMUTRUZWdsRTQ1MHRxMTFjXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

这样写，特效和声音在所属客户端上播放，我们需要在所有客户端上播放。

Destroyed（）在gameplay过程使用。

我们实现多播特效和声音的最简单方式，是在Super::Destroyed()后书写我们的播放声音和特效逻辑。

对于一个子弹，实际上我们不需要mesh，各种游戏中也没有mesh，只需要一道光柱(Particle)即可

# 弹壳自发光效果

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=MGRiODVjMmRiMTQ2YjhjZGFhZjZkZjhkMDdkYzhjY2FfM25YbGRKSUhZUzZrNzhHY2JnZGJqbVpON0hRZDV5UXVfVG9rZW46Ym94Y253N2VBaGNwQmlTTlZRd0FZRzR2R2hkXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

按住4，创建一个Vector4D，然后保持各个通道都是0，接着把他转化为参数，叫Emissive

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=OGNmZjVjMWY0MzIyZGIxNjMwOWM2ZDE2N2JkMmVkM2JfTXVOeDRyMlMyaEpNbTV2NXlXeHhXSHdibjNXN29keFlfVG9rZW46Ym94Y244cENQNHB1Y2hPSWVseVFnaG1RdktiXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

打开这个材质实例的Emissive，我们可以override这个值

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=NDQxZmU3M2I2OWVmODFjYWNmMTdhODE3MjA3OWI0ZjhfaFdtZkQwT1U4YkRSUHFwaUluMFpicWpmYjdiWFljT2pfVG9rZW46Ym94Y245dEIxS002VXB0d21GZkJwU1ZQVXhlXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

调成喜欢的颜色

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=M2RlZTU2ODViNWZiMzgzZjZhYjA4NTRhODM2NGM4MjhfeDFsM3hZVjVsYWo3Q2diVk5qdFo0QUc2VVZzR1ZiWHNfVG9rZW46Ym94Y25tY0RWRHQwTWY1dktrbnlhVXlrZ3ZnXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

对于Casing的生成，我们没有进行变量复制，实际上我们也不需要复制这个变量到所有客户端，只需要本地看到表现，我们需要在他触地之后的一会将它Destroyed。

# 音频编程

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=OGRkZDBhOTE3YzMwYTg4OGZhNDZkZGNjNTM2M2Y4YTBfRXZ1QVRvYjFCaEIwNHNnSzlwUmtzbGVSM0NmZmRkWmhfVG9rZW46Ym94Y25zdWRiSTlvWXI1NW1GaHZLNFZ2bGFlXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

可以创建一个sound cue,然后将所有cue随机选择

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=MDU2YTVhMmUzOGY2NDZlN2IwOWJlZGZlNWFkN2NmNDVfbVJlclBDZU1HVjVlNWVaNHpKcTJDSkNHNlpYSVM5M1NfVG9rZW46Ym94Y252ckJSZDVSZ0t1cGp3TXhzcEJZQnVnXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

创建音频衰减，可以避免距离很远时仍能听见

# 自制HUD

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=MmNkYTk0NmM2ZTc1ZmIxNTUyNjU3ZjY4MjJkN2RjZWRfaHI4dVFZU3BRWHlRdmh4WkpCSlFrckxQTHhiZ3F0ckNfVG9rZW46Ym94Y24xSHZZVVF0WVNLTkZ2M3NZMU1ub1pXXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

使用GenerateBody使得反射系统能和这个结构合作，USTRUCT使得这个结构能在蓝图中使用

BUG:只有服务器上能瞄准

最后发现蓝图里设置了 combatComponent不能同步

# 修正枪口朝向

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=NmY1ZDM4ZTc2NzM1ZDk4NjQ5MDM5MWRiN2ZjMzMzNWZfTk5LNjhoZ2JoZDFUelBNeWpSQjNNOFJvb05tcDAxM3BfVG9rZW46Ym94Y25nUGp3UzNObnJ5ZlpTUW0yNEhTREFjXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

骨骼上的SocketName不是大小写敏感的，hand_r==Hand_R。计算出右手应有朝向后，在动画蓝图中做解算

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=YjdmOGM0NDE0Mzc0MDU4OGU1NzQ2YTk0MTQyYmZlNjNfZnlISmFPZmZaV1h5M2NOazJ5M3RmTGo3WTJFR0V5cXlfVG9rZW46Ym94Y25Md3VjOUxRUGJQUlFuME9HTWZNNWhoXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

我们只做本地结算，不需要结算其他端上结果。

# 瞄准缩放

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=YzI5MTU4M2M3YzlmYjUzZmMwNWFjMjg2N2U3NzJmMWVfZ1hORzVwMkJDTzRRQXFiU2tqdWxyM0N2c0dTR0RQMmdfVG9rZW46Ym94Y25OTGxpZjRZZGtrbldEZGk3ekFDTmZkXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

改变摄像机的景深和光圈值，使得我们在瞄准近处和远处物体时不会出现模糊。

# UE CPP接口⭐⭐⭐⭐⭐

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=YWE0NTFjYzkwOWU2ODhkZDI2NDljOWYyMGI0NjczZWRfSzA3V29KSXJoakJ4MHJITUZVQmFwZk1KMlRoZXlKUjNfVG9rZW46Ym94Y25TdXowOVJKVmJRM2w2WHY3WHJXVW1nXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

自动创建的.h里有U开头和I开头的两个接口，在我们使用时，角色应该继承I开头的接口。

[Interfaces](https://docs.unrealengine.com/4.27/en-US/ProgrammingAndScripting/GameplayArchitecture/Interfaces/)

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=MjIzMTU5NmQxMGIzNmI5OTQ2YTk2OWZjYzdmNmUzZmRfamhsV3BJR0YwbjN4S09HcXh6Z3VuSEhXd3JBSTduaktfVG9rZW46Ym94Y25mb3N3eHg5OGJ0akJYQ0NmYzNXdUFiXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

询问一个类有没有继承接口的三种方法

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=Mzk2YjNhNDUwYjRjN2VhOWMzMGM2ZjcxODg3NTljMmFfRjJDbDBBNDR3YTNzMWRrdmpEUmJCMjFIemllUHhZMWRfVG9rZW46Ym94Y25OQ2dXYnVuWEl3aDZtZzF5bzVNQnNnXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

注意，这里询问是否继承接口，使用U开头的版本。这种情况下，接口里不需要实现任何函数，如果拥有这个接口，我们就把准星改成红色。

# 隐藏人物模型

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=OGM3Zjc4ZGQzZjJlYTI0NDk4OWMxMGEzOGE3YTYwNTRfbEw2OUxPZlZZbkxmVmhiWkVwVkIxV1ZnMTQ4SGNpQjFfVG9rZW46Ym94Y253RzhxcFBZTmZZTDlvRTVNMXpvSDNjXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

判断与摄像机的距离，太近时隐藏，超过时恢复。

# 多播受击反应（RPC（3)）⭐⭐⭐⭐⭐

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=YzA5NzkyOTQwYTVlMTJmYjAwMzQ0ZmUxYWJkZGM3NmJfUFFqbld5MTVTSGEzb0t5VGZjMlRsdHFCY2VyeTUzQ3JfVG9rZW46Ym94Y25IMjF5Sm43bkJoeldEOXlFdWtIZnpoXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

为四个受击动画做叠加处理

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=MDY1MWNjYzQ1MDcyMmUyNDg1OWY4ZGI0MGI1ZDY2NWFfZkVHeWtERDVSV0E1NzUxRkM0bzZmdG53ZmZHWGJmdVZfVG9rZW46Ym94Y25JWFRVaTIyWWE1TjNpMmtWa0pZYTNiXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

叠加处理后将这四个动画塞进同一个montage里，受击时进行选择即可。服务器可以命中客户端，客户端无法命中服务器，我们需要对这个动画进行multicastRPC。

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=N2Q5OGRiNzBlMWNjMzYyY2RhMWI1MjdjN2NmOGRmYTlfUEVXODl3a3hlSWJxejFrQW1HUmMxWmNOVlNUYUV4eWFfVG9rZW46Ym94Y241NGpjM1hDNHFwTzNDandSdE1LdjdmXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

选择Unreliable，这个不必重要，偶尔丢包不影响，可以提升网络表现。Hit只在服务器上发生，发生时调用MulticastRPC

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ZjFmZjAyZWQ1ZjJiN2FjMGE0ZmIyYWRmMDRlNDRjZDVfYlcyWVU1am0wVUFNNGRaQVNXNW1pYklTSU1mTlpuT2VfVG9rZW46Ym94Y25XSEhVWkpGUXJyZnRFY0Z6OUJ1R3pKXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

新增一个通道，使用实际的Mesh进行命中检测，便于实现爆头等伤害数值不同。

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=NGJlOGQ4ZTUyZGJhMTBjNWU0MWYxNTdiZDA1NjkyM2VfWFVVYndZYWJYOGpadUw3eDM0cEtGMW15RDBDZXd2YWpfVG9rZW46Ym94Y25zOERQRHB6alVHMlRVTVJyUFNYNGhiXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

ECC_1代表我们刚刚创造的碰撞通道，我们可以在Blaster.h中对这个内容进行替换。

# 解决SimulateProxy抖动⭐⭐⭐⭐⭐

P81_Smooth Rotation for Proxies

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ZWJlMDEyOGUyNGFkMDkzODU5ZWEyOTY2ZDJmM2MxYTVfamx6eXUya09XYnVZWG5qNEk0RWZaNXNjZG94eXUwQUlfVG9rZW46Ym94Y241M1JXdlVhQ0NFOTNnUTdFTUxCUGtkXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

这个是因为我们本地使用了Rotate Root Bone，我们在网络上并不会以本地的速度tick，所以会出现抖动问题。

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=NzU4NjA0ODAwZWZkOTA2YTMxNmM2YTI5YWJhYjdmNjdfazFZQVRPYTZJdjRQUzlNOHB4ZnNyTllJdUIwNTlvWnNfVG9rZW46Ym94Y25XSDZNQjNKcU5ucmpINlBwamtsM1ViXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

我们需要对simulateProxy进行额外处理，单独写一个函数来进行RotateRootBone。

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=MDE1NTE1MmI2NDQwMmQ4MmE4MTU2ZWVlNDBiODFjM2NfUjJnbGJyN0ZXc0ZwRWN6b0k0TEV3Q0tIQ0ZDYXRrdXRfVG9rZW46Ym94Y25qOEFVS1hFcTlqdkhHQllzRGpZdU1iXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

我们不能每帧调用这个函数，因为网络传播tick率要低于本地tick率，每帧调用实际上并不会起作用

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=OWIyMjM0ODhiNGQwM2E0MzRiMzEwODU5YzM3NWI0ZTVfazhEODFBTHhGQkRvT1llMFlOeGltbEduRTdtVG9jS29fVG9rZW46Ym94Y25yNENsbEJkN0pyNWdTWVNMNkVUVmRiXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

正确的做法是重写这个函数,角色的运动发生改变时，这个函数会执行一次。

# 全自动开火（Timer）⭐⭐⭐⭐⭐

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=N2M4Yzg4NDgxZWMzY2FlYjY2ZDIxMTlhOWQwN2MxZjNfb1IxNm9TNEFLaUo2ekRMczhScWlSYzdubWtvQ05WcnhfVG9rZW46Ym94Y25mYzJlYzBYYkNSYlVmUXVyY0liN01kXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

使用Timer进行全自动开火

# UE_GameFrameWork⭐⭐⭐⭐⭐

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=Y2JkY2RhNTU3Mjg0MzEwMzMzMmMzZmRjNTdiYTNhYmJfNWFESEx1cVdrd2FlOGxaeUhrc3dIRlZQRWFWbVM4ZEVfVG9rZW46Ym94Y25rNXdVRXlpUlZ4UGthZklBWHVGeWRjXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

- GameMode只存在于服务器上
    
- GameState存在于服务器和客户端上
    
- PlayerState存在于服务器和客户端上
    
- PlayerController只存在于OwingClient
    
- PAWN存在于服务器和客户端上
    
- HUD/WIDGETS只存在于OwingClient
    

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ZTI1ZDQ3Zjc2MTQwMzMyNTU1MmE1Nzk3MDZiZWRjZDNfRjdwM09qUjRLS0xYMFZWbGZDTTFWSUZ5OFA1SG96SFVfVG9rZW46Ym94Y25HQ1A1TjhrbFdJdGxOcHJVenQ2eG90XzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

GameMode定义了默认的类，游戏规则（玩家死亡和重生），比赛状态，热身时间，比赛时间。ServerOnly。

GameState定义了比赛的状态，得分最高的玩家，领先的队伍，队伍得分，PlayerStates数组。

PlayerState定义了玩家得分，击败数，弹药数，属于哪个队伍

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=OGRmYzI0NmI3NDMwODBkOWVlYWU4NGYyMTdiMzZkN2NfYjFFSlF5RmlFdk9KZEJnQUh2UjNTb1pia0ZtRTJhaWVfVG9rZW46Ym94Y25HUXR4N3lvUnJXc2dOYjdqSldybXpkXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

PlayerController可以轻松访问HUD

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=MDhiNDdmZmViMDUwZDQ0YmJiNzVlYmMyNGM2NWYzMjNfTFlNNVdiY0h1NXQ5OUI3eEZjTHZYWWN0QUc5eVdIN3VfVG9rZW46Ym94Y25uaWtaNG9tYnQ4WTBnYUp5Q205N2NjXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

服务器和客户端类存在情况

# CPP编写UI

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=YWU0MDNjNTJmODhiYjVlNWZjY2E2YWVlMTVhNThiYzJfQ2pVeVpMYzdnZ2JmRVdwZzkxR0RGTDJ2MUgxUHpoajRfVG9rZW46Ym94Y25sellPOXlWcTZLTVBpS1dncmt6SjBHXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

用到了自带的ToText和四舍五入函数

# 造成伤害⭐⭐⭐⭐⭐

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ZjlmMGI4YmNjYTZhZWMyNjhmYjI4OGQwMzNjMzllMTNfQXR2U25JbElUb1pUZ2tuSm00MzY3UTZnYkt6Z0IyckVfVG9rZW46Ym94Y244TmJpWm00NHI4bjZPaFVzUEswQ2dnXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

使用UE自带的ApplyDamage，需要一个instigator，这个是发起者的意思，接收一个PlayerController，

Causer接收发起伤害的Actor。我们暂时没有自定义伤害类型，这里使用UDamageType::StaticClass即可。

变量复制比RPC效率高得多，应该尽量避免使用RPC。ReceiveDamage只会发生在Server上，在这里进行一次PlayHitReactMontage，OnRep_Health只会发生在Client上，我们在这里也进行一次PlayHitReactMontage，避免了使用RPC

## 事件种类

对于事件有三种：Multicast （多路广播）, Server （服务器）, 以及 Client （客户端）。勾选 多路广播，该事件应在服务器上进行调用，在服务器上执行然后自动转发到客户端。 勾选 Server，该事件应在客户端调用，随后仅在服务器上执行。 勾选 Client，该事件应在服务器调用，随后仅在其所拥有的客户端上执行。

## RPC细节

RPC 函数非常有用，可允许客户端或服务器通过网络连接相互发送消息。 远程调用函数可设置为 Reliable 或 Unreliable，其中 Reliable 调用必定会发生，而 Unreliable 调用可能会在网络繁忙时被丢弃。大多数处理装饰视觉效果的远程调用函数应设置为 Unreliable，以避免过多占用网络。

远程调用函数主要包括 3 种类型：Multicast 广播、Run on Server 在服务端执行 和 Run on owning Client 在客户端执行

# GameMode⭐⭐⭐⭐⭐

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=MDk4ODk2ZGYwMWJmZWVhNmVkMDlhMzdjYmQ1MzI3ZWRfeFp1YVVwMFQ1R21mWDVXbU5zQUNXeVhKTXBTTmRseW9fVG9rZW46Ym94Y25aUUk0TXlpYk9BT1kwVDl5Z043ZkRlXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

继承自gamemode而不是Gamemodebase，因为gamemode有更多的已存在的函数和功能。

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ZWIwNDJkN2U3NzdjZDlkZmYyZGM2ZTcyOGU1MDJhMDhfMGlNanR2QTIyRjVpblZocUJ5RjZLYjhEMnZiRnlVNHRfVG9rZW46Ym94Y25WZ1J5TVZIZkhLZFBpczVzaWRxY29oXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

在玩家受伤时与GameMode联系起来

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=MmMzNzJmYzk5YzcyMmZmYzIzMDRlN2I5ZTZhMDc5NGFfc2lVd3J6NkRBMUNpUjA0WUdhRG9TQTR5NDNtOEJrUWZfVG9rZW46Ym94Y25rQldaMjcwYjl4UHg4WW42TTgyZVNkXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

动画蓝图中对是否死亡做处理，成功在服务器上播放，接下来的目标是在所有客户端上播放

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=OGUwNTgxOTZhNzBiNGYyZGMxNzRhOTZkOGNiMzk3ODNfYnlMYzBtVkh4SFY4N0N5ZnZmWFY2YjdIUWJWWjFkMGNfVG9rZW46Ym94Y25lVVNCMHd2TGVrbjIwajlsNXRWOXVkXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

将它声明为multicastRPC即可，要保证Reliable

# 使用Timer完成重生

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=NzZmOGY2NWY5YzM5OTljMTc0ZWU1ZTYxYTc1NDkxZTlfWFRwTDlyWkpHNDR3ZXRrajJHMUVXNDVkbEdnZmVJc25fVG9rZW46Ym94Y25TYzd4STNxWGRVMW5uWmszcUdIU2lmXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=YzFlYTMxYWE4M2RkN2Y1MGRmOTg4ZWNlYWI3M2JhYjlfRHpjWHcyOEpuczJjTWJNdW5sNFh5SWI4S0FqY0dQemVfVG9rZW46Ym94Y25uQlRWQ0ZuY2lBbXpnaVRSbXlCd1FiXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

Timer的第二次应用

# DissolveMaterial⭐⭐⭐⭐⭐

P91

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=MzJkY2MzYjM1OWUyMzAzNmYwZmQ2Nzg1MTZjYjMwOWFfRHh5anpvRGpKeGdoWHB5S1Y1M3JSTUpnY0VmbUxaZ2dfVG9rZW46Ym94Y25PUWR0Z3Yzcmt6dktSRmNOUnNEODdmXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

使用Mask模式，将得出的结果作为Mesh上的溶解,把溶解程度和发光倍数提升为参数，使用1-x的数据作为UV Data，UV就是材质的XY坐标

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=NjgyM2ZjOGMzYmM4NWU5Nzc5NWVmMzQyMmQwNTRjNmJfVjNKOTdaZFE1YVRxQVRLcFNsbnBvZERGMklJUTRwaTFfVG9rZW46Ym94Y25NMXFNeWRWUFV5ODFKSEp5MDJUdWxlXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ZGM2N2IxYTc4ZGEzZmE3ZTU1OTBjZjQ2MDQ5OTI4MDhfZ1FsWENnUGpvSmVvN3Y5aElYQXUwdlVkTEhXZXdFbU9fVG9rZW46Ym94Y25xRGhGUlc0RzhIV1JMOE1lMkJWRHdjXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

使用UE自带的Texture制造边缘锐利效果，将这段代码加到角色材质上即可

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ZDdlN2FlNGQyYzBkOTM4MjQ5YmM1NjM0ZGEwNzdmMTBfa3dMakZpZTZaQnMxb3JGNkZvN1hGTkN3ejN3Mmg3ZUxfVG9rZW46Ym94Y250QnF4WUtTUWdhVkNQQXpsaXpLUm5lXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

使用CPP定义Timeline并且使用Curve控制溶解程度

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=MDdjMTk3MDdiNzc5NDI2ZTFlZTM4MzFiNmI4OGI0ZDZfSjM5cDRNdjhRQWpUTWdGVkdkZ1ZPZmhMSW1yYk1qdjdfVG9rZW46Ym94Y25XSVFlZG50MmRaSng3Q2l5OWZWTHJkXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

增加轨道

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=Nzk3NGU0OWQ0YzFlMGQwNTMwZjM5YTJkNmZlY2ViMGZfZzNrVzdVQ2k2dlFOcmhvU2VzT1RqYVZROUxRWmVzRjJfVG9rZW46Ym94Y253M0pYWll5Q3lnR0N3WmZsS3FNUU5mXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

使用TEXT设定参数

# 机器人特效

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=MjBjZDM2ZThiOWRmZDQ1MDJmOWNhM2E1MzVhOGFhODhfMTNsS1F6akxZT3FkT01NRkpWamJ5cHVaMUNFNkJzaXZfVG9rZW46Ym94Y25BYU8xOE5MRmN6UHlrVUZ1Tm93dnJjXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

设置粒子寿命

# PlayerState⭐⭐⭐⭐⭐

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=MzFiMTcwNDhjM2QyMTQyY2RmYjllMjA1M2M2MWY1ODVfNU9DdnVuZ0RrbXo1Snl2clh3aGcwQ3NzNTI1OFA3RFJfVG9rZW46Ym94Y24zRkwzMmJza1R0cVljZENPd25YT3VmXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

PlayerState储存玩家状态相关的东西，例如分数。Score是PlayerState自带的东西，这意味着他会自动复制。

PlayerState在服务器上在BeginPlay之前就已经初始化完成，在客户端上，需要重写OnRep_PlayerState()赋初始值

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=YWNlZGE0OTFiMTMwZjUzNTQyOTg5NDRjMDExNjE5ZDFfTnhMbFlRRzBEWTdoSlNKWUFOdkJiaWVpeFJwcE12MzZfVG9rZW46Ym94Y250TlZsaVh2RjRPZHhhQW50VVU1WjlkXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

给空指针加上UPROPERTY,他会是一个真正的空指针，不会发生内存访问错误

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ZWEwYjZhMTkxODllODE5MWQ0NGZhYzNjY2M1ZWFmOTVfRmdhQ09tak1rNTNyR0RSUTBHRjJxS2pncUJnZ3ltbVRfVG9rZW46Ym94Y25NVjVZTU1raXVydkJHSDFQNGt0ZXpoXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

需要在捡起武器时就设置正确的子弹数量，我们可以重写OnRep_Owner

# 有条件变量复制⭐⭐⭐⭐⭐

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=Zjg3ZjI5M2JkMzA3YTE3ZDU0YmViNjJjMTg1YTU4MzBfRHdvM3ZBVDJTVW9yblVveTM2VjBzR3k0QkFUT2l4Z2dfVG9rZW46Ym94Y25iYmtaRjVQOTZqeHJjVDROT2RkdnpiXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

在复制玩家储备弹药这种变量时，我们无需把他复制到所有客户端，只需要复制到所有者的客户端即可。

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=YmQwNjQwNzkzNjkzZDAyZjI2MjIyNmJhZGMxNDc4NmVfQUtKUFVSYW41RmZ4S1BoT1dEMGpMVkNqUU1PeWlpemlfVG9rZW46Ym94Y25WS3hmdEtkcnZEYVlqSmtiSlR4Vm1nXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

defaultMAX的意义是，我们可以直接查看他等于几，来告诉我们一共有多少个枚举值

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ODc2YzU1MjI4MmVlODRiYTE2YmVhMjIxM2E5MGFiNTJfYlk1MElkMGFHejF0QVFFOUtIbHIwUUZid2t4UGR5NjRfVG9rZW46Ym94Y25OMVlMd2dnMXlhUjQ4Q0V6bEZ5c2hnXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

TMAP无法网络复制，需要想出别的办法

# 换子弹问题

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=YTEyZGRlMjQ1NjQwMjEyMWY5MDE3MTQzYTJkMGExZDdfUExZakZHZDhocmQ2WVhaU1dUbUVQcXg1T1lOTURMZ0VfVG9rZW46Ym94Y25Cd2FWSHFQd0VkSVBQM0ZhOUFIOXVjXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

最优解

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ZjExYjdiNTRjOGI3OTBiNGZjMjAxNGY2N2E3ZTUyNmZfOG1CRWM4bHU4SHQ2TUZUTTRYN2xnMGFlU1hjRGQ4eXdfVG9rZW46Ym94Y240WlEwSzcxM04xcERGaHQ1QU5XUThiXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

使用特殊语法初始化倒计时，保证01也会有两位数字

# 同步客户端和服务器时间⭐⭐⭐⭐⭐

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=NzAzZDI0NDQzZDUwOWRhZWMxZWZhMzgzZjZiNDU5ZThfcEZhY2lGa2hzOVk5RWZvM3A3ekhSRmthbkpEa0VqSXlfVG9rZW46Ym94Y25HY25QOURjelZCVUdKQzVOQmxwMlBnXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

需要以服务器为主，加上RPC时延

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ZDhjM2Y0YWM2NzZhMzIyMDIwZGNjN2ZmM2YyMTYwZGZfamhPbjhLMWdWQ0VJbXIyNm5jRlRaeXhqOWRsRTNyMkJfVG9rZW46Ym94Y25Ba3h3NFlQQzRybTVyUVB2UGh1bXlkXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

我们无法获得两边的时间，只能使用两个 1/2RTT进行估计，这个技术上被称为非对称往返时间。

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=YzlmNGNlODA2ZjUyZGU1NjU0ZGUwZjA1ZWM2YTIzNGFfRm1tWHc1WHVZSXd2amxPY09PdzJUaWljMDUzRUN6SzVfVG9rZW46Ym94Y25JSkdsdnBwWlJUdDU3a0FXTGVxRDFiXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=NTJkMDVjYzBhMWJkMDJkNzVmN2JiNjM4YmNhOTU2YzBfUFRacGppN3FUdWcxbEEyQ1ByZEpWNG1qNmZZN2h4RVlfVG9rZW46Ym94Y25Edk1DQU5lRHg0eUg0d0Y1azF2aEliXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

需要实现客户端向服务器的询问，服务器对客户端的答复两个RPC函数

# GameMode⭐⭐⭐⭐⭐

p111

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ZGUwMGNhNWY1NWI3ZGRhMDAwMjZiZWYxZTc5MGFjNTdfUDFlWHFIdXM2TllqekVvWEh6ak1ZemUyWEFyTExqZW5fVG9rZW46Ym94Y25OUkpPcWw5NWdHcXVCak9ad3k2dTJkXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

GameMode相比于GameModeBase，多了MatchState以及相关的切换函数

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=N2RkZTBmMTQxY2NlYWJhM2NhYmYwMmViYjBiMzE4OGZfU2I4QkpQYjN6RGZOR2VBMDZsRmd1RGtaU0FpNlJjU0NfVG9rZW46Ym94Y25LclNPVzY0ejczcm1ZMnhCalcwWVZmXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

MatchState包括很多状态，我们也可以自定义我们自己的状态。

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=NjlhNmViZWQ2N2E5MWExNGI3ZTlhNzAxYjExNTg1MmVfeTFJU0JqWERvdDBUdHFWWHB2dk92WDVHSHJuUkJ3Q2NfVG9rZW46Ym94Y25XNHByWWlTQVpMVExldmVlZzNZT1ZmXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

在有一大堆变量需要复制时，我们可以不使用变量复制，直接使用一个ServerRPC完成任务。

# BlasterGamestate⭐⭐⭐⭐⭐

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=NmMwMTEwMmRkNzRkMWYxYWE4ZGYzYjkzYmMwNTI2YTRfdVRIZVRYVlNWYkg1ZEdEamhFekNMN1ZNQWV1YnZNQ1RfVG9rZW46Ym94Y25kM1I3QjZUV1B2dVdFNzhUSkpRMXNkXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

维护一个数组来表示现在得分最多的玩家

# Make Smoke Trail⭐⭐⭐⭐⭐

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=Njg1M2FhMDMwNGExNjJmNGI1ZGEyMDhlZjZjNDUxYzhfYXdsZTJXMGVlVmlGSGJ4VlVrZXB3R21GNVIxb0c0SUFfVG9rZW46Ym94Y25MNFo0YjJHYWxhdFlBdTY2bXhsU1pmXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

为我们的火箭轨迹创建一个Material和MaterialInstance

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=Zjc2YTg2NjYzMWM4ZjU1YjAzODM5NWI5NmIxYWE4OThfUFNuZ0ZXNk1idmpUYWZ1Z0NoSU5XajNXeXhjOUNrcVRfVG9rZW46Ym94Y25EbjJzcmZNRGdDWFBaV0kyaG9ubGplXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=MGFlOWFkOWRhYzM5YzczM2Q1ZGRkMmUyYjY0MmNhYWFfdUV1emV2cXRHbHJnWnVoc2FVc3ZGd2kzVlFsOHphT2lfVG9rZW46Ym94Y25BcGU0bmxNeVdKQ3gzUkRsRkVWMTFiXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

创建Emitter，定义随机的旋转，随机的图案和随机的持续时间，颜色随时间改变。

# 延迟补偿⭐⭐⭐⭐⭐

P159

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ZGNhYjBkNzYxZWUzMDZjZDAwNDljY2RhNTFlODZmYmZfd28wWktlNGZxZUV3blozOENnQ250eUMyMmlIT2FUaDJfVG9rZW46Ym94Y25GWG9MZVZyYlhkdFFBZ1JkQzZTSlVlXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

从客户端一侧先进行预测，发送这个行为到服务器，再广播给其他客户端

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=NjYzMDY4NWNkMGQ1MmQ0YzljY2Q3N2Q1MDNmMGM4OWNfUEdEUWJ0bTg4UlpGWHRSNFRVZ255NzloVVhWZ2RMNmZfVG9rZW46Ym94Y25lZlYxbjNybFNhNmxBbkFUMnhrZzZmXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

内插值，在别的客户端，会取两次数据的中间值。

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=Mzg3ZjQ4MTNkNzlkNDk1ODA5ZWQyMzYwMWJhMjFjOTNfTHlPaTF5QVZxOWVodk9ta2JoWFNrQTEyWFpVOVlTMHZfVG9rZW46Ym94Y255UWtuVVZHb0ZZWkVkcVR5TWNJSFJoXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

外插值，在下一次值到来时假设目标接着往前走

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=MjUwODY1Y2MyZjg4M2ViMTRkYjYxYzI3NWNiMGE3YWJfdFVvYUN6aFcxRUhva2J4VFlQUWxrYTVzOHNMMXBkMmNfVG9rZW46Ym94Y25yTzF0U0NVbk14MVdHeVFENHlMWDhkXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

UE同时使用两种插值，并且在需要纠正时使用Rubber-banding.

## Sever-Side Rewind

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=MTM4NDVmYjA4ZDVkMTNlOWYxNzYzMTNjNzQxNTZkODFfcGt6ZWlZbHh1bkh6YjZoUWpuVURpRjdveFBVMVlHdlRfVG9rZW46Ym94Y25ubGRKVm96dkdHcjZPUkloNnA4amhkXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

在判断命中事件时，需要和之前Rewind的帧进行对比，判断是否真正命中了目标。

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=MzI0OTgwZTAzNGVjZmRlMjljNThiZTA2OWI4OTEzMDlfSUtyRmtabVRoN2RPRnZnMHhtNE5kRUcwRU9nYkNxb2dfVG9rZW46Ym94Y240bVFNaWZqYXVLNUNCakRVdGpoa3llXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

可以从PlayerState中获得Ping，这个值被UE/4，我们需要乘回去。

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ZGY4YmMxN2VhNzA5NjlmMDk3ODQxYjY0OTdkMDQxODZfSURkaTFqS1pmblNta3NHTFlGQ3NidzhIOGVyQzNyWkVfVG9rZW46Ym94Y25UNnZxRE1rWWx2YVJLMGdJMXFDQW5iXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

1.倒回命中时间，射线检测玩家的碰撞盒子。

2.确认命中后发送请求，重置所有盒子。

# 预测子弹数量

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=Y2JlMzdkOWIyNGRiMmYxOGViMGNjMDdlMjIzOGZjODRfTFhFVFdnMmU2Q1U2VzlHd1J2ejk0TnZCV1FIVnVkYldfVG9rZW46Ym94Y25FdEtmMm5HTDJZT1JXN3A1VVB0Q2toXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

客户端侧预测的小应用

# 服务器倒带实现⭐⭐⭐⭐⭐

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=NTFjMWUwYzhmZDhjZjg3ZWViNjdjYWI2MTBiZDAxNTBfMFpHZktpbDRrNUw4STVnMFpVN0tUTUFuQldJQUFMUkpfVG9rZW46Ym94Y25Vb2FHcG1KTmxjRXRiS0dtc0ZSbmZlXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

我们需要存下来前几帧角色的位置，精确程度按需求而定

## 构建FramePackage

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=NGU2MzhkZWY1NWE1ZTQyZmRmNjI4ZjA5NGU0YzgzYjRfYTk4VjFZN3pIZlVDN21WVmlnYXI0T2VUWGRqaDRsYWZfVG9rZW46Ym94Y25hM1RBSFhXTXJLd01KM3BJM016ZTFnXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

为各个部位制作用于Rewind的碰撞体

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ZjU0YmEzOGQyZjk0NTUyYzE1YmE1NTU0YmNjZmI0OThfZU52UUp3Y24xenp0dFNWdVpvanRUNGpSSXhRNDV3SENfVG9rZW46Ym94Y242R3ZsZmtkcURKT0s0ckhFODRlTWplXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

构建一个箱子的信息，frame的信息包括箱子的信息和名称以及对应的骨骼名字，这个使用TMap实现。

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=YmVlZTNjNmU0NTRkNmE5NzdkMzI0NTBjNzcwY2JjNWVfVEZSUVB0TFNFYXdodk05cDFVTGViaUcwUUhxQzhheUlfVG9rZW46Ym94Y25iMUtmUGpBRFF4U1dGcnpCZ2JrcGllXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

每帧把这个信息保存下来

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=NmRjNjhhMjZiY2Y0OTkwMDJjOTRlZGU0NTMyNjU5NThfQ0lrU2JLTzQ3aDFIQ1NKZkVNeHRQZXMyVkhkbnlLeHRfVG9rZW46Ym94Y25zTHB3UVlUbjB5NFdhVzBUeGQxSUpjXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

最好的解决方案是无环双链表

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ODAwZDk1MmE5MWFmYjI0M2U5YzkwNGNkNTUwNGQ1Y2JfWmI1R3BFUkhPNU1NdHhuajRZQkVualF3RlZxZlJBaE1fVG9rZW46Ym94Y25PcVZJUWFlMUxOOTRCeDZzS2I0NXFiXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

每帧存储，并且可以规定丢弃时间

## InterpTo原理

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=MTI1MzNiZWQ2ZGJlMTk5MDI1YWRmZjc4MTlmZjM5ZWRfcmZxQzg1R0RrZDFveEQ0OWhwMU5zUDlSWVZKZUJsYXVfVG9rZW46Ym94Y25TZTF4NTQ4VnNPb0hQYTZLYnBLYVBlXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

## 记录往返时间

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ZmE0YzQ3YWY3ZjdiNmVkYjA3NWE4NjEzMmI0ODMyZjhfcnJOVzJJY2V1RmpXcUQyS1pHSm16STAySVNwYmJYbThfVG9rZW46Ym94Y245QWoxQzFyWmYwTG5ITEhUVHpGWEFoXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

我们需要估计隔一段时间记录一次往返时间，为我们的服务器倒带函数提供参考。

# PostEditProperty

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ZGI2YzUxNTAzOGUzYjI1YjMzZGI0Y2Q0YTdkMjBlMzNfOEFkY1R0YXd5SXBuOWgyYldud1dTUEFFczViQ2xGbndfVG9rZW46Ym94Y25NNzJWQkdtYUx5aDJmcnRxRHNoTHpjXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

重写这个方法来保证各种属性的蓝图和C++一致，只在Editor情况下编译这一段

# ProjectileRewind⭐⭐⭐⭐⭐

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=MGIxMTFkYmFkYWVmMGEzZWZmNTJkNzA5YjNmODBkZTNfZ1lvN0RRbmxlNTVrVU82NmlOZHp2YnBHOXRGUzBSMUdfVG9rZW46Ym94Y255bmxJS0lrajBQY2hpQ2RRUlk5MmpoXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=MmZkNTJiYzJkNmFjNmRhMGQ4YzAwNGUyY2QzZDBjMTNfaUNrMXF5UkVpbFFoOTJjWGxkMnpKbUxBSU5USUF5eVNfVG9rZW46Ym94Y25adnNwanU5cGpVRk54eldXWGtXWmZkXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

非常复杂，需要处理Server-Client,Locally-notLocally,useSSR-orNot。这一段是，projectile武器，在收到开火指令后生成子弹的处理。减少ssr的调用次数。

这样处理，在服务器上的结果是一样的。

如果在客户端时，如果不使用SSR，我们会在网络延迟后发射我们的子弹。我们不会生成本地的子弹，会等待服务器返回复制的子弹。

如果使用SSR，我们会在客户端上立刻看见SSR子弹，随后在服务器和别的客户端上看见非复制的非SSR子弹。

这样操作能在客户端上立刻看见结果，提升可玩性，并且也带有正确的服务器结果。

# 作弊与验证⭐⭐⭐⭐⭐

## 作弊方法

### CodeInjection

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=MGM4YjdkNzQ0MGVmZDQ0NGMxYjM4YjI0YzVjNTA1MjNfYWpBSkZUYTdHdzdpSGtjSVhLaHFKMXRhTG5ZSEJlZ0hfVG9rZW46Ym94Y25FVjEyektsNnlQNUxPRk8xYlI2aHhmXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

通过高级语言查看运行时的内存，找到值之后使用poke命令修改这个值。或者使用.dll库注入游戏中

### 网络数据包伪造

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=Nzk5NmUzZGUyZGVkYTI5NTRmODBmNjEzNWE2YmM0NjJfQ1ZZYUsxUzhMYkNmZXN5TXVDSVZ6bWZQOUhxNnJPQ2FfVG9rZW46Ym94Y250YXp5ZXE1bllzVGN3QkRYM04xUHpZXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

通过截下客户端发给服务器的包，替换其中一些数据为优势数据实现作弊效果。

### 利用Bug

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=M2ExZjdhZDRkYThjZTY4MWFiODgzYjk1YjIwYWExMmFfU2g2dUhId29GcVBtWjIxU3VOQzhhRlc5S1hqUUV5ajFfVG9rZW46Ym94Y241R281ZnYwQnNtRkxkdHQxT2U2NUZnXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

例如进入一些不允许进入的区域，你能攻击Boss但Boss不能攻击你。

### MemoryEditing⭐⭐⭐⭐⭐

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=MGQ3ODFjYzZmZmRiMDJhNzAxMmUwMGUyODJlNjA3YmFfdVVsenR2d2F3enFYVU9VRWRkU2dPZ3NUanZmd3RYSU1fVG9rZW46Ym94Y25EY0ljRFR2OUJRZThVbFZaOXdGclJkXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

利用一个应用程序来监控游戏内存，将一些值修改成优势数据。

## Validation

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=YjVlYmQ2Y2E1MDFjNjIxYjkzYzNhZmRhNDZjZjNkZjNfdlp0WnZSaG5QQUVXVEdnUEQyWUR6QmRQZzk4NFVTbUVfVG9rZW46Ym94Y25MQmhTVktjZXBjeXB2MGlHTE5zV3FoXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

UE自带验证函数，用于阻止上文所说的MemoryEditing方法。

对于前两种办法UE会自动阻止，不太可能发生。

## 项目实战

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=OTM4MWYxMjNiNTU4MDlhOWM0YjkyM2FiODZmOTIwNzlfWWdrNVpoN04zQ3R5Qm9TS2pRSGQ5WjRISXc1RTFGem9fVG9rZW46Ym94Y25YOEl5aW5yYzhXVDQ3emhnSE1XbzhkXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

在beginPlay中把开火速度改得超级大

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=NTgwYjZmOTU0M2RmNTJlZDQ2NDcxZWJkYTcxNjZkYjVfQzJZaWJITjNTNm5nZDI3MWxBOEpLejVoU1NVZTFoeERfVG9rZW46Ym94Y24wMjhuYnBxazhrOHhrbFZZZU52anVkXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

利用UE自带Validate函数，如果返回false，会直接将玩家踢出游戏。

# 记录退出游戏玩家

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=ZDk2MzQ3MjQyNGRkNTMxZDhkNzc1MTI3ODY0M2YxZmNfaDVkdVhBNUQ5Q3NNQmJuQnBjRWZLYk9DMUVNaDdpVXpfVG9rZW46Ym94Y25SZlZmTjBIeEV2ZXE2eFRoMU0xak1iXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

客户端退出游戏时，应该有一个完整的流程。

![](https://r4atlqgm2n.feishu.cn/space/api/box/stream/download/asynccode/?code=MTZkOWExNzA5NmU5NDc0MjQ4ODQzYjkyNGFmZmY2NWFfSFJYWHFaSXJYMzhGZ1Q5VnBvVFpKNllpZ1hWaEpOdmxfVG9rZW46Ym94Y25HVTVkRFNDREc4a21oZjk3cTJLMUFjXzE2OTQyNTAwODQ6MTY5NDI1MzY4NF9WNA)

角色，GameMode，菜单三个类之间需要配合。