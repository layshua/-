# 一、Playerprefs
## 基本方法
prefs：控制台

- Playerprefs 是 unity 提供的可以用于**存储读取玩家数据的公共类**
- PlayerPrefs 的数据存储类似于**键值对**存储，一个键对应一个值
    - 提供了存储 3 种数据的方法：int float string
    - 键：string 类型
    - 值：int float string  对应 3 种 API
- 如果不同类型用同一键名进行存储，会覆盖数据


> [!NOTE] 数据的唯一性
> PlayerPrefs 中不同数据的唯一性是由 key 决定的，不同的 key 决定了不同的数据，同一项目中如果不同数据 key 相同，会造成数据丢失要保证数据不丢失，就要建立一个保证 key 唯一的规则。

```cs file:存储数据
//直接调用set相关方法只会把数据存到内存里
//当游戏结束时 Unity会自动把数据存到硬盘中
PlayerPrefs.SetInt("myAge",18);  
PlayerPrefs.SetFloat("myHeight",1.75f);
PlayerPrefs.SetString("myName","张三");

//如果游戏不是正常结束的，而是崩溃，数据是不会存到硬盘中的
//可以调用save方法手动把数据存到硬盘中
PlayerPrefs.Save();
```

**注意运行时只要你 set 了对应键值对，即使你没有马上存储 save 在本地，也能够读取出信息**
```cs file:读取数据
int age = PlayerPrefs.GetInt("myAge",20); //可选第二参数，如果找不到myAge的值，就会返回第二个参数   
float height = PlayerPrefs.GetFloat("myHeight");
string name = PlayerPrefs.GetString("myName");
```

```cs file:判断数据是否存在
if(PlayerPrefs.HasKey("myAge"))
{
    print("myAge存在");
}
```

```cs file:删除数据
//删除单个数据
PlayerPrefs.DeleteKey("MyAge");
//删除所有存储的数据
PlayerPrefs.DeleteAll();
```

### 存储其他类型
PlayerPrefs 是有局限性的它只能存 3 种类型的数据，如果你想要存储别的类型的数据只能降低精度或者上升精度来进行存储，当然也可采用下面的小 trick：

```cs file:trick存储bool类型
bool sex = true;
PlayerPrefs.SetInt( "sex", sex ? 1 : 0);
```

**存储更复杂的 List<> 类型**

```cs file:存储更复杂的List<>类型


public class Player
{
    private string _name;
    public int _age;
    private int _atk;
    private int _def;

    //装备信息
    public List<Equipment> EquipmentsList;

    //该变量时一个存储和读取的唯一key标识。识别多个玩家，分别存储
    private string _keyName;

    public void Save()
    {
        PlayerPrefs.SetString(_keyName + "name", _name);
        PlayerPrefs.SetInt(_keyName + "age", _age);
        PlayerPrefs.SetInt(_keyName + "atk", _atk);
        PlayerPrefs.SetInt(_keyName + "def", _def);

        //装备信息
        PlayerPrefs.SetInt("EquipmentsCount", EquipmentsList.Count);
        for (int i = 0; i < EquipmentsList.Count; i++)
        {
            //存储每一个装备的id和数量
            PlayerPrefs.SetInt("EquipmentsID" + i, EquipmentsList[i]._id);
            PlayerPrefs.SetInt("EquipmentsCount" + i, EquipmentsList[i]._count);
        }
    }

    public void Load(string keyName)
    {
        this._keyName = keyName; 
        
        _name = PlayerPrefs.GetString(keyName + "name", "test");
        _age = PlayerPrefs.GetInt(keyName + "age", 18);
        _atk = PlayerPrefs.GetInt(keyName + "atk", 100);
        _def = PlayerPrefs.GetInt(keyName + "def", 1000);

        //装备信息
        int num = PlayerPrefs.GetInt("EquipmentsCount", 0);
        EquipmentsList = new List<Equipment>();
        for (int i = 0; i < num; i++)
        {
            Equipment equipment = new Equipment();
            equipment._id = PlayerPrefs.GetInt("EquipmentsID" + i, 0);
            equipment._count = PlayerPrefs.GetInt("EquipmentsCount" + i, 0);
            EquipmentsList.Add(equipment);
        }
    }
}

public class Equipment
{
    public int _id;
    public int _count;
}

public class NewBehaviourScript1 : MonoBehaviour
{
    void Start()
    {
        Player player1 = new Player();
        player1.Load("Player1");

        print("装备列表数量：" + player1.EquipmentsList.Count);

        for (int i = 0; i < player1.EquipmentsList.Count; i++)
        {
            print("道具ID：" + player1.EquipmentsList[i]._id);
            print("道具数量：" + player1.EquipmentsList[i]._count);
        }


        Equipment equipment1 = new Equipment();
        equipment1._id = 1;
        equipment1._count = 1;

        Equipment equipment2 = new Equipment();
        equipment2._id = 2;
        equipment2._count = 2;

        player1.EquipmentsList.Add(equipment1);
        player1.EquipmentsList.Add(equipment2);

        player1.Save();

        print("装备列表数量：" + player1.EquipmentsList.Count);
        for (int i = 0; i < player1.EquipmentsList.Count; i++)
        {
            print("道具ID：" + player1.EquipmentsList[i]._id);
            print("道具数量：" + player1.EquipmentsList[i]._count);
        }
        
        Player player2 = new Player();
        player2.Load("Player2");
        //...
        player2.Save();
        
        //...
    }
}
```

### 存储位置
不同平台存储位置不同
**Win**
存储在 `HKCU\Software\[公司名称]\[产品名称]` 项下的注册表中
其中公司和产品名称是在“Project settings”中设置的名称。 

1. 运行 regedit
2.  `HKEY_CURRENT_USER/SOFTWARE/Unity/UnityEditor/`公司名称/产品名称
**安卓**
`/data/ data/包名/shared_prefs/pkg-name .xml`
 
**IOS**
`/Librany/Preferences/[应用 ID]. plist`


单独使用它的原生功能，非常适合存储一些对安全性要求不高的简单数据
但是也不能小看它，对它进行简单的封装，也可以让它变得方便又安全


